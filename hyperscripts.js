/*!
 * https://github.com/es-shims/es5-shim
 * @license es5-shim Copyright 2009-2015 by contributors, MIT License
 * see https://github.com/es-shims/es5-shim/blob/v4.1.11/LICENSE
 */
(function(e,t){"use strict";if(typeof define==="function"&&define.amd){define(t)}else if(typeof exports==="object"){module.exports=t()}else{e.returnExports=t()}})(this,function(){var e=Array;var t=e.prototype;var r=Object;var n=r.prototype;var a=Function.prototype;var i=String;var o=i.prototype;var l=Number;var u=l.prototype;var f=t.slice;var s=t.splice;var c=t.push;var v=t.unshift;var p=t.concat;var h=a.call;var g=Math.max;var y=Math.min;var d=n.toString;var w=typeof Symbol==="function"&&typeof Symbol.toStringTag==="symbol";var m;var b=Function.prototype.toString,T=function Fe(e){try{b.call(e);return true}catch(t){return false}},x="[object Function]",O="[object GeneratorFunction]";m=function Re(e){if(typeof e!=="function"){return false}if(w){return T(e)}var t=d.call(e);return t===x||t===O};var S;var j=RegExp.prototype.exec,E=function $e(e){try{j.call(e);return true}catch(t){return false}},I="[object RegExp]";S=function Ae(e){if(typeof e!=="object"){return false}return w?E(e):d.call(e)===I};var D;var k=String.prototype.valueOf,N=function Ue(e){try{k.call(e);return true}catch(t){return false}},M="[object String]";D=function Ce(e){if(typeof e==="string"){return true}if(typeof e!=="object"){return false}return w?N(e):d.call(e)===M};var F=function(e){var t=r.defineProperty&&function(){try{var e={};r.defineProperty(e,"x",{enumerable:false,value:e});for(var t in e){return false}return e.x===e}catch(n){return false}}();var n;if(t){n=function(e,t,n,a){if(!a&&t in e){return}r.defineProperty(e,t,{configurable:true,enumerable:false,writable:true,value:n})}}else{n=function(e,t,r,n){if(!n&&t in e){return}e[t]=r}}return function a(t,r,i){for(var o in r){if(e.call(r,o)){n(t,o,r[o],i)}}}}(n.hasOwnProperty);var R=function Pe(e){var t=typeof e;return e===null||t!=="object"&&t!=="function"};var $={ToInteger:function Ze(e){var t=+e;if(t!==t){t=0}else if(t!==0&&t!==1/0&&t!==-(1/0)){t=(t>0||-1)*Math.floor(Math.abs(t))}return t},ToPrimitive:function Je(e){var t,r,n;if(R(e)){return e}r=e.valueOf;if(m(r)){t=r.call(e);if(R(t)){return t}}n=e.toString;if(m(n)){t=n.call(e);if(R(t)){return t}}throw new TypeError},ToObject:function(e){if(e==null){throw new TypeError("can't convert "+e+" to object")}return r(e)},ToUint32:function ze(e){return e>>>0}};var A=function Be(){};F(a,{bind:function Ge(e){var t=this;if(!m(t)){throw new TypeError("Function.prototype.bind called on incompatible "+t)}var n=f.call(arguments,1);var a;var i=function(){if(this instanceof a){var i=t.apply(this,p.call(n,f.call(arguments)));if(r(i)===i){return i}return this}else{return t.apply(e,p.call(n,f.call(arguments)))}};var o=g(0,t.length-n.length);var l=[];for(var u=0;u<o;u++){c.call(l,"$"+u)}a=Function("binder","return function ("+l.join(",")+"){ return binder.apply(this, arguments); }")(i);if(t.prototype){A.prototype=t.prototype;a.prototype=new A;A.prototype=null}return a}});var U=h.bind(n.hasOwnProperty);var C=h.bind(n.toString);var P=h.bind(o.slice);var Z=h.bind(o.split);var J=e.isArray||function He(e){return C(e)==="[object Array]"};var z=[].unshift(0)!==1;F(t,{unshift:function(){v.apply(this,arguments);return this.length}},z);F(e,{isArray:J});var B=r("a");var G=B[0]!=="a"||!(0 in B);var H=function Le(e){var t=true;var r=true;if(e){e.call("foo",function(e,r,n){if(typeof n!=="object"){t=false}});e.call([1],function(){"use strict";r=typeof this==="string"},"x")}return!!e&&t&&r};F(t,{forEach:function Xe(e){var t=$.ToObject(this);var r=G&&D(this)?Z(this,""):t;var n=-1;var a=r.length>>>0;var i;if(arguments.length>1){i=arguments[1]}if(!m(e)){throw new TypeError("Array.prototype.forEach callback must be a function")}while(++n<a){if(n in r){if(typeof i!=="undefined"){e.call(i,r[n],n,t)}else{e(r[n],n,t)}}}}},!H(t.forEach));F(t,{map:function Ye(t){var r=$.ToObject(this);var n=G&&D(this)?Z(this,""):r;var a=n.length>>>0;var i=e(a);var o;if(arguments.length>1){o=arguments[1]}if(!m(t)){throw new TypeError("Array.prototype.map callback must be a function")}for(var l=0;l<a;l++){if(l in n){if(typeof o!=="undefined"){i[l]=t.call(o,n[l],l,r)}else{i[l]=t(n[l],l,r)}}}return i}},!H(t.map));F(t,{filter:function qe(e){var t=$.ToObject(this);var r=G&&D(this)?Z(this,""):t;var n=r.length>>>0;var a=[];var i;var o;if(arguments.length>1){o=arguments[1]}if(!m(e)){throw new TypeError("Array.prototype.filter callback must be a function")}for(var l=0;l<n;l++){if(l in r){i=r[l];if(typeof o==="undefined"?e(i,l,t):e.call(o,i,l,t)){c.call(a,i)}}}return a}},!H(t.filter));F(t,{every:function Ke(e){var t=$.ToObject(this);var r=G&&D(this)?Z(this,""):t;var n=r.length>>>0;var a;if(arguments.length>1){a=arguments[1]}if(!m(e)){throw new TypeError("Array.prototype.every callback must be a function")}for(var i=0;i<n;i++){if(i in r&&!(typeof a==="undefined"?e(r[i],i,t):e.call(a,r[i],i,t))){return false}}return true}},!H(t.every));F(t,{some:function Qe(e){var t=$.ToObject(this);var r=G&&D(this)?Z(this,""):t;var n=r.length>>>0;var a;if(arguments.length>1){a=arguments[1]}if(!m(e)){throw new TypeError("Array.prototype.some callback must be a function")}for(var i=0;i<n;i++){if(i in r&&(typeof a==="undefined"?e(r[i],i,t):e.call(a,r[i],i,t))){return true}}return false}},!H(t.some));var L=false;if(t.reduce){L=typeof t.reduce.call("es5",function(e,t,r,n){return n})==="object"}F(t,{reduce:function Ve(e){var t=$.ToObject(this);var r=G&&D(this)?Z(this,""):t;var n=r.length>>>0;if(!m(e)){throw new TypeError("Array.prototype.reduce callback must be a function")}if(n===0&&arguments.length===1){throw new TypeError("reduce of empty array with no initial value")}var a=0;var i;if(arguments.length>=2){i=arguments[1]}else{do{if(a in r){i=r[a++];break}if(++a>=n){throw new TypeError("reduce of empty array with no initial value")}}while(true)}for(;a<n;a++){if(a in r){i=e(i,r[a],a,t)}}return i}},!L);var X=false;if(t.reduceRight){X=typeof t.reduceRight.call("es5",function(e,t,r,n){return n})==="object"}F(t,{reduceRight:function We(e){var t=$.ToObject(this);var r=G&&D(this)?Z(this,""):t;var n=r.length>>>0;if(!m(e)){throw new TypeError("Array.prototype.reduceRight callback must be a function")}if(n===0&&arguments.length===1){throw new TypeError("reduceRight of empty array with no initial value")}var a;var i=n-1;if(arguments.length>=2){a=arguments[1]}else{do{if(i in r){a=r[i--];break}if(--i<0){throw new TypeError("reduceRight of empty array with no initial value")}}while(true)}if(i<0){return a}do{if(i in r){a=e(a,r[i],i,t)}}while(i--);return a}},!X);var Y=t.indexOf&&[0,1].indexOf(1,2)!==-1;F(t,{indexOf:function _e(e){var t=G&&D(this)?Z(this,""):$.ToObject(this);var r=t.length>>>0;if(r===0){return-1}var n=0;if(arguments.length>1){n=$.ToInteger(arguments[1])}n=n>=0?n:g(0,r+n);for(;n<r;n++){if(n in t&&t[n]===e){return n}}return-1}},Y);var q=t.lastIndexOf&&[0,1].lastIndexOf(0,-3)!==-1;F(t,{lastIndexOf:function et(e){var t=G&&D(this)?Z(this,""):$.ToObject(this);var r=t.length>>>0;if(r===0){return-1}var n=r-1;if(arguments.length>1){n=y(n,$.ToInteger(arguments[1]))}n=n>=0?n:r-Math.abs(n);for(;n>=0;n--){if(n in t&&e===t[n]){return n}}return-1}},q);var K=function(){var e=[1,2];var t=e.splice();return e.length===2&&J(t)&&t.length===0}();F(t,{splice:function tt(e,t){if(arguments.length===0){return[]}else{return s.apply(this,arguments)}}},!K);var Q=function(){var e={};t.splice.call(e,0,0,1);return e.length===1}();F(t,{splice:function rt(e,t){if(arguments.length===0){return[]}var r=arguments;this.length=g($.ToInteger(this.length),0);if(arguments.length>0&&typeof t!=="number"){r=f.call(arguments);if(r.length<2){c.call(r,this.length-e)}else{r[1]=$.ToInteger(t)}}return s.apply(this,r)}},!Q);var V=function(){var t=new e(1e5);t[8]="x";t.splice(1,1);return t.indexOf("x")===7}();var W=function(){var e=256;var t=[];t[e]="a";t.splice(e+1,0,"b");return t[e]==="a"}();F(t,{splice:function nt(e,t){var r=$.ToObject(this);var n=[];var a=$.ToUint32(r.length);var o=$.ToInteger(e);var l=o<0?g(a+o,0):y(o,a);var u=y(g($.ToInteger(t),0),a-l);var s=0;var c;while(s<u){c=i(l+s);if(U(r,c)){n[s]=r[c]}s+=1}var v=f.call(arguments,2);var p=v.length;var h;if(p<u){s=l;while(s<a-u){c=i(s+u);h=i(s+p);if(U(r,c)){r[h]=r[c]}else{delete r[h]}s+=1}s=a;while(s>a-u+p){delete r[s-1];s-=1}}else if(p>u){s=a-u;while(s>l){c=i(s+u-1);h=i(s+p-1);if(U(r,c)){r[h]=r[c]}else{delete r[h]}s-=1}}s=l;for(var d=0;d<v.length;++d){r[s]=v[d];s+=1}r.length=a-u+p;return n}},!V||!W);var _=!{toString:null}.propertyIsEnumerable("toString");var ee=function(){}.propertyIsEnumerable("prototype");var te=!U("x","0");var re=function(e){var t=e.constructor;return t&&t.prototype===e};var ne={$window:true,$console:true,$parent:true,$self:true,$frames:true,$frameElement:true,$webkitIndexedDB:true,$webkitStorageInfo:true};var ae=function(){if(typeof window==="undefined"){return false}for(var e in window){if(!ne["$"+e]&&U(window,e)&&window[e]!==null&&typeof window[e]==="object"){try{re(window[e])}catch(t){return true}}}return false}();var ie=function(e){if(typeof window==="undefined"||!ae){return re(e)}try{return re(e)}catch(t){return false}};var oe=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"];var le=oe.length;var ue=function at(e){var t=C(e);var r=t==="[object Arguments]";if(!r){r=!J(e)&&e!==null&&typeof e==="object"&&typeof e.length==="number"&&e.length>=0&&m(e.callee)}return r};F(r,{keys:function it(e){var t=m(e);var r=ue(e);var n=e!==null&&typeof e==="object";var a=n&&D(e);if(!n&&!t&&!r){throw new TypeError("Object.keys called on a non-object")}var o=[];var l=ee&&t;if(a&&te||r){for(var u=0;u<e.length;++u){c.call(o,i(u))}}if(!r){for(var f in e){if(!(l&&f==="prototype")&&U(e,f)){c.call(o,i(f))}}}if(_){var s=ie(e);for(var v=0;v<le;v++){var p=oe[v];if(!(s&&p==="constructor")&&U(e,p)){c.call(o,p)}}}return o}});var fe=r.keys&&function(){return r.keys(arguments).length===2}(1,2);var se=r.keys&&function(){var e=r.keys(arguments);return arguments.length!==1||e.length!==1||e[0]!==1}(1);var ce=r.keys;F(r,{keys:function ot(e){if(ue(e)){return ce(f.call(e))}else{return ce(e)}}},!fe||se);var ve=-621987552e5;var pe="-000001";var he=Date.prototype.toISOString&&new Date(ve).toISOString().indexOf(pe)===-1;var ge=Date.prototype.toISOString&&new Date(-1).toISOString()!=="1969-12-31T23:59:59.999Z";F(Date.prototype,{toISOString:function lt(){var e,t,r,n,a;if(!isFinite(this)){throw new RangeError("Date.prototype.toISOString called on non-finite value.")}n=this.getUTCFullYear();a=this.getUTCMonth();n+=Math.floor(a/12);a=(a%12+12)%12;e=[a+1,this.getUTCDate(),this.getUTCHours(),this.getUTCMinutes(),this.getUTCSeconds()];n=(n<0?"-":n>9999?"+":"")+P("00000"+Math.abs(n),0<=n&&n<=9999?-4:-6);t=e.length;while(t--){r=e[t];if(r<10){e[t]="0"+r}}return n+"-"+f.call(e,0,2).join("-")+"T"+f.call(e,2).join(":")+"."+P("000"+this.getUTCMilliseconds(),-3)+"Z"}},he||ge);var ye=function(){try{return Date.prototype.toJSON&&new Date(NaN).toJSON()===null&&new Date(ve).toJSON().indexOf(pe)!==-1&&Date.prototype.toJSON.call({toISOString:function(){return true}})}catch(e){return false}}();if(!ye){Date.prototype.toJSON=function ut(e){var t=r(this);var n=$.ToPrimitive(t);if(typeof n==="number"&&!isFinite(n)){return null}var a=t.toISOString;if(!m(a)){throw new TypeError("toISOString property is not callable")}return a.call(t)}}var de=Date.parse("+033658-09-27T01:46:40.000Z")===1e15;var we=!isNaN(Date.parse("2012-04-04T24:00:00.500Z"))||!isNaN(Date.parse("2012-11-31T23:59:59.000Z"))||!isNaN(Date.parse("2012-12-31T23:59:60.000Z"));var me=isNaN(Date.parse("2000-01-01T00:00:00.000Z"));if(me||we||!de){Date=function(e){var t=function s(r,n,a,o,l,u,f){var s=arguments.length;var c;if(this instanceof e){c=s===1&&i(r)===r?new e(t.parse(r)):s>=7?new e(r,n,a,o,l,u,f):s>=6?new e(r,n,a,o,l,u):s>=5?new e(r,n,a,o,l):s>=4?new e(r,n,a,o):s>=3?new e(r,n,a):s>=2?new e(r,n):s>=1?new e(r):new e}else{c=e.apply(this,arguments)}F(c,{constructor:t},true);return c};var r=new RegExp("^"+"(\\d{4}|[+-]\\d{6})"+"(?:-(\\d{2})"+"(?:-(\\d{2})"+"(?:"+"T(\\d{2})"+":(\\d{2})"+"(?:"+":(\\d{2})"+"(?:(\\.\\d{1,}))?"+")?"+"("+"Z|"+"(?:"+"([-+])"+"(\\d{2})"+":(\\d{2})"+")"+")?)?)?)?"+"$");var n=[0,31,59,90,120,151,181,212,243,273,304,334,365];var a=function c(e,t){var r=t>1?1:0;return n[t]+Math.floor((e-1969+r)/4)-Math.floor((e-1901+r)/100)+Math.floor((e-1601+r)/400)+365*(e-1970)};var o=function v(t){return l(new e(1970,0,1,0,0,0,t))};for(var u in e){if(U(e,u)){t[u]=e[u]}}F(t,{now:e.now,UTC:e.UTC},true);t.prototype=e.prototype;F(t.prototype,{constructor:t},true);var f=function p(t){var n=r.exec(t);if(n){var i=l(n[1]),u=l(n[2]||1)-1,f=l(n[3]||1)-1,s=l(n[4]||0),c=l(n[5]||0),v=l(n[6]||0),p=Math.floor(l(n[7]||0)*1e3),h=Boolean(n[4]&&!n[8]),g=n[9]==="-"?1:-1,y=l(n[10]||0),d=l(n[11]||0),w;if(s<(c>0||v>0||p>0?24:25)&&c<60&&v<60&&p<1e3&&u>-1&&u<12&&y<24&&d<60&&f>-1&&f<a(i,u+1)-a(i,u)){w=((a(i,u)+f)*24+s+y*g)*60;w=((w+c+d*g)*60+v)*1e3+p;if(h){w=o(w)}if(-864e13<=w&&w<=864e13){return w}}return NaN}return e.parse.apply(this,arguments)};F(t,{parse:f});return t}(Date)}if(!Date.now){Date.now=function ft(){return(new Date).getTime()}}var be=u.toFixed&&(8e-5.toFixed(3)!=="0.000"||.9.toFixed(0)!=="1"||1.255.toFixed(2)!=="1.25"||0xde0b6b3a7640080.toFixed(0)!=="1000000000000000128");var Te={base:1e7,size:6,data:[0,0,0,0,0,0],multiply:function st(e,t){var r=-1;var n=t;while(++r<Te.size){n+=e*Te.data[r];Te.data[r]=n%Te.base;n=Math.floor(n/Te.base)}},divide:function ct(e){var t=Te.size,r=0;while(--t>=0){r+=Te.data[t];Te.data[t]=Math.floor(r/e);r=r%e*Te.base}},numToString:function vt(){var e=Te.size;var t="";while(--e>=0){if(t!==""||e===0||Te.data[e]!==0){var r=i(Te.data[e]);if(t===""){t=r}else{t+=P("0000000",0,7-r.length)+r}}}return t},pow:function pt(e,t,r){return t===0?r:t%2===1?pt(e,t-1,r*e):pt(e*e,t/2,r)},log:function ht(e){var t=0;var r=e;while(r>=4096){t+=12;r/=4096}while(r>=2){t+=1;r/=2}return t}};F(u,{toFixed:function gt(e){var t,r,n,a,o,u,f,s;t=l(e);t=t!==t?0:Math.floor(t);if(t<0||t>20){throw new RangeError("Number.toFixed called with invalid number of decimals")}r=l(this);if(r!==r){return"NaN"}if(r<=-1e21||r>=1e21){return i(r)}n="";if(r<0){n="-";r=-r}a="0";if(r>1e-21){o=Te.log(r*Te.pow(2,69,1))-69;u=o<0?r*Te.pow(2,-o,1):r/Te.pow(2,o,1);u*=4503599627370496;o=52-o;if(o>0){Te.multiply(0,u);f=t;while(f>=7){Te.multiply(1e7,0);f-=7}Te.multiply(Te.pow(10,f,1),0);f=o-1;while(f>=23){Te.divide(1<<23);f-=23}Te.divide(1<<f);Te.multiply(1,1);Te.divide(2);a=Te.numToString()}else{Te.multiply(0,u);Te.multiply(1<<-o,0);a=Te.numToString()+P("0.00000000000000000000",2,2+t)}}if(t>0){s=a.length;if(s<=t){a=n+P("0.0000000000000000000",0,t-s+2)+a}else{a=n+P(a,0,s-t)+"."+P(a,s-t)}}else{a=n+a}return a}},be);if("ab".split(/(?:ab)*/).length!==2||".".split(/(.?)(.?)/).length!==4||"tesst".split(/(s)*/)[1]==="t"||"test".split(/(?:)/,-1).length!==4||"".split(/.?/).length||".".split(/()()/).length>1){(function(){var e=typeof/()??/.exec("")[1]==="undefined";o.split=function(t,r){var n=this;if(typeof t==="undefined"&&r===0){return[]}if(!S(t)){return Z(this,t,r)}var a=[];var i=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.unicode?"u":"")+(t.sticky?"y":""),o=0,l,u,s,v;var p=new RegExp(t.source,i+"g");n+="";if(!e){l=new RegExp("^"+p.source+"$(?!\\s)",i)}var h=typeof r==="undefined"?-1>>>0:$.ToUint32(r);u=p.exec(n);while(u){s=u.index+u[0].length;if(s>o){c.call(a,P(n,o,u.index));if(!e&&u.length>1){u[0].replace(l,function(){for(var e=1;e<arguments.length-2;e++){if(typeof arguments[e]==="undefined"){u[e]=void 0}}})}if(u.length>1&&u.index<n.length){c.apply(a,f.call(u,1))}v=u[0].length;o=s;if(a.length>=h){break}}if(p.lastIndex===u.index){p.lastIndex++}u=p.exec(n)}if(o===n.length){if(v||!p.test("")){c.call(a,"")}}else{c.call(a,P(n,o))}return a.length>h?P(a,0,h):a}})()}else if("0".split(void 0,0).length){o.split=function yt(e,t){if(typeof e==="undefined"&&t===0){return[]}return Z(this,e,t)}}var xe=o.replace;var Oe=function(){var e=[];"x".replace(/x(.)?/g,function(t,r){c.call(e,r)});return e.length===1&&typeof e[0]==="undefined"}();if(!Oe){o.replace=function dt(e,t){var r=m(t);var n=S(e)&&/\)[*?]/.test(e.source);if(!r||!n){return xe.call(this,e,t)}else{var a=function(r){var n=arguments.length;var a=e.lastIndex;e.lastIndex=0;var i=e.exec(r)||[];e.lastIndex=a;c.call(i,arguments[n-2],arguments[n-1]);return t.apply(this,i)};return xe.call(this,e,a)}}}var Se=o.substr;var je="".substr&&"0b".substr(-1)!=="b";F(o,{substr:function wt(e,t){var r=e;if(e<0){r=g(this.length+e,0)}return Se.call(this,r,t)}},je);var Ee="   \n\f\r \xa0\u1680\u180e\u2000\u2001\u2002\u2003"+"\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028"+"\u2029\ufeff";var Ie="\u200b";var De="["+Ee+"]";var ke=new RegExp("^"+De+De+"*");var Ne=new RegExp(De+De+"*$");var Me=o.trim&&(Ee.trim()||!Ie.trim());F(o,{trim:function mt(){if(typeof this==="undefined"||this===null){throw new TypeError("can't convert "+this+" to object")}return i(this).replace(ke,"").replace(Ne,"")}},Me);if(parseInt(Ee+"08")!==8||parseInt(Ee+"0x16")!==22){parseInt=function(e){var t=/^0[xX]/;return function r(n,a){var o=i(n).trim();var u=l(a)||(t.test(o)?16:10);return e(o,u)}}(parseInt)}});
//# sourceMappingURL=es5-shim.map

/*!
 * https://github.com/es-shims/es5-shim
 * @license es5-shim Copyright 2009-2015 by contributors, MIT License
 * see https://github.com/es-shims/es5-shim/blob/v4.1.11/LICENSE
 */
(function(e,t){"use strict";if(typeof define==="function"&&define.amd){define(t)}else if(typeof exports==="object"){module.exports=t()}else{e.returnExports=t()}})(this,function(){var e=Function.prototype.call;var t=Object.prototype;var r=e.bind(t.hasOwnProperty);var n=e.bind(t.propertyIsEnumerable);var o=e.bind(t.toString);var c;var i;var f;var a;var l=r(t,"__defineGetter__");if(l){c=e.bind(t.__defineGetter__);i=e.bind(t.__defineSetter__);f=e.bind(t.__lookupGetter__);a=e.bind(t.__lookupSetter__)}if(!Object.getPrototypeOf){Object.getPrototypeOf=function S(e){var r=e.__proto__;if(r||r===null){return r}else if(o(e.constructor)==="[object Function]"){return e.constructor.prototype}else if(!(e instanceof Object)){return null}else{return t}}}var u=function D(e){try{e.sentinel=0;return Object.getOwnPropertyDescriptor(e,"sentinel").value===0}catch(t){return false}};if(Object.defineProperty){var b=u({});var p=typeof document==="undefined"||u(document.createElement("div"));if(!p||!b){var s=Object.getOwnPropertyDescriptor}}if(!Object.getOwnPropertyDescriptor||s){var O="Object.getOwnPropertyDescriptor called on a non-object: ";Object.getOwnPropertyDescriptor=function F(e,o){if(typeof e!=="object"&&typeof e!=="function"||e===null){throw new TypeError(O+e)}if(s){try{return s.call(Object,e,o)}catch(c){}}var i;if(!r(e,o)){return i}i={enumerable:n(e,o),configurable:true};if(l){var u=e.__proto__;var b=e!==t;if(b){e.__proto__=t}var p=f(e,o);var j=a(e,o);if(b){e.__proto__=u}if(p||j){if(p){i.get=p}if(j){i.set=j}return i}}i.value=e[o];i.writable=true;return i}}if(!Object.getOwnPropertyNames){Object.getOwnPropertyNames=function k(e){return Object.keys(e)}}if(!Object.create){var j;var d=!({__proto__:null}instanceof Object);var y=function G(){if(!document.domain){return false}try{return!!new ActiveXObject("htmlfile")}catch(e){return false}};var _=function A(){var e;var t;t=new ActiveXObject("htmlfile");t.write("<script></script>");t.close();e=t.parentWindow.Object.prototype;t=null;return e};var v=function C(){var e=document.createElement("iframe");var t=document.body||document.documentElement;var r;e.style.display="none";t.appendChild(e);e.src="javascript:";r=e.contentWindow.Object.prototype;t.removeChild(e);e=null;return r};if(d||typeof document==="undefined"){j=function(){return{__proto__:null}}}else{j=function(){var e=y()?_():v();delete e.constructor;delete e.hasOwnProperty;delete e.propertyIsEnumerable;delete e.isPrototypeOf;delete e.toLocaleString;delete e.toString;delete e.valueOf;var t=function r(){};t.prototype=e;j=function(){return new t};return new t}}Object.create=function I(e,t){var r;var n=function o(){};if(e===null){r=j()}else{if(typeof e!=="object"&&typeof e!=="function"){throw new TypeError("Object prototype may only be an Object or null")}n.prototype=e;r=new n;r.__proto__=e}if(t!==void 0){Object.defineProperties(r,t)}return r}}var w=function N(e){try{Object.defineProperty(e,"sentinel",{});return"sentinel"in e}catch(t){return false}};if(Object.defineProperty){var h=w({});var m=typeof document==="undefined"||w(document.createElement("div"));if(!h||!m){var E=Object.defineProperty,P=Object.defineProperties}}if(!Object.defineProperty||E){var g="Property description must be an object: ";var T="Object.defineProperty called on non-object: ";var x="getters & setters can not be defined on this javascript engine";Object.defineProperty=function W(e,r,n){if(typeof e!=="object"&&typeof e!=="function"||e===null){throw new TypeError(T+e)}if(typeof n!=="object"&&typeof n!=="function"||n===null){throw new TypeError(g+n)}if(E){try{return E.call(Object,e,r,n)}catch(o){}}if("value"in n){if(l&&(f(e,r)||a(e,r))){var u=e.__proto__;e.__proto__=t;delete e[r];e[r]=n.value;e.__proto__=u}else{e[r]=n.value}}else{if(!l&&("get"in n||"set"in n)){throw new TypeError(x)}if("get"in n){c(e,r,n.get)}if("set"in n){i(e,r,n.set)}}return e}}if(!Object.defineProperties||P){Object.defineProperties=function X(e,t){if(P){try{return P.call(Object,e,t)}catch(r){}}Object.keys(t).forEach(function(r){if(r!=="__proto__"){Object.defineProperty(e,r,t[r])}});return e}}if(!Object.seal){Object.seal=function L(e){if(Object(e)!==e){throw new TypeError("Object.seal can only be called on Objects.")}return e}}if(!Object.freeze){Object.freeze=function q(e){if(Object(e)!==e){throw new TypeError("Object.freeze can only be called on Objects.")}return e}}try{Object.freeze(function(){})}catch(z){Object.freeze=function(e){return function t(r){if(typeof r==="function"){return r}else{return e(r)}}}(Object.freeze)}if(!Object.preventExtensions){Object.preventExtensions=function B(e){if(Object(e)!==e){throw new TypeError("Object.preventExtensions can only be called on Objects.")}return e}}if(!Object.isSealed){Object.isSealed=function H(e){if(Object(e)!==e){throw new TypeError("Object.isSealed can only be called on Objects.")}return false}}if(!Object.isFrozen){Object.isFrozen=function J(e){if(Object(e)!==e){throw new TypeError("Object.isFrozen can only be called on Objects.")}return false}}if(!Object.isExtensible){Object.isExtensible=function K(e){if(Object(e)!==e){throw new TypeError("Object.isExtensible can only be called on Objects.")}var t="";while(r(e,t)){t+="?"}e[t]=true;var n=r(e,t);delete e[t];return n}}});
//# sourceMappingURL=es5-sham.map


//Nunjunks js
// Browser bundle of nunjucks 1.3.3 
(function(){var modules={};(function(){"use strict";function extend(cls,name,props){var F=function(){};F.prototype=cls.prototype;var prototype=new F;var fnTest=/xyz/.test(function(){xyz})?/\bparent\b/:/.*/;props=props||{};for(var k in props){var src=props[k];var parent=prototype[k];if(typeof parent==="function"&&typeof src==="function"&&fnTest.test(src)){prototype[k]=function(src,parent){return function(){var tmp=this.parent;this.parent=parent;var res=src.apply(this,arguments);this.parent=tmp;return res}}(src,parent)}else{prototype[k]=src}}prototype.typename=name;var new_cls=function(){if(prototype.init){prototype.init.apply(this,arguments)}};new_cls.prototype=prototype;new_cls.prototype.constructor=new_cls;new_cls.extend=function(name,props){if(typeof name==="object"){props=name;name="anonymous"}return extend(new_cls,name,props)};return new_cls}modules["object"]=extend(Object,"Object",{})})();(function(){"use strict";var ArrayProto=Array.prototype;var ObjProto=Object.prototype;var escapeMap={"&":"&amp;",'"':"&quot;","'":"&#39;","<":"&lt;",">":"&gt;"};var escapeRegex=/[&"'<>]/g;var lookupEscape=function(ch){return escapeMap[ch]};var exports=modules["lib"]={};exports.withPrettyErrors=function(path,withInternals,func){try{return func()}catch(e){if(!e.Update){e=new exports.TemplateError(e)}e.Update(path);if(!withInternals){var old=e;e=new Error(old.message);e.name=old.name}throw e}};exports.TemplateError=function(message,lineno,colno){var err=this;if(message instanceof Error){err=message;message=message.name+": "+message.message}else{if(Error.captureStackTrace){Error.captureStackTrace(err)}}err.name="Template render error";err.message=message;err.lineno=lineno;err.colno=colno;err.firstUpdate=true;err.Update=function(path){var message="("+(path||"unknown path")+")";if(this.firstUpdate){if(this.lineno&&this.colno){message+=" [Line "+this.lineno+", Column "+this.colno+"]"}else if(this.lineno){message+=" [Line "+this.lineno+"]"}}message+="\n ";if(this.firstUpdate){message+=" "}this.message=message+(this.message||"");this.firstUpdate=false;return this};return err};exports.TemplateError.prototype=Error.prototype;exports.escape=function(val){return val.replace(escapeRegex,lookupEscape)};exports.isFunction=function(obj){return ObjProto.toString.call(obj)==="[object Function]"};exports.isArray=Array.isArray||function(obj){return ObjProto.toString.call(obj)==="[object Array]"};exports.isString=function(obj){return ObjProto.toString.call(obj)==="[object String]"};exports.isObject=function(obj){return ObjProto.toString.call(obj)==="[object Object]"};exports.groupBy=function(obj,val){var result={};var iterator=exports.isFunction(val)?val:function(obj){return obj[val]};for(var i=0;i<obj.length;i++){var value=obj[i];var key=iterator(value,i);(result[key]||(result[key]=[])).push(value)}return result};exports.toArray=function(obj){return Array.prototype.slice.call(obj)};exports.without=function(array){var result=[];if(!array){return result}var index=-1,length=array.length,contains=exports.toArray(arguments).slice(1);while(++index<length){if(exports.indexOf(contains,array[index])===-1){result.push(array[index])}}return result};exports.extend=function(obj,obj2){for(var k in obj2){obj[k]=obj2[k]}return obj};exports.repeat=function(char_,n){var str="";for(var i=0;i<n;i++){str+=char_}return str};exports.each=function(obj,func,context){if(obj==null){return}if(ArrayProto.each&&obj.each===ArrayProto.each){obj.forEach(func,context)}else if(obj.length===+obj.length){for(var i=0,l=obj.length;i<l;i++){func.call(context,obj[i],i,obj)}}};exports.map=function(obj,func){var results=[];if(obj==null){return results}if(ArrayProto.map&&obj.map===ArrayProto.map){return obj.map(func)}for(var i=0;i<obj.length;i++){results[results.length]=func(obj[i],i)}if(obj.length===+obj.length){results.length=obj.length}return results};exports.asyncIter=function(arr,iter,cb){var i=-1;function next(){i++;if(i<arr.length){iter(arr[i],i,next,cb)}else{cb()}}next()};exports.asyncFor=function(obj,iter,cb){var keys=exports.keys(obj);var len=keys.length;var i=-1;function next(){i++;var k=keys[i];if(i<len){iter(k,obj[k],i,len,next)}else{cb()}}next()};exports.indexOf=Array.prototype.indexOf?function(arr,searchElement,fromIndex){return Array.prototype.indexOf.call(arr,searchElement,fromIndex)}:function(arr,searchElement,fromIndex){var length=this.length>>>0;fromIndex=+fromIndex||0;if(Math.abs(fromIndex)===Infinity){fromIndex=0}if(fromIndex<0){fromIndex+=length;if(fromIndex<0){fromIndex=0}}for(;fromIndex<length;fromIndex++){if(arr[fromIndex]===searchElement){return fromIndex}}return-1};if(!Array.prototype.map){Array.prototype.map=function(){throw new Error("map is unimplemented for this js engine")}}exports.keys=function(obj){if(Object.prototype.keys){return obj.keys()}else{var keys=[];for(var k in obj){if(obj.hasOwnProperty(k)){keys.push(k)}}return keys}}})();(function(){"use strict";var util=modules["util"];var lib=modules["lib"];var Object=modules["object"];function traverseAndCheck(obj,type,results){if(obj instanceof type){results.push(obj)}if(obj instanceof Node){obj.findAll(type,results)}}var Node=Object.extend("Node",{init:function(lineno,colno){this.lineno=lineno;this.colno=colno;var fields=this.fields;for(var i=0,l=fields.length;i<l;i++){var field=fields[i];var val=arguments[i+2];if(val===undefined){val=null}this[field]=val}},findAll:function(type,results){results=results||[];if(this instanceof NodeList){var children=this.children;for(var i=0,l=children.length;i<l;i++){traverseAndCheck(children[i],type,results)}}else{var fields=this.fields;for(var i=0,l=fields.length;i<l;i++){traverseAndCheck(this[fields[i]],type,results)}}return results},iterFields:function(func){lib.each(this.fields,function(field){func(this[field],field)},this)}});var Value=Node.extend("Value",{fields:["value"]});var NodeList=Node.extend("NodeList",{fields:["children"],init:function(lineno,colno,nodes){this.parent(lineno,colno,nodes||[])},addChild:function(node){this.children.push(node)}});var Root=NodeList.extend("Root");var Literal=Value.extend("Literal");var Symbol=Value.extend("Symbol");var Group=NodeList.extend("Group");var Array=NodeList.extend("Array");var Pair=Node.extend("Pair",{fields:["key","value"]});var Dict=NodeList.extend("Dict");var LookupVal=Node.extend("LookupVal",{fields:["target","val"]});var If=Node.extend("If",{fields:["cond","body","else_"]});var IfAsync=If.extend("IfAsync");var InlineIf=Node.extend("InlineIf",{fields:["cond","body","else_"]});var For=Node.extend("For",{fields:["arr","name","body","else_"]});var AsyncEach=For.extend("AsyncEach");var AsyncAll=For.extend("AsyncAll");var Macro=Node.extend("Macro",{fields:["name","args","body"]});var Caller=Macro.extend("Caller");var Import=Node.extend("Import",{fields:["template","target","withContext"]});var FromImport=Node.extend("FromImport",{fields:["template","names","withContext"],init:function(lineno,colno,template,names,withContext){this.parent(lineno,colno,template,names||new NodeList,withContext)}});var FunCall=Node.extend("FunCall",{fields:["name","args"]});var Filter=FunCall.extend("Filter");var FilterAsync=Filter.extend("FilterAsync",{fields:["name","args","symbol"]});var KeywordArgs=Dict.extend("KeywordArgs");var Block=Node.extend("Block",{fields:["name","body"]});var Super=Node.extend("Super",{fields:["blockName","symbol"]});var TemplateRef=Node.extend("TemplateRef",{fields:["template"]});var Extends=TemplateRef.extend("Extends");var Include=TemplateRef.extend("Include");var Set=Node.extend("Set",{fields:["targets","value"]});var Output=NodeList.extend("Output");var TemplateData=Literal.extend("TemplateData");var UnaryOp=Node.extend("UnaryOp",{fields:["target"]});var BinOp=Node.extend("BinOp",{fields:["left","right"]});var In=BinOp.extend("In");var Or=BinOp.extend("Or");var And=BinOp.extend("And");var Not=UnaryOp.extend("Not");var Add=BinOp.extend("Add");var Sub=BinOp.extend("Sub");var Mul=BinOp.extend("Mul");var Div=BinOp.extend("Div");var FloorDiv=BinOp.extend("FloorDiv");var Mod=BinOp.extend("Mod");var Pow=BinOp.extend("Pow");var Neg=UnaryOp.extend("Neg");var Pos=UnaryOp.extend("Pos");var Compare=Node.extend("Compare",{fields:["expr","ops"]});var CompareOperand=Node.extend("CompareOperand",{fields:["expr","type"]});var CustomTag=Node.extend("CustomTag",{init:function(lineno,colno,name){this.lineno=lineno;this.colno=colno;this.name=name}});var CallExtension=Node.extend("CallExtension",{fields:["extName","prop","args","contentArgs"],init:function(ext,prop,args,contentArgs){this.extName=ext._name||ext;this.prop=prop;this.args=args||new NodeList;this.contentArgs=contentArgs||[];this.autoescape=ext.autoescape}});var CallExtensionAsync=CallExtension.extend("CallExtensionAsync");function printNodes(node,indent){indent=indent||0;function print(str,indent,inline){var lines=str.split("\n");for(var i=0;i<lines.length;i++){if(lines[i]){if(inline&&i>0||!inline){for(var j=0;j<indent;j++){util.print(" ")}}}if(i===lines.length-1){util.print(lines[i])}else{util.puts(lines[i])}}}print(node.typename+": ",indent);if(node instanceof NodeList){print("\n");lib.each(node.children,function(n){printNodes(n,indent+2)})}else if(node instanceof CallExtension){print(node.extName+"."+node.prop);print("\n");if(node.args){printNodes(node.args,indent+2)}if(node.contentArgs){lib.each(node.contentArgs,function(n){printNodes(n,indent+2)})}}else{var nodes=null;var props=null;node.iterFields(function(val,field){if(val instanceof Node){nodes=nodes||{};nodes[field]=val}else{props=props||{};props[field]=val}});if(props){print(util.inspect(props,true,null)+"\n",null,true)}else{print("\n")}if(nodes){for(var k in nodes){printNodes(nodes[k],indent+2)}}}}modules["nodes"]={Node:Node,Root:Root,NodeList:NodeList,Value:Value,Literal:Literal,Symbol:Symbol,Group:Group,Array:Array,Pair:Pair,Dict:Dict,Output:Output,TemplateData:TemplateData,If:If,IfAsync:IfAsync,InlineIf:InlineIf,For:For,AsyncEach:AsyncEach,AsyncAll:AsyncAll,Macro:Macro,Caller:Caller,Import:Import,FromImport:FromImport,FunCall:FunCall,Filter:Filter,FilterAsync:FilterAsync,KeywordArgs:KeywordArgs,Block:Block,Super:Super,Extends:Extends,Include:Include,Set:Set,LookupVal:LookupVal,BinOp:BinOp,In:In,Or:Or,And:And,Not:Not,Add:Add,Sub:Sub,Mul:Mul,Div:Div,FloorDiv:FloorDiv,Mod:Mod,Pow:Pow,Neg:Neg,Pos:Pos,Compare:Compare,CompareOperand:CompareOperand,CallExtension:CallExtension,CallExtensionAsync:CallExtensionAsync,printNodes:printNodes}})();(function(){"use strict";var lib=modules["lib"];var Obj=modules["object"];var Frame=Obj.extend({init:function(parent){this.variables={};this.parent=parent},set:function(name,val,resolveUp){var parts=name.split(".");var obj=this.variables;var frame=this;if(resolveUp){if(frame=this.resolve(parts[0])){frame.set(name,val);return}frame=this}for(var i=0;i<parts.length-1;i++){var id=parts[i];if(!obj[id]){obj[id]={}}obj=obj[id]}obj[parts[parts.length-1]]=val},get:function(name){var val=this.variables[name];if(val!==undefined&&val!==null){return val}return null},lookup:function(name){var p=this.parent;var val=this.variables[name];if(val!==undefined&&val!==null){return val}return p&&p.lookup(name)},resolve:function(name){var p=this.parent;var val=this.variables[name];if(val!==undefined&&val!==null){return this}return p&&p.resolve(name)},push:function(){return new Frame(this)},pop:function(){return this.parent}});function makeMacro(argNames,kwargNames,func){return function(){var argCount=numArgs(arguments);var args;var kwargs=getKeywordArgs(arguments);if(argCount>argNames.length){args=Array.prototype.slice.call(arguments,0,argNames.length);var vals=Array.prototype.slice.call(arguments,args.length,argCount);for(var i=0;i<vals.length;i++){if(i<kwargNames.length){kwargs[kwargNames[i]]=vals[i]}}args.push(kwargs)}else if(argCount<argNames.length){args=Array.prototype.slice.call(arguments,0,argCount);for(var i=argCount;i<argNames.length;i++){var arg=argNames[i];args.push(kwargs[arg]);delete kwargs[arg]}args.push(kwargs)}else{args=arguments}return func.apply(this,args)}}function makeKeywordArgs(obj){obj.__keywords=true;return obj}function getKeywordArgs(args){var len=args.length;if(len){var lastArg=args[len-1];if(lastArg&&lastArg.hasOwnProperty("__keywords")){return lastArg}}return{}}function numArgs(args){var len=args.length;if(len===0){return 0}var lastArg=args[len-1];if(lastArg&&lastArg.hasOwnProperty("__keywords")){return len-1}else{return len}}function SafeString(val){if(typeof val!=="string"){return val}this.val=val}SafeString.prototype=Object.create(String.prototype);SafeString.prototype.valueOf=function(){return this.val};SafeString.prototype.toString=function(){return this.val};function copySafeness(dest,target){if(dest instanceof SafeString){return new SafeString(target)}return target.toString()}function markSafe(val){var type=typeof val;if(type==="string"){return new SafeString(val)}else if(type!=="function"){return val}else{return function(){var ret=val.apply(this,arguments);if(typeof ret==="string"){return new SafeString(ret)}return ret}}}function suppressValue(val,autoescape){val=val!==undefined&&val!==null?val:"";if(autoescape&&typeof val==="string"){val=lib.escape(val)}return val}function memberLookup(obj,val){obj=obj||{};if(typeof obj[val]==="function"){return function(){return obj[val].apply(obj,arguments)}}return obj[val]}function callWrap(obj,name,args){if(!obj){throw new Error("Unable to call `"+name+"`, which is undefined or falsey")}else if(typeof obj!=="function"){throw new Error("Unable to call `"+name+"`, which is not a function")}return obj.apply(this,args)}function contextOrFrameLookup(context,frame,name){var val=frame.lookup(name);return val!==undefined&&val!==null?val:context.lookup(name)}function handleError(error,lineno,colno){if(error.lineno){return error}else{return new lib.TemplateError(error,lineno,colno)}}function asyncEach(arr,dimen,iter,cb){if(lib.isArray(arr)){var len=arr.length;lib.asyncIter(arr,function(item,i,next){switch(dimen){case 1:iter(item,i,len,next);break;case 2:iter(item[0],item[1],i,len,next);break;case 3:iter(item[0],item[1],item[2],i,len,next);break;default:item.push(i,next);iter.apply(this,item)}},cb)}else{lib.asyncFor(arr,function(key,val,i,len,next){iter(key,val,i,len,next)},cb)}}function asyncAll(arr,dimen,func,cb){var finished=0;var len;var outputArr;function done(i,output){finished++;outputArr[i]=output;if(finished===len){cb(null,outputArr.join(""))}}if(lib.isArray(arr)){len=arr.length;outputArr=new Array(len);if(len===0){cb(null,"")}else{for(var i=0;i<arr.length;i++){var item=arr[i];switch(dimen){case 1:func(item,i,len,done);break;case 2:func(item[0],item[1],i,len,done);break;case 3:func(item[0],item[1],item[2],i,len,done);break;default:item.push(i,done);func.apply(this,item)}}}}else{var keys=lib.keys(arr);len=keys.length;outputArr=new Array(len);if(len===0){cb(null,"")}else{for(var i=0;i<keys.length;i++){var k=keys[i];func(k,arr[k],i,len,done)}}}}modules["runtime"]={Frame:Frame,makeMacro:makeMacro,makeKeywordArgs:makeKeywordArgs,numArgs:numArgs,suppressValue:suppressValue,memberLookup:memberLookup,contextOrFrameLookup:contextOrFrameLookup,callWrap:callWrap,handleError:handleError,isArray:lib.isArray,keys:lib.keys,SafeString:SafeString,copySafeness:copySafeness,markSafe:markSafe,asyncEach:asyncEach,asyncAll:asyncAll}})();(function(){"use strict";var lib=modules["lib"];var whitespaceChars=" \n    \rÃƒÆ’Ã¢â‚¬Å¡ ";var delimChars="()[]{}%*-+/#,:|.<>=!";var intChars="0123456789";var BLOCK_START="{%";var BLOCK_END="%}";var VARIABLE_START="{{";var VARIABLE_END="}}";var COMMENT_START="{#";var COMMENT_END="#}";var TOKEN_STRING="string";var TOKEN_WHITESPACE="whitespace";var TOKEN_DATA="data";var TOKEN_BLOCK_START="block-start";var TOKEN_BLOCK_END="block-end";var TOKEN_VARIABLE_START="variable-start";var TOKEN_VARIABLE_END="variable-end";var TOKEN_COMMENT="comment";var TOKEN_LEFT_PAREN="left-paren";var TOKEN_RIGHT_PAREN="right-paren";var TOKEN_LEFT_BRACKET="left-bracket";var TOKEN_RIGHT_BRACKET="right-bracket";var TOKEN_LEFT_CURLY="left-curly";var TOKEN_RIGHT_CURLY="right-curly";var TOKEN_OPERATOR="operator";var TOKEN_COMMA="comma";var TOKEN_COLON="colon";var TOKEN_PIPE="pipe";var TOKEN_INT="int";var TOKEN_FLOAT="float";var TOKEN_BOOLEAN="boolean";var TOKEN_SYMBOL="symbol";var TOKEN_SPECIAL="special";var TOKEN_REGEX="regex";function token(type,value,lineno,colno){return{type:type,value:value,lineno:lineno,colno:colno}}function Tokenizer(str,opts){this.str=str;this.index=0;this.len=str.length;this.lineno=0;this.colno=0;this.in_code=false;opts=opts||{};var tags=opts.tags||{};this.tags={BLOCK_START:tags.blockStart||BLOCK_START,BLOCK_END:tags.blockEnd||BLOCK_END,VARIABLE_START:tags.variableStart||VARIABLE_START,VARIABLE_END:tags.variableEnd||VARIABLE_END,COMMENT_START:tags.commentStart||COMMENT_START,COMMENT_END:tags.commentEnd||COMMENT_END};this.trimBlocks=!!opts.trimBlocks;this.lstripBlocks=!!opts.lstripBlocks}Tokenizer.prototype.nextToken=function(){var lineno=this.lineno;var colno=this.colno;var tok;if(this.in_code){var cur=this.current();if(this.is_finished()){return null}else if(cur==='"'||cur==="'"){return token(TOKEN_STRING,this.parseString(cur),lineno,colno)}else if(tok=this._extract(whitespaceChars)){return token(TOKEN_WHITESPACE,tok,lineno,colno)}else if((tok=this._extractString(this.tags.BLOCK_END))||(tok=this._extractString("-"+this.tags.BLOCK_END))){this.in_code=false;if(this.trimBlocks){cur=this.current();if(cur==="\n"){this.forward()}}return token(TOKEN_BLOCK_END,tok,lineno,colno)}else if(tok=this._extractString(this.tags.VARIABLE_END)){this.in_code=false;return token(TOKEN_VARIABLE_END,tok,lineno,colno)}else if(cur==="r"&&this.str.charAt(this.index+1)==="/"){this.forwardN(2);var regexBody="";while(!this.is_finished()){if(this.current()==="/"&&this.previous()!=="\\"){this.forward();break}else{regexBody+=this.current();this.forward()}}var POSSIBLE_FLAGS=["g","i","m","y"];var regexFlags="";while(!this.is_finished()){var isCurrentAFlag=POSSIBLE_FLAGS.indexOf(this.current())!==-1;if(isCurrentAFlag){regexFlags+=this.current();this.forward()}else{break}}return token(TOKEN_REGEX,{body:regexBody,flags:regexFlags},lineno,colno)}else if(delimChars.indexOf(cur)!==-1){this.forward();var complexOps=["==","!=","<=",">=","//","**"];var curComplex=cur+this.current();var type;if(lib.indexOf(complexOps,curComplex)!==-1){this.forward();cur=curComplex}switch(cur){case"(":type=TOKEN_LEFT_PAREN;break;case")":type=TOKEN_RIGHT_PAREN;break;case"[":type=TOKEN_LEFT_BRACKET;break;case"]":type=TOKEN_RIGHT_BRACKET;break;case"{":type=TOKEN_LEFT_CURLY;break;case"}":type=TOKEN_RIGHT_CURLY;break;case",":type=TOKEN_COMMA;break;case":":type=TOKEN_COLON;break;case"|":type=TOKEN_PIPE;break;default:type=TOKEN_OPERATOR}return token(type,cur,lineno,colno)}else{tok=this._extractUntil(whitespaceChars+delimChars);if(tok.match(/^[-+]?[0-9]+$/)){if(this.current()==="."){this.forward();var dec=this._extract(intChars);return token(TOKEN_FLOAT,tok+"."+dec,lineno,colno)}else{return token(TOKEN_INT,tok,lineno,colno)}}else if(tok.match(/^(true|false)$/)){return token(TOKEN_BOOLEAN,tok,lineno,colno)}else if(tok){return token(TOKEN_SYMBOL,tok,lineno,colno)}else{throw new Error("Unexpected value while parsing: "+tok)}}}else{var beginChars=this.tags.BLOCK_START.charAt(0)+this.tags.VARIABLE_START.charAt(0)+this.tags.COMMENT_START.charAt(0)+this.tags.COMMENT_END.charAt(0);if(this.is_finished()){return null}else if((tok=this._extractString(this.tags.BLOCK_START+"-"))||(tok=this._extractString(this.tags.BLOCK_START))){this.in_code=true;return token(TOKEN_BLOCK_START,tok,lineno,colno)}else if(tok=this._extractString(this.tags.VARIABLE_START)){this.in_code=true;return token(TOKEN_VARIABLE_START,tok,lineno,colno)}else{tok="";var data;var in_comment=false;if(this._matches(this.tags.COMMENT_START)){in_comment=true;tok=this._extractString(this.tags.COMMENT_START)}while((data=this._extractUntil(beginChars))!==null){tok+=data;if((this._matches(this.tags.BLOCK_START)||this._matches(this.tags.VARIABLE_START)||this._matches(this.tags.COMMENT_START))&&!in_comment){if(this.lstripBlocks&&this._matches(this.tags.BLOCK_START)&&this.colno>0&&this.colno<=tok.length){var lastLine=tok.slice(-this.colno);if(/^\s+$/.test(lastLine)){tok=tok.slice(0,-this.colno);if(!tok.length){return this.nextToken()}}}break}else if(this._matches(this.tags.COMMENT_END)){if(!in_comment){throw new Error("unexpected end of comment")}tok+=this._extractString(this.tags.COMMENT_END);break}else{tok+=this.current();this.forward()}}if(data===null&&in_comment){throw new Error("expected end of comment, got end of file")}return token(in_comment?TOKEN_COMMENT:TOKEN_DATA,tok,lineno,colno)}}throw new Error("Could not parse text")};Tokenizer.prototype.parseString=function(delimiter){this.forward();var lineno=this.lineno;var colno=this.colno;var str="";while(!this.is_finished()&&this.current()!==delimiter){var cur=this.current();if(cur==="\\"){this.forward();switch(this.current()){case"n":str+="\n";break;case"t":str+="    ";break;case"r":str+="\r";break;default:str+=this.current()}this.forward()}else{str+=cur;this.forward()}}this.forward();return str};Tokenizer.prototype._matches=function(str){if(this.index+str.length>this.len){return null}var m=this.str.slice(this.index,this.index+str.length);return m===str};Tokenizer.prototype._extractString=function(str){if(this._matches(str)){this.index+=str.length;return str}return null};Tokenizer.prototype._extractUntil=function(charString){return this._extractMatching(true,charString||"")};Tokenizer.prototype._extract=function(charString){return this._extractMatching(false,charString)};Tokenizer.prototype._extractMatching=function(breakOnMatch,charString){if(this.is_finished()){return null}var first=charString.indexOf(this.current());if(breakOnMatch&&first===-1||!breakOnMatch&&first!==-1){var t=this.current();this.forward();var idx=charString.indexOf(this.current());while((breakOnMatch&&idx===-1||!breakOnMatch&&idx!==-1)&&!this.is_finished()){t+=this.current();this.forward();idx=charString.indexOf(this.current())}return t}return""};Tokenizer.prototype.is_finished=function(){return this.index>=this.len};Tokenizer.prototype.forwardN=function(n){for(var i=0;i<n;i++){this.forward()}};Tokenizer.prototype.forward=function(){this.index++;if(this.previous()==="\n"){this.lineno++;this.colno=0}else{this.colno++}};Tokenizer.prototype.back=function(){this.index--;if(this.current()==="\n"){this.lineno--;var idx=this.src.lastIndexOf("\n",this.index-1);if(idx===-1){this.colno=this.index}else{this.colno=this.index-idx}}else{this.colno--}};Tokenizer.prototype.current=function(){if(!this.is_finished()){return this.str.charAt(this.index)}return""};Tokenizer.prototype.previous=function(){return this.str.charAt(this.index-1)};modules["lexer"]={lex:function(src,opts){return new Tokenizer(src,opts)},TOKEN_STRING:TOKEN_STRING,TOKEN_WHITESPACE:TOKEN_WHITESPACE,TOKEN_DATA:TOKEN_DATA,TOKEN_BLOCK_START:TOKEN_BLOCK_START,TOKEN_BLOCK_END:TOKEN_BLOCK_END,TOKEN_VARIABLE_START:TOKEN_VARIABLE_START,TOKEN_VARIABLE_END:TOKEN_VARIABLE_END,TOKEN_COMMENT:TOKEN_COMMENT,TOKEN_LEFT_PAREN:TOKEN_LEFT_PAREN,TOKEN_RIGHT_PAREN:TOKEN_RIGHT_PAREN,TOKEN_LEFT_BRACKET:TOKEN_LEFT_BRACKET,TOKEN_RIGHT_BRACKET:TOKEN_RIGHT_BRACKET,TOKEN_LEFT_CURLY:TOKEN_LEFT_CURLY,TOKEN_RIGHT_CURLY:TOKEN_RIGHT_CURLY,TOKEN_OPERATOR:TOKEN_OPERATOR,TOKEN_COMMA:TOKEN_COMMA,TOKEN_COLON:TOKEN_COLON,TOKEN_PIPE:TOKEN_PIPE,TOKEN_INT:TOKEN_INT,TOKEN_FLOAT:TOKEN_FLOAT,TOKEN_BOOLEAN:TOKEN_BOOLEAN,TOKEN_SYMBOL:TOKEN_SYMBOL,TOKEN_SPECIAL:TOKEN_SPECIAL,TOKEN_REGEX:TOKEN_REGEX}})();(function(){"use strict";var lexer=modules["lexer"];var nodes=modules["nodes"];var Object=modules["object"];var lib=modules["lib"];var Parser=Object.extend({init:function(tokens){this.tokens=tokens;this.peeked=null;this.breakOnBlocks=null;this.dropLeadingWhitespace=false;this.extensions=[]},nextToken:function(withWhitespace){var tok;if(this.peeked){if(!withWhitespace&&this.peeked.type===lexer.TOKEN_WHITESPACE){this.peeked=null}else{tok=this.peeked;this.peeked=null;return tok}}tok=this.tokens.nextToken();if(!withWhitespace){while(tok&&tok.type===lexer.TOKEN_WHITESPACE){tok=this.tokens.nextToken()}}return tok},peekToken:function(){this.peeked=this.peeked||this.nextToken();return this.peeked},pushToken:function(tok){if(this.peeked){throw new Error("pushToken: can only push one token on between reads")}this.peeked=tok},fail:function(msg,lineno,colno){if((lineno===undefined||colno===undefined)&&this.peekToken()){var tok=this.peekToken();lineno=tok.lineno;colno=tok.colno}if(lineno!==undefined)lineno+=1;if(colno!==undefined)colno+=1;throw new lib.TemplateError(msg,lineno,colno)},skip:function(type){var tok=this.nextToken();if(!tok||tok.type!==type){this.pushToken(tok);return false}return true},expect:function(type){var tok=this.nextToken();if(tok.type!==type){this.fail("expected "+type+", got "+tok.type,tok.lineno,tok.colno)}return tok},skipValue:function(type,val){var tok=this.nextToken();if(!tok||tok.type!==type||tok.value!==val){this.pushToken(tok);return false}return true},skipWhitespace:function(){return this.skip(lexer.TOKEN_WHITESPACE)},skipSymbol:function(val){return this.skipValue(lexer.TOKEN_SYMBOL,val)},advanceAfterBlockEnd:function(name){if(!name){var tok=this.peekToken();if(!tok){this.fail("unexpected end of file")}if(tok.type!==lexer.TOKEN_SYMBOL){this.fail("advanceAfterBlockEnd: expected symbol token or "+"explicit name to be passed")}name=this.nextToken().value}var tok=this.nextToken();if(tok&&tok.type===lexer.TOKEN_BLOCK_END){if(tok.value.charAt(0)==="-"){this.dropLeadingWhitespace=true}}else{this.fail("expected block end in "+name+" statement")}},advanceAfterVariableEnd:function(){if(!this.skip(lexer.TOKEN_VARIABLE_END)){this.fail("expected variable end")}},parseFor:function(){var forTok=this.peekToken();var node;var endBlock;if(this.skipSymbol("for")){node=new nodes.For(forTok.lineno,forTok.colno);endBlock="endfor"}else if(this.skipSymbol("asyncEach")){node=new nodes.AsyncEach(forTok.lineno,forTok.colno);endBlock="endeach"}else if(this.skipSymbol("asyncAll")){node=new nodes.AsyncAll(forTok.lineno,forTok.colno);endBlock="endall"}else{this.fail("parseFor: expected for{Async}",forTok.lineno,forTok.colno)}node.name=this.parsePrimary();if(!(node.name instanceof nodes.Symbol)){this.fail("parseFor: variable name expected for loop")}var type=this.peekToken().type;if(type===lexer.TOKEN_COMMA){var key=node.name;node.name=new nodes.Array(key.lineno,key.colno);node.name.addChild(key);while(this.skip(lexer.TOKEN_COMMA)){var prim=this.parsePrimary();node.name.addChild(prim)}}if(!this.skipSymbol("in")){this.fail('parseFor: expected "in" keyword for loop',forTok.lineno,forTok.colno)}node.arr=this.parseExpression();this.advanceAfterBlockEnd(forTok.value);node.body=this.parseUntilBlocks(endBlock,"else");if(this.skipSymbol("else")){this.advanceAfterBlockEnd("else");node.else_=this.parseUntilBlocks(endBlock)}this.advanceAfterBlockEnd();return node},parseMacro:function(){var macroTok=this.peekToken();if(!this.skipSymbol("macro")){this.fail("expected macro")}var name=this.parsePrimary(true);var args=this.parseSignature();var node=new nodes.Macro(macroTok.lineno,macroTok.colno,name,args);this.advanceAfterBlockEnd(macroTok.value);node.body=this.parseUntilBlocks("endmacro");this.advanceAfterBlockEnd();return node},parseCall:function(){var callTok=this.peekToken();if(!this.skipSymbol("call")){this.fail("expected call")}var callerArgs=this.parseSignature(true)||new nodes.NodeList;var macroCall=this.parsePrimary();this.advanceAfterBlockEnd(callTok.value);var body=this.parseUntilBlocks("endcall");this.advanceAfterBlockEnd();var callerName=new nodes.Symbol(callTok.lineno,callTok.colno,"caller");var callerNode=new nodes.Caller(callTok.lineno,callTok.colno,callerName,callerArgs,body);var args=macroCall.args.children;if(!(args[args.length-1]instanceof nodes.KeywordArgs)){args.push(new nodes.KeywordArgs)}var kwargs=args[args.length-1];kwargs.addChild(new nodes.Pair(callTok.lineno,callTok.colno,callerName,callerNode));return new nodes.Output(callTok.lineno,callTok.colno,[macroCall])},parseWithContext:function(){var tok=this.peekToken();var withContext=null;if(this.skipSymbol("with")){withContext=true}else if(this.skipSymbol("without")){withContext=false}if(withContext!==null){if(!this.skipSymbol("context")){this.fail("parseFrom: expected context after with/without",tok.lineno,tok.colno)}}return withContext},parseImport:function(){var importTok=this.peekToken();if(!this.skipSymbol("import")){this.fail("parseImport: expected import",importTok.lineno,importTok.colno)}var template=this.parseExpression();if(!this.skipSymbol("as")){this.fail('parseImport: expected "as" keyword',importTok.lineno,importTok.colno)}var target=this.parsePrimary();var withContext=this.parseWithContext();var node=new nodes.Import(importTok.lineno,importTok.colno,template,target,withContext);this.advanceAfterBlockEnd(importTok.value);return node},parseFrom:function(){var fromTok=this.peekToken();if(!this.skipSymbol("from")){this.fail("parseFrom: expected from")}var template=this.parsePrimary();if(!this.skipSymbol("import")){this.fail("parseFrom: expected import",fromTok.lineno,fromTok.colno)}var names=new nodes.NodeList,withContext;while(1){var nextTok=this.peekToken();if(nextTok.type===lexer.TOKEN_BLOCK_END){if(!names.children.length){this.fail("parseFrom: Expected at least one import name",fromTok.lineno,fromTok.colno)}if(nextTok.value.charAt(0)==="-"){this.dropLeadingWhitespace=true}this.nextToken();break}if(names.children.length>0&&!this.skip(lexer.TOKEN_COMMA)){this.fail("parseFrom: expected comma",fromTok.lineno,fromTok.colno)}var name=this.parsePrimary();if(name.value.charAt(0)==="_"){this.fail("parseFrom: names starting with an underscore "+"cannot be imported",name.lineno,name.colno)}if(this.skipSymbol("as")){var alias=this.parsePrimary();names.addChild(new nodes.Pair(name.lineno,name.colno,name,alias))}else{names.addChild(name)}withContext=this.parseWithContext()}return new nodes.FromImport(fromTok.lineno,fromTok.colno,template,names,withContext)},parseBlock:function(){var tag=this.peekToken();if(!this.skipSymbol("block")){this.fail("parseBlock: expected block",tag.lineno,tag.colno)}var node=new nodes.Block(tag.lineno,tag.colno);node.name=this.parsePrimary();if(!(node.name instanceof nodes.Symbol)){this.fail("parseBlock: variable name expected",tag.lineno,tag.colno)}this.advanceAfterBlockEnd(tag.value);node.body=this.parseUntilBlocks("endblock");if(!this.peekToken()){this.fail("parseBlock: expected endblock, got end of file")}this.advanceAfterBlockEnd();return node},parseTemplateRef:function(tagName,nodeType){var tag=this.peekToken();if(!this.skipSymbol(tagName)){this.fail("parseTemplateRef: expected "+tagName)}var node=new nodeType(tag.lineno,tag.colno);node.template=this.parseExpression();this.advanceAfterBlockEnd(tag.value);return node},parseExtends:function(){return this.parseTemplateRef("extends",nodes.Extends)},parseInclude:function(){return this.parseTemplateRef("include",nodes.Include)},parseIf:function(){var tag=this.peekToken();var node;if(this.skipSymbol("if")||this.skipSymbol("elif")){node=new nodes.If(tag.lineno,tag.colno)}else if(this.skipSymbol("ifAsync")){node=new nodes.IfAsync(tag.lineno,tag.colno)}else{this.fail("parseIf: expected if or elif",tag.lineno,tag.colno)}node.cond=this.parseExpression();this.advanceAfterBlockEnd(tag.value);node.body=this.parseUntilBlocks("elif","else","endif");var tok=this.peekToken();switch(tok&&tok.value){case"elif":node.else_=this.parseIf();break;case"else":this.advanceAfterBlockEnd();node.else_=this.parseUntilBlocks("endif");this.advanceAfterBlockEnd();break;case"endif":node.else_=null;this.advanceAfterBlockEnd();break;default:this.fail("parseIf: expected endif, else, or endif, "+"got end of file")}return node},parseSet:function(){var tag=this.peekToken();if(!this.skipSymbol("set")){this.fail("parseSet: expected set",tag.lineno,tag.colno)}var node=new nodes.Set(tag.lineno,tag.colno,[]);var target;
while(target=this.parsePrimary()){node.targets.push(target);if(!this.skip(lexer.TOKEN_COMMA)){break}}if(!this.skipValue(lexer.TOKEN_OPERATOR,"=")){this.fail("parseSet: expected = in set tag",tag.lineno,tag.colno)}node.value=this.parseExpression();this.advanceAfterBlockEnd(tag.value);return node},parseStatement:function(){var tok=this.peekToken();var node;if(tok.type!==lexer.TOKEN_SYMBOL){this.fail("tag name expected",tok.lineno,tok.colno)}if(this.breakOnBlocks&&lib.indexOf(this.breakOnBlocks,tok.value)!==-1){return null}switch(tok.value){case"raw":return this.parseRaw();case"if":case"ifAsync":return this.parseIf();case"for":case"asyncEach":case"asyncAll":return this.parseFor();case"block":return this.parseBlock();case"extends":return this.parseExtends();case"include":return this.parseInclude();case"set":return this.parseSet();case"macro":return this.parseMacro();case"call":return this.parseCall();case"import":return this.parseImport();case"from":return this.parseFrom();default:if(this.extensions.length){for(var i=0;i<this.extensions.length;i++){var ext=this.extensions[i];if(lib.indexOf(ext.tags||[],tok.value)!==-1){return ext.parse(this,nodes,lexer)}}}this.fail("unknown block tag: "+tok.value,tok.lineno,tok.colno)}return node},parseRaw:function(){this.advanceAfterBlockEnd();var str="";var begun=this.peekToken();while(1){var tok=this.nextToken(true);if(!tok){this.fail("expected endraw, got end of file")}if(tok.type===lexer.TOKEN_BLOCK_START){var ws=null;var name=this.nextToken(true);if(name.type===lexer.TOKEN_WHITESPACE){ws=name;name=this.nextToken()}if(name.type===lexer.TOKEN_SYMBOL&&name.value==="endraw"){this.advanceAfterBlockEnd(name.value);break}else{str+=tok.value;if(ws){str+=ws.value}str+=name.value}}else if(tok.type===lexer.TOKEN_STRING){str+='"'+tok.value+'"'}else{str+=tok.value}}var output=new nodes.Output(begun.lineno,begun.colno,[new nodes.TemplateData(begun.lineno,begun.colno,str)]);return output},parsePostfix:function(node){var tok=this.peekToken();while(tok){if(tok.type===lexer.TOKEN_LEFT_PAREN){node=new nodes.FunCall(tok.lineno,tok.colno,node,this.parseSignature())}else if(tok.type===lexer.TOKEN_LEFT_BRACKET){var lookup=this.parseAggregate();if(lookup.children.length>1){this.fail("invalid index")}node=new nodes.LookupVal(tok.lineno,tok.colno,node,lookup.children[0])}else if(tok.type===lexer.TOKEN_OPERATOR&&tok.value==="."){this.nextToken();var val=this.nextToken();if(val.type!==lexer.TOKEN_SYMBOL){this.fail("expected name as lookup value, got "+val.value,val.lineno,val.colno)}var lookup=new nodes.Literal(val.lineno,val.colno,val.value);node=new nodes.LookupVal(tok.lineno,tok.colno,node,lookup)}else{break}tok=this.peekToken()}return node},parseExpression:function(){var node=this.parseInlineIf();return node},parseInlineIf:function(){var node=this.parseOr();if(this.skipSymbol("if")){var cond_node=this.parseOr();var body_node=node;node=new nodes.InlineIf(node.lineno,node.colno);node.body=body_node;node.cond=cond_node;if(this.skipSymbol("else")){node.else_=this.parseOr()}else{node.else_=null}}return node},parseOr:function(){var node=this.parseAnd();while(this.skipSymbol("or")){var node2=this.parseAnd();node=new nodes.Or(node.lineno,node.colno,node,node2)}return node},parseAnd:function(){var node=this.parseNot();while(this.skipSymbol("and")){var node2=this.parseNot();node=new nodes.And(node.lineno,node.colno,node,node2)}return node},parseNot:function(){var tok=this.peekToken();if(this.skipSymbol("not")){return new nodes.Not(tok.lineno,tok.colno,this.parseNot())}return this.parseIn()},parseIn:function(){var node=this.parseCompare();while(1){var tok=this.nextToken();if(!tok){break}var invert=tok.type===lexer.TOKEN_SYMBOL&&tok.value==="not";if(!invert){this.pushToken(tok)}if(this.skipSymbol("in")){var node2=this.parseCompare();node=new nodes.In(node.lineno,node.colno,node,node2);if(invert){node=new nodes.Not(node.lineno,node.colno,node)}}else{if(invert){this.pushToken(tok)}break}}return node},parseCompare:function(){var compareOps=["==","!=","<",">","<=",">="];var expr=this.parseAdd();var ops=[];while(1){var tok=this.nextToken();if(!tok){break}else if(lib.indexOf(compareOps,tok.value)!==-1){ops.push(new nodes.CompareOperand(tok.lineno,tok.colno,this.parseAdd(),tok.value))}else{this.pushToken(tok);break}}if(ops.length){return new nodes.Compare(ops[0].lineno,ops[0].colno,expr,ops)}else{return expr}},parseAdd:function(){var node=this.parseSub();while(this.skipValue(lexer.TOKEN_OPERATOR,"+")){var node2=this.parseSub();node=new nodes.Add(node.lineno,node.colno,node,node2)}return node},parseSub:function(){var node=this.parseMul();while(this.skipValue(lexer.TOKEN_OPERATOR,"-")){var node2=this.parseMul();node=new nodes.Sub(node.lineno,node.colno,node,node2)}return node},parseMul:function(){var node=this.parseDiv();while(this.skipValue(lexer.TOKEN_OPERATOR,"*")){var node2=this.parseDiv();node=new nodes.Mul(node.lineno,node.colno,node,node2)}return node},parseDiv:function(){var node=this.parseFloorDiv();while(this.skipValue(lexer.TOKEN_OPERATOR,"/")){var node2=this.parseFloorDiv();node=new nodes.Div(node.lineno,node.colno,node,node2)}return node},parseFloorDiv:function(){var node=this.parseMod();while(this.skipValue(lexer.TOKEN_OPERATOR,"//")){var node2=this.parseMod();node=new nodes.FloorDiv(node.lineno,node.colno,node,node2)}return node},parseMod:function(){var node=this.parsePow();while(this.skipValue(lexer.TOKEN_OPERATOR,"%")){var node2=this.parsePow();node=new nodes.Mod(node.lineno,node.colno,node,node2)}return node},parsePow:function(){var node=this.parseUnary();while(this.skipValue(lexer.TOKEN_OPERATOR,"**")){var node2=this.parseUnary();node=new nodes.Pow(node.lineno,node.colno,node,node2)}return node},parseUnary:function(noFilters){var tok=this.peekToken();var node;if(this.skipValue(lexer.TOKEN_OPERATOR,"-")){node=new nodes.Neg(tok.lineno,tok.colno,this.parseUnary(true))}else if(this.skipValue(lexer.TOKEN_OPERATOR,"+")){node=new nodes.Pos(tok.lineno,tok.colno,this.parseUnary(true))}else{node=this.parsePrimary()}if(!noFilters){node=this.parseFilter(node)}return node},parsePrimary:function(noPostfix){var tok=this.nextToken();var val=null;var node=null;if(!tok){this.fail("expected expression, got end of file")}else if(tok.type===lexer.TOKEN_STRING){val=tok.value}else if(tok.type===lexer.TOKEN_INT){val=parseInt(tok.value,10)}else if(tok.type===lexer.TOKEN_FLOAT){val=parseFloat(tok.value)}else if(tok.type===lexer.TOKEN_BOOLEAN){if(tok.value==="true"){val=true}else if(tok.value==="false"){val=false}else{this.fail("invalid boolean: "+tok.value,tok.lineno,tok.colno)}}else if(tok.type===lexer.TOKEN_REGEX){val=new RegExp(tok.value.body,tok.value.flags)}if(val!==null){node=new nodes.Literal(tok.lineno,tok.colno,val)}else if(tok.type===lexer.TOKEN_SYMBOL){node=new nodes.Symbol(tok.lineno,tok.colno,tok.value);if(!noPostfix){node=this.parsePostfix(node)}}else{this.pushToken(tok);node=this.parseAggregate()}if(node){return node}else{this.fail("unexpected token: "+tok.value,tok.lineno,tok.colno)}},parseFilter:function(node){while(this.skip(lexer.TOKEN_PIPE)){var tok=this.expect(lexer.TOKEN_SYMBOL);var name=tok.value;while(this.skipValue(lexer.TOKEN_OPERATOR,".")){name+="."+this.expect(lexer.TOKEN_SYMBOL).value}node=new nodes.Filter(tok.lineno,tok.colno,new nodes.Symbol(tok.lineno,tok.colno,name),new nodes.NodeList(tok.lineno,tok.colno,[node]));if(this.peekToken().type===lexer.TOKEN_LEFT_PAREN){var call=this.parsePostfix(node);node.args.children=node.args.children.concat(call.args.children)}}return node},parseAggregate:function(){var tok=this.nextToken();var node;switch(tok.type){case lexer.TOKEN_LEFT_PAREN:node=new nodes.Group(tok.lineno,tok.colno);break;case lexer.TOKEN_LEFT_BRACKET:node=new nodes.Array(tok.lineno,tok.colno);break;case lexer.TOKEN_LEFT_CURLY:node=new nodes.Dict(tok.lineno,tok.colno);break;default:return null}while(1){var type=this.peekToken().type;if(type===lexer.TOKEN_RIGHT_PAREN||type===lexer.TOKEN_RIGHT_BRACKET||type===lexer.TOKEN_RIGHT_CURLY){this.nextToken();break}if(node.children.length>0){if(!this.skip(lexer.TOKEN_COMMA)){this.fail("parseAggregate: expected comma after expression",tok.lineno,tok.colno)}}if(node instanceof nodes.Dict){var key=this.parsePrimary();if(!this.skip(lexer.TOKEN_COLON)){this.fail("parseAggregate: expected colon after dict key",tok.lineno,tok.colno)}var value=this.parseExpression();node.addChild(new nodes.Pair(key.lineno,key.colno,key,value))}else{var expr=this.parseExpression();node.addChild(expr)}}return node},parseSignature:function(tolerant,noParens){var tok=this.peekToken();if(!noParens&&tok.type!==lexer.TOKEN_LEFT_PAREN){if(tolerant){return null}else{this.fail("expected arguments",tok.lineno,tok.colno)}}if(tok.type===lexer.TOKEN_LEFT_PAREN){tok=this.nextToken()}var args=new nodes.NodeList(tok.lineno,tok.colno);var kwargs=new nodes.KeywordArgs(tok.lineno,tok.colno);var kwnames=[];var checkComma=false;while(1){tok=this.peekToken();if(!noParens&&tok.type===lexer.TOKEN_RIGHT_PAREN){this.nextToken();break}else if(noParens&&tok.type===lexer.TOKEN_BLOCK_END){break}if(checkComma&&!this.skip(lexer.TOKEN_COMMA)){this.fail("parseSignature: expected comma after expression",tok.lineno,tok.colno)}else{var arg=this.parseExpression();if(this.skipValue(lexer.TOKEN_OPERATOR,"=")){kwargs.addChild(new nodes.Pair(arg.lineno,arg.colno,arg,this.parseExpression()))}else{args.addChild(arg)}}checkComma=true}if(kwargs.children.length){args.addChild(kwargs)}return args},parseUntilBlocks:function(){var prev=this.breakOnBlocks;this.breakOnBlocks=lib.toArray(arguments);var ret=this.parse();this.breakOnBlocks=prev;return ret},parseNodes:function(){var tok;var buf=[];while(tok=this.nextToken()){if(tok.type===lexer.TOKEN_DATA){var data=tok.value;var nextToken=this.peekToken();var nextVal=nextToken&&nextToken.value;if(this.dropLeadingWhitespace){data=data.replace(/^\s*/,"");this.dropLeadingWhitespace=false}if(nextToken&&nextToken.type===lexer.TOKEN_BLOCK_START&&nextVal.charAt(nextVal.length-1)==="-"){data=data.replace(/\s*$/,"")}buf.push(new nodes.Output(tok.lineno,tok.colno,[new nodes.TemplateData(tok.lineno,tok.colno,data)]))}else if(tok.type===lexer.TOKEN_BLOCK_START){var n=this.parseStatement();if(!n){break}buf.push(n)}else if(tok.type===lexer.TOKEN_VARIABLE_START){var e=this.parseExpression();this.advanceAfterVariableEnd();buf.push(new nodes.Output(tok.lineno,tok.colno,[e]))}else if(tok.type!==lexer.TOKEN_COMMENT){this.fail("Unexpected token at top-level: "+tok.type,tok.lineno,tok.colno)}}return buf},parse:function(){return new nodes.NodeList(0,0,this.parseNodes())},parseAsRoot:function(){return new nodes.Root(0,0,this.parseNodes())}});modules["parser"]={parse:function(src,extensions,opts){var p=new Parser(lexer.lex(src,opts));if(extensions!==undefined){p.extensions=extensions}return p.parseAsRoot()}}})();(function(){"use strict";var nodes=modules["nodes"];var lib=modules["lib"];var sym=0;function gensym(){return"hole_"+sym++}function mapCOW(arr,func){var res=null;for(var i=0;i<arr.length;i++){var item=func(arr[i]);if(item!==arr[i]){if(!res){res=arr.slice()}res[i]=item}}return res||arr}function walk(ast,func,depthFirst){if(!(ast instanceof nodes.Node)){return ast}if(!depthFirst){var astT=func(ast);if(astT&&astT!==ast){return astT}}if(ast instanceof nodes.NodeList){var children=mapCOW(ast.children,function(node){return walk(node,func,depthFirst)});if(children!==ast.children){ast=new nodes[ast.typename](ast.lineno,ast.colno,children)}}else if(ast instanceof nodes.CallExtension){var args=walk(ast.args,func,depthFirst);var contentArgs=mapCOW(ast.contentArgs,function(node){return walk(node,func,depthFirst)});if(args!==ast.args||contentArgs!==ast.contentArgs){ast=new nodes[ast.typename](ast.extName,ast.prop,args,contentArgs)}}else{var props=ast.fields.map(function(field){return ast[field]});var propsT=mapCOW(props,function(prop){return walk(prop,func,depthFirst)});if(propsT!==props){ast=new nodes[ast.typename](ast.lineno,ast.colno);propsT.forEach(function(prop,i){ast[ast.fields[i]]=prop})}}return depthFirst?func(ast)||ast:ast}function depthWalk(ast,func){return walk(ast,func,true)}function _liftFilters(node,asyncFilters,prop){var children=[];var walked=depthWalk(prop?node[prop]:node,function(node){if(node instanceof nodes.Block){return node}else if(node instanceof nodes.Filter&&lib.indexOf(asyncFilters,node.name.value)!==-1||node instanceof nodes.CallExtensionAsync){var symbol=new nodes.Symbol(node.lineno,node.colno,gensym());children.push(new nodes.FilterAsync(node.lineno,node.colno,node.name,node.args,symbol));return symbol}});if(prop){node[prop]=walked}else{node=walked}if(children.length){children.push(node);return new nodes.NodeList(node.lineno,node.colno,children)}else{return node}}function liftFilters(ast,asyncFilters){return depthWalk(ast,function(node){if(node instanceof nodes.Output){return _liftFilters(node,asyncFilters)}else if(node instanceof nodes.For){return _liftFilters(node,asyncFilters,"arr")}else if(node instanceof nodes.If){return _liftFilters(node,asyncFilters,"cond")}else if(node instanceof nodes.CallExtension){return _liftFilters(node,asyncFilters,"args")}})}function liftSuper(ast){return walk(ast,function(blockNode){if(!(blockNode instanceof nodes.Block)){return}var hasSuper=false;var symbol=gensym();blockNode.body=walk(blockNode.body,function(node){if(node instanceof nodes.FunCall&&node.name.value==="super"){hasSuper=true;return new nodes.Symbol(node.lineno,node.colno,symbol)}});if(hasSuper){blockNode.body.children.unshift(new nodes.Super(0,0,blockNode.name,new nodes.Symbol(0,0,symbol)))}})}function convertStatements(ast){return depthWalk(ast,function(node){if(!(node instanceof nodes.If)&&!(node instanceof nodes.For)){return}var async=false;walk(node,function(node){if(node instanceof nodes.FilterAsync||node instanceof nodes.IfAsync||node instanceof nodes.AsyncEach||node instanceof nodes.AsyncAll||node instanceof nodes.CallExtensionAsync){async=true;return node}});if(async){if(node instanceof nodes.If){return new nodes.IfAsync(node.lineno,node.colno,node.cond,node.body,node.else_)}else if(node instanceof nodes.For){return new nodes.AsyncEach(node.lineno,node.colno,node.arr,node.name,node.body,node.else_)}}})}function cps(ast,asyncFilters){return convertStatements(liftSuper(liftFilters(ast,asyncFilters)))}function transform(ast,asyncFilters,name){return cps(ast,asyncFilters||[])}modules["transformer"]={transform:transform}})();(function(){"use strict";var lib=modules["lib"];var parser=modules["parser"];var transformer=modules["transformer"];var nodes=modules["nodes"];var Object=modules["object"];var Frame=modules["runtime"].Frame;var compareOps={"==":"==","!=":"!=","<":"<",">":">","<=":"<=",">=":">="};function binOpEmitter(str){return function(node,frame){this.compile(node.left,frame);this.emit(str);this.compile(node.right,frame)}}var Compiler=Object.extend({init:function(templateName){this.templateName=templateName;this.codebuf=[];this.lastId=0;this.buffer=null;this.bufferStack=[];this.isChild=false;this.scopeClosers=""},fail:function(msg,lineno,colno){if(lineno!==undefined)lineno+=1;if(colno!==undefined)colno+=1;throw new lib.TemplateError(msg,lineno,colno)},pushBufferId:function(id){this.bufferStack.push(this.buffer);this.buffer=id;this.emit("var "+this.buffer+' = "";')},popBufferId:function(){this.buffer=this.bufferStack.pop()},emit:function(code){this.codebuf.push(code)},emitLine:function(code){this.emit(code+"\n")},emitLines:function(){lib.each(lib.toArray(arguments),function(line){this.emitLine(line)},this)},emitFuncBegin:function(name){this.buffer="output";this.scopeClosers="";this.emitLine("function "+name+"(env, context, frame, runtime, cb) {");this.emitLine("var lineno = null;");this.emitLine("var colno = null;");this.emitLine("var "+this.buffer+' = "";');this.emitLine("try {")},emitFuncEnd:function(noReturn){if(!noReturn){this.emitLine("cb(null, "+this.buffer+");")}this.closeScopeLevels();this.emitLine("} catch (e) {");this.emitLine("  cb(runtime.handleError(e, lineno, colno));");this.emitLine("}");this.emitLine("}");this.buffer=null},addScopeLevel:function(){this.scopeClosers+="})"},closeScopeLevels:function(){this.emitLine(this.scopeClosers+";");this.scopeClosers=""},withScopedSyntax:function(func){var scopeClosers=this.scopeClosers;this.scopeClosers="";func.call(this);this.closeScopeLevels();this.scopeClosers=scopeClosers},makeCallback:function(res){var err=this.tmpid();return"function("+err+(res?","+res:"")+") {\n"+"if("+err+") { cb("+err+"); return; }"},tmpid:function(){this.lastId++;return"t_"+this.lastId},_templateName:function(){return this.templateName==null?"undefined":JSON.stringify(this.templateName)},_bufferAppend:function(func){this.emit(this.buffer+" += runtime.suppressValue(");func.call(this);this.emit(", env.opts.autoescape);\n")},_compileChildren:function(node,frame){var children=node.children;for(var i=0,l=children.length;i<l;i++){this.compile(children[i],frame)}},_compileAggregate:function(node,frame,startChar,endChar){if(startChar){this.emit(startChar)}for(var i=0;i<node.children.length;i++){if(i>0){this.emit(",")}this.compile(node.children[i],frame)}if(endChar){this.emit(endChar)}},_compileExpression:function(node,frame){this.assertType(node,nodes.Literal,nodes.Symbol,nodes.Group,nodes.Array,nodes.Dict,nodes.FunCall,nodes.Caller,nodes.Filter,nodes.LookupVal,nodes.Compare,nodes.InlineIf,nodes.In,nodes.And,nodes.Or,nodes.Not,nodes.Add,nodes.Sub,nodes.Mul,nodes.Div,nodes.FloorDiv,nodes.Mod,nodes.Pow,nodes.Neg,nodes.Pos,nodes.Compare,nodes.NodeList);this.compile(node,frame)},assertType:function(node){var types=lib.toArray(arguments).slice(1);var success=false;for(var i=0;i<types.length;i++){if(node instanceof types[i]){success=true}}if(!success){this.fail("assertType: invalid type: "+node.typename,node.lineno,node.colno)}},compileCallExtension:function(node,frame,async){var name=node.extName;var args=node.args;var contentArgs=node.contentArgs;var autoescape=typeof node.autoescape==="boolean"?node.autoescape:true;var transformedArgs=[];if(!async){this.emit(this.buffer+" += runtime.suppressValue(")}this.emit('env.getExtension("'+node.extName+'")["'+node.prop+'"](');this.emit("context");if(args||contentArgs){this.emit(",")}if(args){if(!(args instanceof nodes.NodeList)){this.fail("compileCallExtension: arguments must be a NodeList, "+"use `parser.parseSignature`")}lib.each(args.children,function(arg,i){this._compileExpression(arg,frame);if(i!==args.children.length-1||contentArgs.length){this.emit(",")}},this)}if(contentArgs.length){lib.each(contentArgs,function(arg,i){if(i>0){this.emit(",")}if(arg){var id=this.tmpid();this.emitLine("function(cb) {");this.emitLine("if(!cb) { cb = function(err) { if(err) { throw err; }}}");this.pushBufferId(id);this.withScopedSyntax(function(){this.compile(arg,frame);this.emitLine("cb(null, "+id+");")});this.popBufferId();this.emitLine("return "+id+";");this.emitLine("}")}else{this.emit("null")}},this)}if(async){var res=this.tmpid();this.emitLine(", "+this.makeCallback(res));this.emitLine(this.buffer+" += runtime.suppressValue("+res+", "+autoescape+" && env.opts.autoescape);");this.addScopeLevel()}else{this.emit(")");this.emit(", "+autoescape+" && env.opts.autoescape);\n")}},compileCallExtensionAsync:function(node,frame){this.compileCallExtension(node,frame,true)},compileNodeList:function(node,frame){this._compileChildren(node,frame)},compileLiteral:function(node,frame){if(typeof node.value==="string"){var val=node.value.replace(/\\/g,"\\\\");val=val.replace(/"/g,'\\"');val=val.replace(/\n/g,"\\n");val=val.replace(/\r/g,"\\r");val=val.replace(/\t/g,"\\t");this.emit('"'+val+'"')}else{this.emit(node.value.toString())}},compileSymbol:function(node,frame){var name=node.value;var v;if(v=frame.lookup(name)){this.emit(v)}else{this.emit("runtime.contextOrFrameLookup("+'context, frame, "'+name+'")')}},compileGroup:function(node,frame){this._compileAggregate(node,frame,"(",")")},compileArray:function(node,frame){this._compileAggregate(node,frame,"[","]")},compileDict:function(node,frame){this._compileAggregate(node,frame,"{","}")},compilePair:function(node,frame){var key=node.key;var val=node.value;if(key instanceof nodes.Symbol){key=new nodes.Literal(key.lineno,key.colno,key.value)}else if(!(key instanceof nodes.Literal&&typeof key.value==="string")){this.fail("compilePair: Dict keys must be strings or names",key.lineno,key.colno)}this.compile(key,frame);this.emit(": ");this._compileExpression(val,frame)},compileInlineIf:function(node,frame){this.emit("(");this.compile(node.cond,frame);this.emit("?");this.compile(node.body,frame);this.emit(":");if(node.else_!==null)this.compile(node.else_,frame);else this.emit('""');this.emit(")")},compileIn:function(node,frame){this.emit("(");this.compile(node.right,frame);this.emit(".indexOf(");this.compile(node.left,frame);this.emit(") !== -1)")},compileOr:binOpEmitter(" || "),compileAnd:binOpEmitter(" && "),compileAdd:binOpEmitter(" + "),compileSub:binOpEmitter(" - "),compileMul:binOpEmitter(" * "),compileDiv:binOpEmitter(" / "),compileMod:binOpEmitter(" % "),compileNot:function(node,frame){this.emit("!");this.compile(node.target,frame)},compileFloorDiv:function(node,frame){this.emit("Math.floor(");this.compile(node.left,frame);this.emit(" / ");this.compile(node.right,frame);this.emit(")")},compilePow:function(node,frame){this.emit("Math.pow(");this.compile(node.left,frame);this.emit(", ");this.compile(node.right,frame);this.emit(")")},compileNeg:function(node,frame){this.emit("-");this.compile(node.target,frame)},compilePos:function(node,frame){this.emit("+");this.compile(node.target,frame)},compileCompare:function(node,frame){this.compile(node.expr,frame);for(var i=0;i<node.ops.length;i++){var n=node.ops[i];this.emit(" "+compareOps[n.type]+" ");this.compile(n.expr,frame)}},compileLookupVal:function(node,frame){this.emit("runtime.memberLookup((");this._compileExpression(node.target,frame);this.emit("),");this._compileExpression(node.val,frame);this.emit(", env.opts.autoescape)")},_getNodeName:function(node){switch(node.typename){case"Symbol":return node.value;case"FunCall":return"the return value of ("+this._getNodeName(node.name)+")";case"LookupVal":return this._getNodeName(node.target)+'["'+this._getNodeName(node.val)+'"]';case"Literal":return node.value.toString().substr(0,10);default:return"--expression--"}},compileFunCall:function(node,frame){this.emit("(lineno = "+node.lineno+", colno = "+node.colno+", ");this.emit("runtime.callWrap(");this._compileExpression(node.name,frame);this.emit(', "'+this._getNodeName(node.name).replace(/"/g,'\\"')+'", ');this._compileAggregate(node.args,frame,"[","])");this.emit(")")},compileFilter:function(node,frame){var name=node.name;this.assertType(name,nodes.Symbol);this.emit('env.getFilter("'+name.value+'").call(context, ');this._compileAggregate(node.args,frame);this.emit(")")},compileFilterAsync:function(node,frame){var name=node.name;this.assertType(name,nodes.Symbol);var symbol=node.symbol.value;frame.set(symbol,symbol);this.emit('env.getFilter("'+name.value+'").call(context, ');this._compileAggregate(node.args,frame);this.emitLine(", "+this.makeCallback(symbol));this.addScopeLevel()},compileKeywordArgs:function(node,frame){var names=[];lib.each(node.children,function(pair){names.push(pair.key.value)});this.emit("runtime.makeKeywordArgs(");this.compileDict(node,frame);this.emit(")")},compileSet:function(node,frame){var ids=[];lib.each(node.targets,function(target){var name=target.value;var id=frame.lookup(name);if(id===null||id===undefined){id=this.tmpid();this.emitLine("var "+id+";")}ids.push(id)},this);this.emit(ids.join(" = ")+" = ");this._compileExpression(node.value,frame);this.emitLine(";");lib.each(node.targets,function(target,i){var id=ids[i];var name=target.value;this.emitLine('frame.set("'+name+'", '+id+", true);");this.emitLine("if(!frame.parent) {");this.emitLine('context.setVariable("'+name+'", '+id+");");if(name.charAt(0)!=="_"){this.emitLine('context.addExport("'+name+'");')}this.emitLine("}")},this)},compileIf:function(node,frame,async){this.emit("if(");this._compileExpression(node.cond,frame);this.emitLine(") {");this.withScopedSyntax(function(){this.compile(node.body,frame);if(async){this.emit("cb()")}});if(node.else_){this.emitLine("}\nelse {");this.withScopedSyntax(function(){this.compile(node.else_,frame);if(async){this.emit("cb()")}})}else if(async){this.emitLine("}\nelse {");this.emit("cb()")}this.emitLine("}")},compileIfAsync:function(node,frame){this.emit("(function(cb) {");this.compileIf(node,frame,true);this.emit("})(function() {");this.addScopeLevel()},emitLoopBindings:function(node,arr,i,len){var bindings={index:i+" + 1",index0:i,revindex:len+" - "+i,revindex0:len+" - "+i+" - 1",first:i+" === 0",last:i+" === "+len+" - 1",length:len};for(var name in bindings){this.emitLine('frame.set("loop.'+name+'", '+bindings[name]+");")}},compileFor:function(node,frame){var i=this.tmpid();var len=this.tmpid();var arr=this.tmpid();frame=frame.push();this.emitLine("frame = frame.push();");this.emit("var "+arr+" = ");this._compileExpression(node.arr,frame);this.emitLine(";");this.emit("if("+arr+") {");if(node.name instanceof nodes.Array){this.emitLine("var "+i+";");this.emitLine("if(runtime.isArray("+arr+")) {");{this.emitLine("var "+len+" = "+arr+".length;");this.emitLine("for("+i+"=0; "+i+" < "+arr+".length; "+i+"++) {");for(var u=0;u<node.name.children.length;u++){var tid=this.tmpid();this.emitLine("var "+tid+" = "+arr+"["+i+"]["+u+"]");this.emitLine('frame.set("'+node.name.children[u].value+'", '+arr+"["+i+"]["+u+"]"+");");frame.set(node.name.children[u].value,tid)}this.emitLoopBindings(node,arr,i,len);this.withScopedSyntax(function(){this.compile(node.body,frame)});this.emitLine("}")}this.emitLine("} else {");{var key=node.name.children[0];var val=node.name.children[1];var k=this.tmpid();var v=this.tmpid();frame.set(key.value,k);frame.set(val.value,v);this.emitLine(i+" = -1;");this.emitLine("var "+len+" = runtime.keys("+arr+").length;");this.emitLine("for(var "+k+" in "+arr+") {");this.emitLine(i+"++;");this.emitLine("var "+v+" = "+arr+"["+k+"];");this.emitLine('frame.set("'+key.value+'", '+k+");");this.emitLine('frame.set("'+val.value+'", '+v+");");this.emitLoopBindings(node,arr,i,len);this.withScopedSyntax(function(){this.compile(node.body,frame)});this.emitLine("}")}this.emitLine("}")}else{var v=this.tmpid();frame.set(node.name.value,v);this.emitLine("var "+len+" = "+arr+".length;");this.emitLine("for(var "+i+"=0; "+i+" < "+arr+".length; "+i+"++) {");this.emitLine("var "+v+" = "+arr+"["+i+"];");this.emitLine('frame.set("'+node.name.value+'", '+v+");");this.emitLoopBindings(node,arr,i,len);this.withScopedSyntax(function(){this.compile(node.body,frame)});this.emitLine("}")}this.emitLine("}");if(node.else_){this.emitLine("if (!"+len+") {");this.compile(node.else_,frame);this.emitLine("}")}this.emitLine("frame = frame.pop();")},_compileAsyncLoop:function(node,frame,parallel){var i=this.tmpid();var len=this.tmpid();var arr=this.tmpid();var asyncMethod=parallel?"asyncAll":"asyncEach";frame=frame.push();this.emitLine("frame = frame.push();");this.emit("var "+arr+" = ");this._compileExpression(node.arr,frame);this.emitLine(";");if(node.name instanceof nodes.Array){this.emit("runtime."+asyncMethod+"("+arr+", "+node.name.children.length+", function(");lib.each(node.name.children,function(name){this.emit(name.value+",")},this);this.emit(i+","+len+",next) {");lib.each(node.name.children,function(name){var id=name.value;frame.set(id,id);this.emitLine('frame.set("'+id+'", '+id+");")},this)}else{var id=node.name.value;this.emitLine("runtime."+asyncMethod+"("+arr+", 1, function("+id+", "+i+", "+len+",next) {");this.emitLine('frame.set("'+id+'", '+id+");");frame.set(id,id)}this.emitLoopBindings(node,arr,i,len);this.withScopedSyntax(function(){var buf;if(parallel){buf=this.tmpid();this.pushBufferId(buf)}this.compile(node.body,frame);this.emitLine("next("+i+(buf?","+buf:"")+");");if(parallel){this.popBufferId()}});var output=this.tmpid();this.emitLine("}, "+this.makeCallback(output));this.addScopeLevel();if(parallel){this.emitLine(this.buffer+" += "+output+";")}if(node.else_){this.emitLine("if (!"+arr+".length) {");this.compile(node.else_,frame);this.emitLine("}")}this.emitLine("frame = frame.pop();")},compileAsyncEach:function(node,frame){this._compileAsyncLoop(node,frame)},compileAsyncAll:function(node,frame){this._compileAsyncLoop(node,frame,true)},_compileMacro:function(node,frame){var args=[];var kwargs=null;var funcId="macro_"+this.tmpid();lib.each(node.args.children,function(arg,i){if(i===node.args.children.length-1&&arg instanceof nodes.Dict){kwargs=arg}else{this.assertType(arg,nodes.Symbol);args.push(arg)}},this);var realNames=lib.map(args,function(n){return"l_"+n.value});realNames.push("kwargs");var argNames=lib.map(args,function(n){return'"'+n.value+'"'});var kwargNames=lib.map(kwargs&&kwargs.children||[],function(n){return'"'+n.key.value+'"'});frame=frame.push();this.emitLines("var "+funcId+" = runtime.makeMacro(","["+argNames.join(", ")+"], ","["+kwargNames.join(", ")+"], ","function ("+realNames.join(", ")+") {","frame = frame.push();","kwargs = kwargs || {};",'if (kwargs.hasOwnProperty("caller")) {','frame.set("caller", kwargs.caller); }');lib.each(args,function(arg){this.emitLine('frame.set("'+arg.value+'", '+"l_"+arg.value+");");frame.set(arg.value,"l_"+arg.value)},this);if(kwargs){lib.each(kwargs.children,function(pair){var name=pair.key.value;this.emit('frame.set("'+name+'", '+'kwargs.hasOwnProperty("'+name+'") ? '+'kwargs["'+name+'"] : ');this._compileExpression(pair.value,frame);this.emitLine(");")},this)}var bufferId=this.tmpid();this.pushBufferId(bufferId);this.withScopedSyntax(function(){this.compile(node.body,frame)});frame=frame.pop();this.emitLine("frame = frame.pop();");this.emitLine("return new runtime.SafeString("+bufferId+");");this.emitLine("});");this.popBufferId();return funcId},compileMacro:function(node,frame){var funcId=this._compileMacro(node,frame);var name=node.name.value;frame.set(name,funcId);if(frame.parent){this.emitLine('frame.set("'+name+'", '+funcId+");")}else{if(node.name.value.charAt(0)!=="_"){this.emitLine('context.addExport("'+name+'");')}this.emitLine('context.setVariable("'+name+'", '+funcId+");")}},compileCaller:function(node,frame){this.emit("(function (){");var funcId=this._compileMacro(node,frame);this.emit("return "+funcId+";})()")},compileImport:function(node,frame){var id=this.tmpid();var target=node.target.value;this.emit("env.getTemplate(");this._compileExpression(node.template,frame);this.emitLine(", false, "+this._templateName()+", "+this.makeCallback(id));this.addScopeLevel();this.emitLine(id+".getExported("+(node.withContext?"context.getVariables(), frame.push(), ":"")+this.makeCallback(id));this.addScopeLevel();frame.set(target,id);if(frame.parent){this.emitLine('frame.set("'+target+'", '+id+");")}else{this.emitLine('context.setVariable("'+target+'", '+id+");")}},compileFromImport:function(node,frame){var importedId=this.tmpid();this.emit("env.getTemplate(");this._compileExpression(node.template,frame);this.emitLine(", false, "+this._templateName()+", "+this.makeCallback(importedId));this.addScopeLevel();this.emitLine(importedId+".getExported("+(node.withContext?"context.getVariables(), frame.push(), ":"")+this.makeCallback(importedId));this.addScopeLevel();lib.each(node.names.children,function(nameNode){var name;var alias;var id=this.tmpid();if(nameNode instanceof nodes.Pair){name=nameNode.key.value;alias=nameNode.value.value}else{name=nameNode.value;alias=name}this.emitLine("if("+importedId+'.hasOwnProperty("'+name+'")) {');this.emitLine("var "+id+" = "+importedId+"."+name+";");this.emitLine("} else {");this.emitLine("cb(new Error(\"cannot import '"+name+"'\")); return;");this.emitLine("}");frame.set(alias,id);if(frame.parent){this.emitLine('frame.set("'+alias+'", '+id+");")}else{this.emitLine('context.setVariable("'+alias+'", '+id+");")}},this)},compileBlock:function(node,frame){if(!this.isChild){var id=this.tmpid();
this.emitLine('context.getBlock("'+node.name.value+'")'+"(env, context, frame, runtime, "+this.makeCallback(id));this.emitLine(this.buffer+" += "+id+";");this.addScopeLevel()}},compileSuper:function(node,frame){var name=node.blockName.value;var id=node.symbol.value;this.emitLine("context.getSuper(env, "+'"'+name+'", '+"b_"+name+", "+"frame, runtime, "+this.makeCallback(id));this.emitLine(id+" = runtime.markSafe("+id+");");this.addScopeLevel();frame.set(id,id)},compileExtends:function(node,frame){if(this.isChild){this.fail("compileExtends: cannot extend multiple times",node.template.lineno,node.template.colno)}var k=this.tmpid();this.emit("env.getTemplate(");this._compileExpression(node.template,frame);this.emitLine(", true, "+this._templateName()+", "+this.makeCallback("parentTemplate"));this.emitLine("for(var "+k+" in parentTemplate.blocks) {");this.emitLine("context.addBlock("+k+", parentTemplate.blocks["+k+"]);");this.emitLine("}");this.addScopeLevel();this.isChild=true},compileInclude:function(node,frame){var id=this.tmpid();var id2=this.tmpid();this.emit("env.getTemplate(");this._compileExpression(node.template,frame);this.emitLine(", false, "+this._templateName()+", "+this.makeCallback(id));this.addScopeLevel();this.emitLine(id+".render("+"context.getVariables(), frame.push(), "+this.makeCallback(id2));this.emitLine(this.buffer+" += "+id2);this.addScopeLevel()},compileTemplateData:function(node,frame){this.compileLiteral(node,frame)},compileOutput:function(node,frame){var children=node.children;for(var i=0,l=children.length;i<l;i++){if(children[i]instanceof nodes.TemplateData){if(children[i].value){this.emit(this.buffer+" += ");this.compileLiteral(children[i],frame);this.emitLine(";")}}else{this.emit(this.buffer+" += runtime.suppressValue(");this.compile(children[i],frame);this.emit(", env.opts.autoescape);\n")}}},compileRoot:function(node,frame){if(frame){this.fail("compileRoot: root node can't have frame")}frame=new Frame;this.emitFuncBegin("root");this._compileChildren(node,frame);if(this.isChild){this.emitLine("parentTemplate.rootRenderFunc(env, context, frame, runtime, cb);")}this.emitFuncEnd(this.isChild);this.isChild=false;var blocks=node.findAll(nodes.Block);for(var i=0;i<blocks.length;i++){var block=blocks[i];var name=block.name.value;this.emitFuncBegin("b_"+name);var tmpFrame=new Frame;this.compile(block.body,tmpFrame);this.emitFuncEnd()}this.emitLine("return {");for(var i=0;i<blocks.length;i++){var block=blocks[i];var name="b_"+block.name.value;this.emitLine(name+": "+name+",")}this.emitLine("root: root\n};")},compile:function(node,frame){var _compile=this["compile"+node.typename];if(_compile){_compile.call(this,node,frame)}else{this.fail("compile: Cannot compile node: "+node.typename,node.lineno,node.colno)}},getCode:function(){return this.codebuf.join("")}});modules["compiler"]={compile:function(src,asyncFilters,extensions,name,opts){var c=new Compiler(name);if(extensions&&extensions.length){for(var i=0;i<extensions.length;i++){if("preprocess"in extensions[i]){src=extensions[i].preprocess(src,name)}}}c.compile(transformer.transform(parser.parse(src,extensions,opts),asyncFilters,name));return c.getCode()},Compiler:Compiler}})();(function(){"use strict";var lib=modules["lib"];var r=modules["runtime"];var filters={abs:function(n){return Math.abs(n)},batch:function(arr,linecount,fill_with){var res=[];var tmp=[];for(var i=0;i<arr.length;i++){if(i%linecount===0&&tmp.length){res.push(tmp);tmp=[]}tmp.push(arr[i])}if(tmp.length){if(fill_with){for(var i=tmp.length;i<linecount;i++){tmp.push(fill_with)}}res.push(tmp)}return res},capitalize:function(str){var ret=str.toLowerCase();return r.copySafeness(str,ret.charAt(0).toUpperCase()+ret.slice(1))},center:function(str,width){width=width||80;if(str.length>=width){return str}var spaces=width-str.length;var pre=lib.repeat(" ",spaces/2-spaces%2);var post=lib.repeat(" ",spaces/2);return r.copySafeness(str,pre+str+post)},"default":function(val,def){return val?val:def},dictsort:function(val,case_sensitive,by){if(!lib.isObject(val)){throw new lib.TemplateError("dictsort filter: val must be an object")}var array=[];for(var k in val){array.push([k,val[k]])}var si;if(by===undefined||by==="key"){si=0}else if(by==="value"){si=1}else{throw new lib.TemplateError("dictsort filter: You can only sort by either key or value")}array.sort(function(t1,t2){var a=t1[si];var b=t2[si];if(!case_sensitive){if(lib.isString(a)){a=a.toUpperCase()}if(lib.isString(b)){b=b.toUpperCase()}}return a>b?1:a===b?0:-1});return array},escape:function(str){if(typeof str==="string"||str instanceof r.SafeString){return lib.escape(str)}return str},safe:function(str){return r.markSafe(str)},first:function(arr){return arr[0]},groupby:function(arr,attr){return lib.groupBy(arr,attr)},indent:function(str,width,indentfirst){width=width||4;var res="";var lines=str.split("\n");var sp=lib.repeat(" ",width);for(var i=0;i<lines.length;i++){if(i===0&&!indentfirst){res+=lines[i]+"\n"}else{res+=sp+lines[i]+"\n"}}return r.copySafeness(str,res)},join:function(arr,del,attr){del=del||"";if(attr){arr=lib.map(arr,function(v){return v[attr]})}return arr.join(del)},last:function(arr){return arr[arr.length-1]},length:function(arr){return arr!==undefined?arr.length:0},list:function(val){if(lib.isString(val)){return val.split("")}else if(lib.isObject(val)){var keys=[];if(Object.keys){keys=Object.keys(val)}else{for(var k in val){keys.push(k)}}return lib.map(keys,function(k){return{key:k,value:val[k]}})}else if(lib.isArray(val)){return val}else{throw new lib.TemplateError("list filter: type not iterable")}},lower:function(str){return str.toLowerCase()},random:function(arr){return arr[Math.floor(Math.random()*arr.length)]},rejectattr:function(arr,attr){return arr.filter(function(item){return!item[attr]})},selectattr:function(arr,attr){return arr.filter(function(item){return!!item[attr]})},replace:function(str,old,new_,maxCount){if(old instanceof RegExp){return str.replace(old,new_)}var res=str;var last=res;var count=1;res=res.replace(old,new_);while(last!==res){if(count>=maxCount){break}last=res;res=res.replace(old,new_);count++}return r.copySafeness(str,res)},reverse:function(val){var arr;if(lib.isString(val)){arr=filters.list(val)}else{arr=lib.map(val,function(v){return v})}arr.reverse();if(lib.isString(val)){return r.copySafeness(val,arr.join(""))}return arr},round:function(val,precision,method){precision=precision||0;var factor=Math.pow(10,precision);var rounder;if(method==="ceil"){rounder=Math.ceil}else if(method==="floor"){rounder=Math.floor}else{rounder=Math.round}return rounder(val*factor)/factor},slice:function(arr,slices,fillWith){var sliceLength=Math.floor(arr.length/slices);var extra=arr.length%slices;var offset=0;var res=[];for(var i=0;i<slices;i++){var start=offset+i*sliceLength;if(i<extra){offset++}var end=offset+(i+1)*sliceLength;var slice=arr.slice(start,end);if(fillWith&&i>=extra){slice.push(fillWith)}res.push(slice)}return res},sort:function(arr,reverse,caseSens,attr){arr=lib.map(arr,function(v){return v});arr.sort(function(a,b){var x,y;if(attr){x=a[attr];y=b[attr]}else{x=a;y=b}if(!caseSens&&lib.isString(x)&&lib.isString(y)){x=x.toLowerCase();y=y.toLowerCase()}if(x<y){return reverse?1:-1}else if(x>y){return reverse?-1:1}else{return 0}});return arr},string:function(obj){return r.copySafeness(obj,obj)},title:function(str){var words=str.split(" ");for(var i=0;i<words.length;i++){words[i]=filters.capitalize(words[i])}return r.copySafeness(str,words.join(" "))},trim:function(str){return r.copySafeness(str,str.replace(/^\s*|\s*$/g,""))},truncate:function(input,length,killwords,end){var orig=input;length=length||255;if(input.length<=length)return input;if(killwords){input=input.substring(0,length)}else{var idx=input.lastIndexOf(" ",length);if(idx===-1){idx=length}input=input.substring(0,idx)}input+=end!==undefined&&end!==null?end:"...";return r.copySafeness(orig,input)},upper:function(str){return str.toUpperCase()},urlencode:function(obj){var enc=encodeURIComponent;if(lib.isString(obj)){return enc(obj)}else{var parts;if(lib.isArray(obj)){parts=obj.map(function(item){return enc(item[0])+"="+enc(item[1])})}else{parts=[];for(var k in obj){if(obj.hasOwnProperty(k)){parts.push(enc(k)+"="+enc(obj[k]))}}}return parts.join("&")}},urlize:function(str,length,nofollow){if(isNaN(length))length=Infinity;var noFollowAttr=nofollow===true?' rel="nofollow"':"";var puncRE=/^(?:\(|<|&lt;)?(.*?)(?:\.|,|\)|\n|&gt;)?$/;var emailRE=/^[\w.!#$%&'*+\-\/=?\^`{|}~]+@[a-z\d\-]+(\.[a-z\d\-]+)+$/i;var httpHttpsRE=/^https?:\/\/.*$/;var wwwRE=/^www\./;var tldRE=/\.(?:org|net|com)(?:\:|\/|$)/;var words=str.split(/\s+/).filter(function(word){return word&&word.length}).map(function(word){var matches=word.match(puncRE);var possibleUrl=matches&&matches[1]||word;if(httpHttpsRE.test(possibleUrl))return'<a href="'+possibleUrl+'"'+noFollowAttr+">"+possibleUrl.substr(0,length)+"</a>";if(wwwRE.test(possibleUrl))return'<a href="http://'+possibleUrl+'"'+noFollowAttr+">"+possibleUrl.substr(0,length)+"</a>";if(emailRE.test(possibleUrl))return'<a href="mailto:'+possibleUrl+'">'+possibleUrl+"</a>";if(tldRE.test(possibleUrl))return'<a href="http://'+possibleUrl+'"'+noFollowAttr+">"+possibleUrl.substr(0,length)+"</a>";return word});return words.join(" ")},wordcount:function(str){var words=str?str.match(/\w+/g):null;return words?words.length:null},"float":function(val,def){var res=parseFloat(val);return isNaN(res)?def:res},"int":function(val,def){var res=parseInt(val,10);return isNaN(res)?def:res}};filters.d=filters["default"];filters.e=filters.escape;modules["filters"]=filters})();(function(){"use strict";function cycler(items){var index=-1;return{current:null,reset:function(){index=-1;this.current=null},next:function(){index++;if(index>=items.length){index=0}this.current=items[index];return this.current}}}function joiner(sep){sep=sep||",";var first=true;return function(){var val=first?"":sep;first=false;return val}}var globals={range:function(start,stop,step){if(!stop){stop=start;start=0;step=1}else if(!step){step=1}var arr=[];for(var i=start;i<stop;i+=step){arr.push(i)}return arr},cycler:function(){return cycler(Array.prototype.slice.call(arguments))},joiner:function(sep){return joiner(sep)}};modules["globals"]=globals})();(function(){"use strict";var path=modules["path"];var Obj=modules["object"];var lib=modules["lib"];var Loader=Obj.extend({on:function(name,func){this.listeners=this.listeners||{};this.listeners[name]=this.listeners[name]||[];this.listeners[name].push(func)},emit:function(name){var args=Array.prototype.slice.call(arguments,1);if(this.listeners&&this.listeners[name]){lib.each(this.listeners[name],function(listener){listener.apply(null,args)})}},resolve:function(from,to){return path.resolve(path.dirname(from),to)},isRelative:function(filename){return filename.indexOf("./")===0||filename.indexOf("../")===0}});modules["loader"]=Loader})();(function(){"use strict";var Loader=modules["loader"];var WebLoader=Loader.extend({init:function(baseURL,neverUpdate){this.precompiled=window.nunjucksPrecompiled||{};this.baseURL=baseURL||"";this.neverUpdate=neverUpdate},getSource:function(name){if(this.precompiled[name]){return{src:{type:"code",obj:this.precompiled[name]},path:name}}else{var src=this.fetch(this.baseURL+"/"+name);if(!src){return null}return{src:src,path:name,noCache:!this.neverUpdate}}},fetch:function(url,callback){var ajax;var loading=true;var src;if(window.XMLHttpRequest){ajax=new XMLHttpRequest}else if(window.ActiveXObject){ajax=new ActiveXObject("Microsoft.XMLHTTP")}ajax.onreadystatechange=function(){if(ajax.readyState===4&&(ajax.status===0||ajax.status===200)&&loading){loading=false;src=ajax.responseText}};url+=(url.indexOf("?")===-1?"?":"&")+"s="+(new Date).getTime();ajax.open("GET",url,false);ajax.send();return src}});modules["web-loaders"]={WebLoader:WebLoader}})();(function(){if(typeof window==="undefined"||window!==this){modules["loaders"]=modules["node-loaders"]}else{modules["loaders"]=modules["web-loaders"]}})();(function(){"use strict";var path=modules["path"];var lib=modules["lib"];var Obj=modules["object"];var lexer=modules["lexer"];var compiler=modules["compiler"];var builtin_filters=modules["filters"];var builtin_loaders=modules["loaders"];var runtime=modules["runtime"];var globals=modules["globals"];var Frame=runtime.Frame;var Environment=Obj.extend({init:function(loaders,opts){var opts=this.opts=opts||{};this.opts.dev=!!opts.dev;this.opts.autoescape=!!opts.autoescape;this.opts.trimBlocks=!!opts.trimBlocks;this.opts.lstripBlocks=!!opts.lstripBlocks;if(!loaders){if(builtin_loaders.FileSystemLoader){this.loaders=[new builtin_loaders.FileSystemLoader("views")]}else{this.loaders=[new builtin_loaders.WebLoader("/views")]}}else{this.loaders=lib.isArray(loaders)?loaders:[loaders]}this.initCache();this.filters={};this.asyncFilters=[];this.extensions={};this.extensionsList=[];for(var name in builtin_filters){this.addFilter(name,builtin_filters[name])}},initCache:function(){lib.each(this.loaders,function(loader){loader.cache={};if(typeof loader.on==="function"){loader.on("update",function(template){loader.cache[template]=null})}})},addExtension:function(name,extension){extension._name=name;this.extensions[name]=extension;this.extensionsList.push(extension)},getExtension:function(name){return this.extensions[name]},addGlobal:function(name,value){globals[name]=value},addFilter:function(name,func,async){var wrapped=func;if(async){this.asyncFilters.push(name)}this.filters[name]=wrapped},getFilter:function(name){if(!this.filters[name]){throw new Error("filter not found: "+name)}return this.filters[name]},resolveTemplate:function(loader,parentName,filename){var isRelative=loader.isRelative&&parentName?loader.isRelative(filename):false;return isRelative&&loader.resolve?loader.resolve(parentName,filename):filename},getTemplate:function(name,eagerCompile,parentName,cb){var that=this;var tmpl=null;if(name&&name.raw){name=name.raw}if(lib.isFunction(parentName)){cb=parentName;parentName=null;eagerCompile=eagerCompile||false}if(lib.isFunction(eagerCompile)){cb=eagerCompile;eagerCompile=false}if(typeof name!=="string"){throw new Error("template names must be a string: "+name)}for(var i=0;i<this.loaders.length;i++){var _name=this.resolveTemplate(this.loaders[i],parentName,name);tmpl=this.loaders[i].cache[_name];if(tmpl)break}if(tmpl){if(eagerCompile){tmpl.compile()}if(cb){cb(null,tmpl)}else{return tmpl}}else{var syncResult;lib.asyncIter(this.loaders,function(loader,i,next,done){function handle(src){if(src){src.loader=loader;done(src)}else{next()}}name=that.resolveTemplate(loader,parentName,name);if(loader.async){loader.getSource(name,function(err,src){if(err){throw err}handle(src)})}else{handle(loader.getSource(name))}},function(info){if(!info){var err=new Error("template not found: "+name);if(cb){cb(err)}else{throw err}}else{var tmpl=new Template(info.src,this,info.path,eagerCompile);if(!info.noCache){info.loader.cache[name]=tmpl}if(cb){cb(null,tmpl)}else{syncResult=tmpl}}}.bind(this));return syncResult}},express:function(app){var env=this;function NunjucksView(name,opts){this.name=name;this.path=name;this.defaultEngine=opts.defaultEngine;this.ext=path.extname(name);if(!this.ext&&!this.defaultEngine)throw new Error("No default engine was specified and no extension was provided.");if(!this.ext)this.name+=this.ext=("."!==this.defaultEngine[0]?".":"")+this.defaultEngine}NunjucksView.prototype.render=function(opts,cb){env.render(this.name,opts,cb)};app.set("view",NunjucksView)},render:function(name,ctx,cb){if(lib.isFunction(ctx)){cb=ctx;ctx=null}var syncResult=null;this.getTemplate(name,function(err,tmpl){if(err&&cb){cb(err)}else if(err){throw err}else{tmpl.render(ctx,cb||function(err,res){if(err){throw err}syncResult=res})}});return syncResult},renderString:function(src,ctx,opts,cb){if(lib.isFunction(opts)){cb=opts;opts={}}opts=opts||{};var tmpl=new Template(src,this,opts.path);return tmpl.render(ctx,cb)}});var Context=Obj.extend({init:function(ctx,blocks){this.ctx=ctx;this.blocks={};this.exported=[];for(var name in blocks){this.addBlock(name,blocks[name])}},lookup:function(name){if(name in globals&&!(name in this.ctx)){return globals[name]}else{return this.ctx[name]}},setVariable:function(name,val){this.ctx[name]=val},getVariables:function(){return this.ctx},addBlock:function(name,block){this.blocks[name]=this.blocks[name]||[];this.blocks[name].push(block)},getBlock:function(name){if(!this.blocks[name]){throw new Error('unknown block "'+name+'"')}return this.blocks[name][0]},getSuper:function(env,name,block,frame,runtime,cb){var idx=lib.indexOf(this.blocks[name]||[],block);var blk=this.blocks[name][idx+1];var context=this;if(idx===-1||!blk){throw new Error('no super block available for "'+name+'"')}blk(env,context,frame,runtime,cb)},addExport:function(name){this.exported.push(name)},getExported:function(){var exported={};for(var i=0;i<this.exported.length;i++){var name=this.exported[i];exported[name]=this.ctx[name]}return exported}});var Template=Obj.extend({init:function(src,env,path,eagerCompile){this.env=env||new Environment;if(lib.isObject(src)){switch(src.type){case"code":this.tmplProps=src.obj;break;case"string":this.tmplStr=src.obj;break}}else if(lib.isString(src)){this.tmplStr=src}else{throw new Error("src must be a string or an object describing "+"the source")}this.path=path;if(eagerCompile){lib.withPrettyErrors(this.path,this.env.dev,this._compile.bind(this))}else{this.compiled=false}},render:function(ctx,frame,cb){if(typeof ctx==="function"){cb=ctx;ctx={}}else if(typeof frame==="function"){cb=frame;frame=null}return lib.withPrettyErrors(this.path,this.env.dev,function(){try{this.compile()}catch(e){if(cb)return cb(e);else throw e}var context=new Context(ctx||{},this.blocks);var syncResult=null;this.rootRenderFunc(this.env,context,frame||new Frame,runtime,cb||function(err,res){if(err){throw err}syncResult=res});return syncResult}.bind(this))},getExported:function(ctx,frame,cb){if(typeof ctx==="function"){cb=ctx;ctx={}}if(typeof frame==="function"){cb=frame;frame=null}try{this.compile()}catch(e){if(cb)return cb(e);else throw e}var context=new Context(ctx||{},this.blocks);this.rootRenderFunc(this.env,context,frame||new Frame,runtime,function(){cb(null,context.getExported())})},compile:function(){if(!this.compiled){this._compile()}},_compile:function(){var props;if(this.tmplProps){props=this.tmplProps}else{var source=compiler.compile(this.tmplStr,this.env.asyncFilters,this.env.extensionsList,this.path,this.env.opts);var func=new Function(source);props=func()}this.blocks=this._getBlocks(props);this.rootRenderFunc=props.root;this.compiled=true},_getBlocks:function(props){var blocks={};for(var k in props){if(k.slice(0,2)==="b_"){blocks[k.slice(2)]=props[k]}}return blocks}});modules["environment"]={Environment:Environment,Template:Template}})();var nunjucks;var lib=modules["lib"];var env=modules["environment"];var compiler=modules["compiler"];var parser=modules["parser"];var lexer=modules["lexer"];var runtime=modules["runtime"];var Loader=modules["loader"];var loaders=modules["loaders"];var precompile=modules["precompile"];nunjucks={};nunjucks.Environment=env.Environment;nunjucks.Template=env.Template;nunjucks.Loader=Loader;nunjucks.FileSystemLoader=loaders.FileSystemLoader;nunjucks.WebLoader=loaders.WebLoader;nunjucks.compiler=compiler;nunjucks.parser=parser;nunjucks.lexer=lexer;nunjucks.runtime=runtime;var e;nunjucks.configure=function(templatesPath,opts){opts=opts||{};if(lib.isObject(templatesPath)){opts=templatesPath;templatesPath=null}var noWatch="watch"in opts?!opts.watch:false;var loader=loaders.FileSystemLoader||loaders.WebLoader;e=new env.Environment(new loader(templatesPath,noWatch),opts);if(opts&&opts.express){e.express(opts.express)}return e};nunjucks.compile=function(src,env,path,eagerCompile){if(!e){nunjucks.configure()}return new nunjucks.Template(src,env,path,eagerCompile)};nunjucks.render=function(name,ctx,cb){if(!e){nunjucks.configure()}return e.render(name,ctx,cb)};nunjucks.renderString=function(src,ctx,cb){if(!e){nunjucks.configure()}return e.renderString(src,ctx,cb)};if(precompile){nunjucks.precompile=precompile.precompile;nunjucks.precompileString=precompile.precompileString}nunjucks.require=function(name){return modules[name]};if(typeof define==="function"&&define.amd){define(function(){return nunjucks})}else{window.nunjucks=nunjucks;if(typeof module!=="undefined")module.exports=nunjucks}})();


//! moment.js
//! version : 2.10.6
//! authors : Tim Wood, Iskren Chernev, Moment.js contributors
//! license : MIT
//! momentjs.com
!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):a.moment=b()}(this,function(){"use strict";function a(){return Hc.apply(null,arguments)}function b(a){Hc=a}function c(a){return"[object Array]"===Object.prototype.toString.call(a)}function d(a){return a instanceof Date||"[object Date]"===Object.prototype.toString.call(a)}function e(a,b){var c,d=[];for(c=0;c<a.length;++c)d.push(b(a[c],c));return d}function f(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function g(a,b){for(var c in b)f(b,c)&&(a[c]=b[c]);return f(b,"toString")&&(a.toString=b.toString),f(b,"valueOf")&&(a.valueOf=b.valueOf),a}function h(a,b,c,d){return Ca(a,b,c,d,!0).utc()}function i(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1}}function j(a){return null==a._pf&&(a._pf=i()),a._pf}function k(a){if(null==a._isValid){var b=j(a);a._isValid=!(isNaN(a._d.getTime())||!(b.overflow<0)||b.empty||b.invalidMonth||b.invalidWeekday||b.nullInput||b.invalidFormat||b.userInvalidated),a._strict&&(a._isValid=a._isValid&&0===b.charsLeftOver&&0===b.unusedTokens.length&&void 0===b.bigHour)}return a._isValid}function l(a){var b=h(NaN);return null!=a?g(j(b),a):j(b).userInvalidated=!0,b}function m(a,b){var c,d,e;if("undefined"!=typeof b._isAMomentObject&&(a._isAMomentObject=b._isAMomentObject),"undefined"!=typeof b._i&&(a._i=b._i),"undefined"!=typeof b._f&&(a._f=b._f),"undefined"!=typeof b._l&&(a._l=b._l),"undefined"!=typeof b._strict&&(a._strict=b._strict),"undefined"!=typeof b._tzm&&(a._tzm=b._tzm),"undefined"!=typeof b._isUTC&&(a._isUTC=b._isUTC),"undefined"!=typeof b._offset&&(a._offset=b._offset),"undefined"!=typeof b._pf&&(a._pf=j(b)),"undefined"!=typeof b._locale&&(a._locale=b._locale),Jc.length>0)for(c in Jc)d=Jc[c],e=b[d],"undefined"!=typeof e&&(a[d]=e);return a}function n(b){m(this,b),this._d=new Date(null!=b._d?b._d.getTime():NaN),Kc===!1&&(Kc=!0,a.updateOffset(this),Kc=!1)}function o(a){return a instanceof n||null!=a&&null!=a._isAMomentObject}function p(a){return 0>a?Math.ceil(a):Math.floor(a)}function q(a){var b=+a,c=0;return 0!==b&&isFinite(b)&&(c=p(b)),c}function r(a,b,c){var d,e=Math.min(a.length,b.length),f=Math.abs(a.length-b.length),g=0;for(d=0;e>d;d++)(c&&a[d]!==b[d]||!c&&q(a[d])!==q(b[d]))&&g++;return g+f}function s(){}function t(a){return a?a.toLowerCase().replace("_","-"):a}function u(a){for(var b,c,d,e,f=0;f<a.length;){for(e=t(a[f]).split("-"),b=e.length,c=t(a[f+1]),c=c?c.split("-"):null;b>0;){if(d=v(e.slice(0,b).join("-")))return d;if(c&&c.length>=b&&r(e,c,!0)>=b-1)break;b--}f++}return null}function v(a){var b=null;if(!Lc[a]&&"undefined"!=typeof module&&module&&module.exports)try{b=Ic._abbr,require("./locale/"+a),w(b)}catch(c){}return Lc[a]}function w(a,b){var c;return a&&(c="undefined"==typeof b?y(a):x(a,b),c&&(Ic=c)),Ic._abbr}function x(a,b){return null!==b?(b.abbr=a,Lc[a]=Lc[a]||new s,Lc[a].set(b),w(a),Lc[a]):(delete Lc[a],null)}function y(a){var b;if(a&&a._locale&&a._locale._abbr&&(a=a._locale._abbr),!a)return Ic;if(!c(a)){if(b=v(a))return b;a=[a]}return u(a)}function z(a,b){var c=a.toLowerCase();Mc[c]=Mc[c+"s"]=Mc[b]=a}function A(a){return"string"==typeof a?Mc[a]||Mc[a.toLowerCase()]:void 0}function B(a){var b,c,d={};for(c in a)f(a,c)&&(b=A(c),b&&(d[b]=a[c]));return d}function C(b,c){return function(d){return null!=d?(E(this,b,d),a.updateOffset(this,c),this):D(this,b)}}function D(a,b){return a._d["get"+(a._isUTC?"UTC":"")+b]()}function E(a,b,c){return a._d["set"+(a._isUTC?"UTC":"")+b](c)}function F(a,b){var c;if("object"==typeof a)for(c in a)this.set(c,a[c]);else if(a=A(a),"function"==typeof this[a])return this[a](b);return this}function G(a,b,c){var d=""+Math.abs(a),e=b-d.length,f=a>=0;return(f?c?"+":"":"-")+Math.pow(10,Math.max(0,e)).toString().substr(1)+d}function H(a,b,c,d){var e=d;"string"==typeof d&&(e=function(){return this[d]()}),a&&(Qc[a]=e),b&&(Qc[b[0]]=function(){return G(e.apply(this,arguments),b[1],b[2])}),c&&(Qc[c]=function(){return this.localeData().ordinal(e.apply(this,arguments),a)})}function I(a){return a.match(/\[[\s\S]/)?a.replace(/^\[|\]$/g,""):a.replace(/\\/g,"")}function J(a){var b,c,d=a.match(Nc);for(b=0,c=d.length;c>b;b++)Qc[d[b]]?d[b]=Qc[d[b]]:d[b]=I(d[b]);return function(e){var f="";for(b=0;c>b;b++)f+=d[b]instanceof Function?d[b].call(e,a):d[b];return f}}function K(a,b){return a.isValid()?(b=L(b,a.localeData()),Pc[b]=Pc[b]||J(b),Pc[b](a)):a.localeData().invalidDate()}function L(a,b){function c(a){return b.longDateFormat(a)||a}var d=5;for(Oc.lastIndex=0;d>=0&&Oc.test(a);)a=a.replace(Oc,c),Oc.lastIndex=0,d-=1;return a}function M(a){return"function"==typeof a&&"[object Function]"===Object.prototype.toString.call(a)}function N(a,b,c){dd[a]=M(b)?b:function(a){return a&&c?c:b}}function O(a,b){return f(dd,a)?dd[a](b._strict,b._locale):new RegExp(P(a))}function P(a){return a.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(a,b,c,d,e){return b||c||d||e}).replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function Q(a,b){var c,d=b;for("string"==typeof a&&(a=[a]),"number"==typeof b&&(d=function(a,c){c[b]=q(a)}),c=0;c<a.length;c++)ed[a[c]]=d}function R(a,b){Q(a,function(a,c,d,e){d._w=d._w||{},b(a,d._w,d,e)})}function S(a,b,c){null!=b&&f(ed,a)&&ed[a](b,c._a,c,a)}function T(a,b){return new Date(Date.UTC(a,b+1,0)).getUTCDate()}function U(a){return this._months[a.month()]}function V(a){return this._monthsShort[a.month()]}function W(a,b,c){var d,e,f;for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),d=0;12>d;d++){if(e=h([2e3,d]),c&&!this._longMonthsParse[d]&&(this._longMonthsParse[d]=new RegExp("^"+this.months(e,"").replace(".","")+"$","i"),this._shortMonthsParse[d]=new RegExp("^"+this.monthsShort(e,"").replace(".","")+"$","i")),c||this._monthsParse[d]||(f="^"+this.months(e,"")+"|^"+this.monthsShort(e,""),this._monthsParse[d]=new RegExp(f.replace(".",""),"i")),c&&"MMMM"===b&&this._longMonthsParse[d].test(a))return d;if(c&&"MMM"===b&&this._shortMonthsParse[d].test(a))return d;if(!c&&this._monthsParse[d].test(a))return d}}function X(a,b){var c;return"string"==typeof b&&(b=a.localeData().monthsParse(b),"number"!=typeof b)?a:(c=Math.min(a.date(),T(a.year(),b)),a._d["set"+(a._isUTC?"UTC":"")+"Month"](b,c),a)}function Y(b){return null!=b?(X(this,b),a.updateOffset(this,!0),this):D(this,"Month")}function Z(){return T(this.year(),this.month())}function $(a){var b,c=a._a;return c&&-2===j(a).overflow&&(b=c[gd]<0||c[gd]>11?gd:c[hd]<1||c[hd]>T(c[fd],c[gd])?hd:c[id]<0||c[id]>24||24===c[id]&&(0!==c[jd]||0!==c[kd]||0!==c[ld])?id:c[jd]<0||c[jd]>59?jd:c[kd]<0||c[kd]>59?kd:c[ld]<0||c[ld]>999?ld:-1,j(a)._overflowDayOfYear&&(fd>b||b>hd)&&(b=hd),j(a).overflow=b),a}function _(b){a.suppressDeprecationWarnings===!1&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+b)}function aa(a,b){var c=!0;return g(function(){return c&&(_(a+"\n"+(new Error).stack),c=!1),b.apply(this,arguments)},b)}function ba(a,b){od[a]||(_(b),od[a]=!0)}function ca(a){var b,c,d=a._i,e=pd.exec(d);if(e){for(j(a).iso=!0,b=0,c=qd.length;c>b;b++)if(qd[b][1].exec(d)){a._f=qd[b][0];break}for(b=0,c=rd.length;c>b;b++)if(rd[b][1].exec(d)){a._f+=(e[6]||" ")+rd[b][0];break}d.match(ad)&&(a._f+="Z"),va(a)}else a._isValid=!1}function da(b){var c=sd.exec(b._i);return null!==c?void(b._d=new Date(+c[1])):(ca(b),void(b._isValid===!1&&(delete b._isValid,a.createFromInputFallback(b))))}function ea(a,b,c,d,e,f,g){var h=new Date(a,b,c,d,e,f,g);return 1970>a&&h.setFullYear(a),h}function fa(a){var b=new Date(Date.UTC.apply(null,arguments));return 1970>a&&b.setUTCFullYear(a),b}function ga(a){return ha(a)?366:365}function ha(a){return a%4===0&&a%100!==0||a%400===0}function ia(){return ha(this.year())}function ja(a,b,c){var d,e=c-b,f=c-a.day();return f>e&&(f-=7),e-7>f&&(f+=7),d=Da(a).add(f,"d"),{week:Math.ceil(d.dayOfYear()/7),year:d.year()}}function ka(a){return ja(a,this._week.dow,this._week.doy).week}function la(){return this._week.dow}function ma(){return this._week.doy}function na(a){var b=this.localeData().week(this);return null==a?b:this.add(7*(a-b),"d")}function oa(a){var b=ja(this,1,4).week;return null==a?b:this.add(7*(a-b),"d")}function pa(a,b,c,d,e){var f,g=6+e-d,h=fa(a,0,1+g),i=h.getUTCDay();return e>i&&(i+=7),c=null!=c?1*c:e,f=1+g+7*(b-1)-i+c,{year:f>0?a:a-1,dayOfYear:f>0?f:ga(a-1)+f}}function qa(a){var b=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return null==a?b:this.add(a-b,"d")}function ra(a,b,c){return null!=a?a:null!=b?b:c}function sa(a){var b=new Date;return a._useUTC?[b.getUTCFullYear(),b.getUTCMonth(),b.getUTCDate()]:[b.getFullYear(),b.getMonth(),b.getDate()]}function ta(a){var b,c,d,e,f=[];if(!a._d){for(d=sa(a),a._w&&null==a._a[hd]&&null==a._a[gd]&&ua(a),a._dayOfYear&&(e=ra(a._a[fd],d[fd]),a._dayOfYear>ga(e)&&(j(a)._overflowDayOfYear=!0),c=fa(e,0,a._dayOfYear),a._a[gd]=c.getUTCMonth(),a._a[hd]=c.getUTCDate()),b=0;3>b&&null==a._a[b];++b)a._a[b]=f[b]=d[b];for(;7>b;b++)a._a[b]=f[b]=null==a._a[b]?2===b?1:0:a._a[b];24===a._a[id]&&0===a._a[jd]&&0===a._a[kd]&&0===a._a[ld]&&(a._nextDay=!0,a._a[id]=0),a._d=(a._useUTC?fa:ea).apply(null,f),null!=a._tzm&&a._d.setUTCMinutes(a._d.getUTCMinutes()-a._tzm),a._nextDay&&(a._a[id]=24)}}function ua(a){var b,c,d,e,f,g,h;b=a._w,null!=b.GG||null!=b.W||null!=b.E?(f=1,g=4,c=ra(b.GG,a._a[fd],ja(Da(),1,4).year),d=ra(b.W,1),e=ra(b.E,1)):(f=a._locale._week.dow,g=a._locale._week.doy,c=ra(b.gg,a._a[fd],ja(Da(),f,g).year),d=ra(b.w,1),null!=b.d?(e=b.d,f>e&&++d):e=null!=b.e?b.e+f:f),h=pa(c,d,e,g,f),a._a[fd]=h.year,a._dayOfYear=h.dayOfYear}function va(b){if(b._f===a.ISO_8601)return void ca(b);b._a=[],j(b).empty=!0;var c,d,e,f,g,h=""+b._i,i=h.length,k=0;for(e=L(b._f,b._locale).match(Nc)||[],c=0;c<e.length;c++)f=e[c],d=(h.match(O(f,b))||[])[0],d&&(g=h.substr(0,h.indexOf(d)),g.length>0&&j(b).unusedInput.push(g),h=h.slice(h.indexOf(d)+d.length),k+=d.length),Qc[f]?(d?j(b).empty=!1:j(b).unusedTokens.push(f),S(f,d,b)):b._strict&&!d&&j(b).unusedTokens.push(f);j(b).charsLeftOver=i-k,h.length>0&&j(b).unusedInput.push(h),j(b).bigHour===!0&&b._a[id]<=12&&b._a[id]>0&&(j(b).bigHour=void 0),b._a[id]=wa(b._locale,b._a[id],b._meridiem),ta(b),$(b)}function wa(a,b,c){var d;return null==c?b:null!=a.meridiemHour?a.meridiemHour(b,c):null!=a.isPM?(d=a.isPM(c),d&&12>b&&(b+=12),d||12!==b||(b=0),b):b}function xa(a){var b,c,d,e,f;if(0===a._f.length)return j(a).invalidFormat=!0,void(a._d=new Date(NaN));for(e=0;e<a._f.length;e++)f=0,b=m({},a),null!=a._useUTC&&(b._useUTC=a._useUTC),b._f=a._f[e],va(b),k(b)&&(f+=j(b).charsLeftOver,f+=10*j(b).unusedTokens.length,j(b).score=f,(null==d||d>f)&&(d=f,c=b));g(a,c||b)}function ya(a){if(!a._d){var b=B(a._i);a._a=[b.year,b.month,b.day||b.date,b.hour,b.minute,b.second,b.millisecond],ta(a)}}function za(a){var b=new n($(Aa(a)));return b._nextDay&&(b.add(1,"d"),b._nextDay=void 0),b}function Aa(a){var b=a._i,e=a._f;return a._locale=a._locale||y(a._l),null===b||void 0===e&&""===b?l({nullInput:!0}):("string"==typeof b&&(a._i=b=a._locale.preparse(b)),o(b)?new n($(b)):(c(e)?xa(a):e?va(a):d(b)?a._d=b:Ba(a),a))}function Ba(b){var f=b._i;void 0===f?b._d=new Date:d(f)?b._d=new Date(+f):"string"==typeof f?da(b):c(f)?(b._a=e(f.slice(0),function(a){return parseInt(a,10)}),ta(b)):"object"==typeof f?ya(b):"number"==typeof f?b._d=new Date(f):a.createFromInputFallback(b)}function Ca(a,b,c,d,e){var f={};return"boolean"==typeof c&&(d=c,c=void 0),f._isAMomentObject=!0,f._useUTC=f._isUTC=e,f._l=c,f._i=a,f._f=b,f._strict=d,za(f)}function Da(a,b,c,d){return Ca(a,b,c,d,!1)}function Ea(a,b){var d,e;if(1===b.length&&c(b[0])&&(b=b[0]),!b.length)return Da();for(d=b[0],e=1;e<b.length;++e)(!b[e].isValid()||b[e][a](d))&&(d=b[e]);return d}function Fa(){var a=[].slice.call(arguments,0);return Ea("isBefore",a)}function Ga(){var a=[].slice.call(arguments,0);return Ea("isAfter",a)}function Ha(a){var b=B(a),c=b.year||0,d=b.quarter||0,e=b.month||0,f=b.week||0,g=b.day||0,h=b.hour||0,i=b.minute||0,j=b.second||0,k=b.millisecond||0;this._milliseconds=+k+1e3*j+6e4*i+36e5*h,this._days=+g+7*f,this._months=+e+3*d+12*c,this._data={},this._locale=y(),this._bubble()}function Ia(a){return a instanceof Ha}function Ja(a,b){H(a,0,0,function(){var a=this.utcOffset(),c="+";return 0>a&&(a=-a,c="-"),c+G(~~(a/60),2)+b+G(~~a%60,2)})}function Ka(a){var b=(a||"").match(ad)||[],c=b[b.length-1]||[],d=(c+"").match(xd)||["-",0,0],e=+(60*d[1])+q(d[2]);return"+"===d[0]?e:-e}function La(b,c){var e,f;return c._isUTC?(e=c.clone(),f=(o(b)||d(b)?+b:+Da(b))-+e,e._d.setTime(+e._d+f),a.updateOffset(e,!1),e):Da(b).local()}function Ma(a){return 15*-Math.round(a._d.getTimezoneOffset()/15)}function Na(b,c){var d,e=this._offset||0;return null!=b?("string"==typeof b&&(b=Ka(b)),Math.abs(b)<16&&(b=60*b),!this._isUTC&&c&&(d=Ma(this)),this._offset=b,this._isUTC=!0,null!=d&&this.add(d,"m"),e!==b&&(!c||this._changeInProgress?bb(this,Ya(b-e,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,a.updateOffset(this,!0),this._changeInProgress=null)),this):this._isUTC?e:Ma(this)}function Oa(a,b){return null!=a?("string"!=typeof a&&(a=-a),this.utcOffset(a,b),this):-this.utcOffset()}function Pa(a){return this.utcOffset(0,a)}function Qa(a){return this._isUTC&&(this.utcOffset(0,a),this._isUTC=!1,a&&this.subtract(Ma(this),"m")),this}function Ra(){return this._tzm?this.utcOffset(this._tzm):"string"==typeof this._i&&this.utcOffset(Ka(this._i)),this}function Sa(a){return a=a?Da(a).utcOffset():0,(this.utcOffset()-a)%60===0}function Ta(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()}function Ua(){if("undefined"!=typeof this._isDSTShifted)return this._isDSTShifted;var a={};if(m(a,this),a=Aa(a),a._a){var b=a._isUTC?h(a._a):Da(a._a);this._isDSTShifted=this.isValid()&&r(a._a,b.toArray())>0}else this._isDSTShifted=!1;return this._isDSTShifted}function Va(){return!this._isUTC}function Wa(){return this._isUTC}function Xa(){return this._isUTC&&0===this._offset}function Ya(a,b){var c,d,e,g=a,h=null;return Ia(a)?g={ms:a._milliseconds,d:a._days,M:a._months}:"number"==typeof a?(g={},b?g[b]=a:g.milliseconds=a):(h=yd.exec(a))?(c="-"===h[1]?-1:1,g={y:0,d:q(h[hd])*c,h:q(h[id])*c,m:q(h[jd])*c,s:q(h[kd])*c,ms:q(h[ld])*c}):(h=zd.exec(a))?(c="-"===h[1]?-1:1,g={y:Za(h[2],c),M:Za(h[3],c),d:Za(h[4],c),h:Za(h[5],c),m:Za(h[6],c),s:Za(h[7],c),w:Za(h[8],c)}):null==g?g={}:"object"==typeof g&&("from"in g||"to"in g)&&(e=_a(Da(g.from),Da(g.to)),g={},g.ms=e.milliseconds,g.M=e.months),d=new Ha(g),Ia(a)&&f(a,"_locale")&&(d._locale=a._locale),d}function Za(a,b){var c=a&&parseFloat(a.replace(",","."));return(isNaN(c)?0:c)*b}function $a(a,b){var c={milliseconds:0,months:0};return c.months=b.month()-a.month()+12*(b.year()-a.year()),a.clone().add(c.months,"M").isAfter(b)&&--c.months,c.milliseconds=+b-+a.clone().add(c.months,"M"),c}function _a(a,b){var c;return b=La(b,a),a.isBefore(b)?c=$a(a,b):(c=$a(b,a),c.milliseconds=-c.milliseconds,c.months=-c.months),c}function ab(a,b){return function(c,d){var e,f;return null===d||isNaN(+d)||(ba(b,"moment()."+b+"(period, number) is deprecated. Please use moment()."+b+"(number, period)."),f=c,c=d,d=f),c="string"==typeof c?+c:c,e=Ya(c,d),bb(this,e,a),this}}function bb(b,c,d,e){var f=c._milliseconds,g=c._days,h=c._months;e=null==e?!0:e,f&&b._d.setTime(+b._d+f*d),g&&E(b,"Date",D(b,"Date")+g*d),h&&X(b,D(b,"Month")+h*d),e&&a.updateOffset(b,g||h)}function cb(a,b){var c=a||Da(),d=La(c,this).startOf("day"),e=this.diff(d,"days",!0),f=-6>e?"sameElse":-1>e?"lastWeek":0>e?"lastDay":1>e?"sameDay":2>e?"nextDay":7>e?"nextWeek":"sameElse";return this.format(b&&b[f]||this.localeData().calendar(f,this,Da(c)))}function db(){return new n(this)}function eb(a,b){var c;return b=A("undefined"!=typeof b?b:"millisecond"),"millisecond"===b?(a=o(a)?a:Da(a),+this>+a):(c=o(a)?+a:+Da(a),c<+this.clone().startOf(b))}function fb(a,b){var c;return b=A("undefined"!=typeof b?b:"millisecond"),"millisecond"===b?(a=o(a)?a:Da(a),+a>+this):(c=o(a)?+a:+Da(a),+this.clone().endOf(b)<c)}function gb(a,b,c){return this.isAfter(a,c)&&this.isBefore(b,c)}function hb(a,b){var c;return b=A(b||"millisecond"),"millisecond"===b?(a=o(a)?a:Da(a),+this===+a):(c=+Da(a),+this.clone().startOf(b)<=c&&c<=+this.clone().endOf(b))}function ib(a,b,c){var d,e,f=La(a,this),g=6e4*(f.utcOffset()-this.utcOffset());return b=A(b),"year"===b||"month"===b||"quarter"===b?(e=jb(this,f),"quarter"===b?e/=3:"year"===b&&(e/=12)):(d=this-f,e="second"===b?d/1e3:"minute"===b?d/6e4:"hour"===b?d/36e5:"day"===b?(d-g)/864e5:"week"===b?(d-g)/6048e5:d),c?e:p(e)}function jb(a,b){var c,d,e=12*(b.year()-a.year())+(b.month()-a.month()),f=a.clone().add(e,"months");return 0>b-f?(c=a.clone().add(e-1,"months"),d=(b-f)/(f-c)):(c=a.clone().add(e+1,"months"),d=(b-f)/(c-f)),-(e+d)}function kb(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")}function lb(){var a=this.clone().utc();return 0<a.year()&&a.year()<=9999?"function"==typeof Date.prototype.toISOString?this.toDate().toISOString():K(a,"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]"):K(a,"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]")}function mb(b){var c=K(this,b||a.defaultFormat);return this.localeData().postformat(c)}function nb(a,b){return this.isValid()?Ya({to:this,from:a}).locale(this.locale()).humanize(!b):this.localeData().invalidDate()}function ob(a){return this.from(Da(),a)}function pb(a,b){return this.isValid()?Ya({from:this,to:a}).locale(this.locale()).humanize(!b):this.localeData().invalidDate()}function qb(a){return this.to(Da(),a)}function rb(a){var b;return void 0===a?this._locale._abbr:(b=y(a),null!=b&&(this._locale=b),this)}function sb(){return this._locale}function tb(a){switch(a=A(a)){case"year":this.month(0);case"quarter":case"month":this.date(1);case"week":case"isoWeek":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===a&&this.weekday(0),"isoWeek"===a&&this.isoWeekday(1),"quarter"===a&&this.month(3*Math.floor(this.month()/3)),this}function ub(a){return a=A(a),void 0===a||"millisecond"===a?this:this.startOf(a).add(1,"isoWeek"===a?"week":a).subtract(1,"ms")}function vb(){return+this._d-6e4*(this._offset||0)}function wb(){return Math.floor(+this/1e3)}function xb(){return this._offset?new Date(+this):this._d}function yb(){var a=this;return[a.year(),a.month(),a.date(),a.hour(),a.minute(),a.second(),a.millisecond()]}function zb(){var a=this;return{years:a.year(),months:a.month(),date:a.date(),hours:a.hours(),minutes:a.minutes(),seconds:a.seconds(),milliseconds:a.milliseconds()}}function Ab(){return k(this)}function Bb(){return g({},j(this))}function Cb(){return j(this).overflow}function Db(a,b){H(0,[a,a.length],0,b)}function Eb(a,b,c){return ja(Da([a,11,31+b-c]),b,c).week}function Fb(a){var b=ja(this,this.localeData()._week.dow,this.localeData()._week.doy).year;return null==a?b:this.add(a-b,"y")}function Gb(a){var b=ja(this,1,4).year;return null==a?b:this.add(a-b,"y")}function Hb(){return Eb(this.year(),1,4)}function Ib(){var a=this.localeData()._week;return Eb(this.year(),a.dow,a.doy)}function Jb(a){return null==a?Math.ceil((this.month()+1)/3):this.month(3*(a-1)+this.month()%3)}function Kb(a,b){return"string"!=typeof a?a:isNaN(a)?(a=b.weekdaysParse(a),"number"==typeof a?a:null):parseInt(a,10)}function Lb(a){return this._weekdays[a.day()]}function Mb(a){return this._weekdaysShort[a.day()]}function Nb(a){return this._weekdaysMin[a.day()]}function Ob(a){var b,c,d;for(this._weekdaysParse=this._weekdaysParse||[],b=0;7>b;b++)if(this._weekdaysParse[b]||(c=Da([2e3,1]).day(b),d="^"+this.weekdays(c,"")+"|^"+this.weekdaysShort(c,"")+"|^"+this.weekdaysMin(c,""),this._weekdaysParse[b]=new RegExp(d.replace(".",""),"i")),this._weekdaysParse[b].test(a))return b}function Pb(a){var b=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=a?(a=Kb(a,this.localeData()),this.add(a-b,"d")):b}function Qb(a){var b=(this.day()+7-this.localeData()._week.dow)%7;return null==a?b:this.add(a-b,"d")}function Rb(a){return null==a?this.day()||7:this.day(this.day()%7?a:a-7)}function Sb(a,b){H(a,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),b)})}function Tb(a,b){return b._meridiemParse}function Ub(a){return"p"===(a+"").toLowerCase().charAt(0)}function Vb(a,b,c){return a>11?c?"pm":"PM":c?"am":"AM"}function Wb(a,b){b[ld]=q(1e3*("0."+a))}function Xb(){return this._isUTC?"UTC":""}function Yb(){return this._isUTC?"Coordinated Universal Time":""}function Zb(a){return Da(1e3*a)}function $b(){return Da.apply(null,arguments).parseZone()}function _b(a,b,c){var d=this._calendar[a];return"function"==typeof d?d.call(b,c):d}function ac(a){var b=this._longDateFormat[a],c=this._longDateFormat[a.toUpperCase()];return b||!c?b:(this._longDateFormat[a]=c.replace(/MMMM|MM|DD|dddd/g,function(a){return a.slice(1)}),this._longDateFormat[a])}function bc(){return this._invalidDate}function cc(a){return this._ordinal.replace("%d",a)}function dc(a){return a}function ec(a,b,c,d){var e=this._relativeTime[c];return"function"==typeof e?e(a,b,c,d):e.replace(/%d/i,a)}function fc(a,b){var c=this._relativeTime[a>0?"future":"past"];return"function"==typeof c?c(b):c.replace(/%s/i,b)}function gc(a){var b,c;for(c in a)b=a[c],"function"==typeof b?this[c]=b:this["_"+c]=b;this._ordinalParseLenient=new RegExp(this._ordinalParse.source+"|"+/\d{1,2}/.source)}function hc(a,b,c,d){var e=y(),f=h().set(d,b);return e[c](f,a)}function ic(a,b,c,d,e){if("number"==typeof a&&(b=a,a=void 0),a=a||"",null!=b)return hc(a,b,c,e);var f,g=[];for(f=0;d>f;f++)g[f]=hc(a,f,c,e);return g}function jc(a,b){return ic(a,b,"months",12,"month")}function kc(a,b){return ic(a,b,"monthsShort",12,"month")}function lc(a,b){return ic(a,b,"weekdays",7,"day")}function mc(a,b){return ic(a,b,"weekdaysShort",7,"day")}function nc(a,b){return ic(a,b,"weekdaysMin",7,"day")}function oc(){var a=this._data;return this._milliseconds=Wd(this._milliseconds),this._days=Wd(this._days),this._months=Wd(this._months),a.milliseconds=Wd(a.milliseconds),a.seconds=Wd(a.seconds),a.minutes=Wd(a.minutes),a.hours=Wd(a.hours),a.months=Wd(a.months),a.years=Wd(a.years),this}function pc(a,b,c,d){var e=Ya(b,c);return a._milliseconds+=d*e._milliseconds,a._days+=d*e._days,a._months+=d*e._months,a._bubble()}function qc(a,b){return pc(this,a,b,1)}function rc(a,b){return pc(this,a,b,-1)}function sc(a){return 0>a?Math.floor(a):Math.ceil(a)}function tc(){var a,b,c,d,e,f=this._milliseconds,g=this._days,h=this._months,i=this._data;return f>=0&&g>=0&&h>=0||0>=f&&0>=g&&0>=h||(f+=864e5*sc(vc(h)+g),g=0,h=0),i.milliseconds=f%1e3,a=p(f/1e3),i.seconds=a%60,b=p(a/60),i.minutes=b%60,c=p(b/60),i.hours=c%24,g+=p(c/24),e=p(uc(g)),h+=e,g-=sc(vc(e)),d=p(h/12),h%=12,i.days=g,i.months=h,i.years=d,this}function uc(a){return 4800*a/146097}function vc(a){return 146097*a/4800}function wc(a){var b,c,d=this._milliseconds;if(a=A(a),"month"===a||"year"===a)return b=this._days+d/864e5,c=this._months+uc(b),"month"===a?c:c/12;switch(b=this._days+Math.round(vc(this._months)),a){case"week":return b/7+d/6048e5;case"day":return b+d/864e5;case"hour":return 24*b+d/36e5;case"minute":return 1440*b+d/6e4;case"second":return 86400*b+d/1e3;case"millisecond":return Math.floor(864e5*b)+d;default:throw new Error("Unknown unit "+a)}}function xc(){return this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*q(this._months/12)}function yc(a){return function(){return this.as(a)}}function zc(a){return a=A(a),this[a+"s"]()}function Ac(a){return function(){return this._data[a]}}function Bc(){return p(this.days()/7)}function Cc(a,b,c,d,e){return e.relativeTime(b||1,!!c,a,d)}function Dc(a,b,c){var d=Ya(a).abs(),e=ke(d.as("s")),f=ke(d.as("m")),g=ke(d.as("h")),h=ke(d.as("d")),i=ke(d.as("M")),j=ke(d.as("y")),k=e<le.s&&["s",e]||1===f&&["m"]||f<le.m&&["mm",f]||1===g&&["h"]||g<le.h&&["hh",g]||1===h&&["d"]||h<le.d&&["dd",h]||1===i&&["M"]||i<le.M&&["MM",i]||1===j&&["y"]||["yy",j];return k[2]=b,k[3]=+a>0,k[4]=c,Cc.apply(null,k)}function Ec(a,b){return void 0===le[a]?!1:void 0===b?le[a]:(le[a]=b,!0)}function Fc(a){var b=this.localeData(),c=Dc(this,!a,b);return a&&(c=b.pastFuture(+this,c)),b.postformat(c)}function Gc(){var a,b,c,d=me(this._milliseconds)/1e3,e=me(this._days),f=me(this._months);a=p(d/60),b=p(a/60),d%=60,a%=60,c=p(f/12),f%=12;var g=c,h=f,i=e,j=b,k=a,l=d,m=this.asSeconds();return m?(0>m?"-":"")+"P"+(g?g+"Y":"")+(h?h+"M":"")+(i?i+"D":"")+(j||k||l?"T":"")+(j?j+"H":"")+(k?k+"M":"")+(l?l+"S":""):"P0D"}var Hc,Ic,Jc=a.momentProperties=[],Kc=!1,Lc={},Mc={},Nc=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Q|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,Oc=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,Pc={},Qc={},Rc=/\d/,Sc=/\d\d/,Tc=/\d{3}/,Uc=/\d{4}/,Vc=/[+-]?\d{6}/,Wc=/\d\d?/,Xc=/\d{1,3}/,Yc=/\d{1,4}/,Zc=/[+-]?\d{1,6}/,$c=/\d+/,_c=/[+-]?\d+/,ad=/Z|[+-]\d\d:?\d\d/gi,bd=/[+-]?\d+(\.\d{1,3})?/,cd=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,dd={},ed={},fd=0,gd=1,hd=2,id=3,jd=4,kd=5,ld=6;H("M",["MM",2],"Mo",function(){return this.month()+1}),H("MMM",0,0,function(a){return this.localeData().monthsShort(this,a)}),H("MMMM",0,0,function(a){return this.localeData().months(this,a)}),z("month","M"),N("M",Wc),N("MM",Wc,Sc),N("MMM",cd),N("MMMM",cd),Q(["M","MM"],function(a,b){b[gd]=q(a)-1}),Q(["MMM","MMMM"],function(a,b,c,d){var e=c._locale.monthsParse(a,d,c._strict);null!=e?b[gd]=e:j(c).invalidMonth=a});var md="January_February_March_April_May_June_July_August_September_October_November_December".split("_"),nd="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),od={};a.suppressDeprecationWarnings=!1;var pd=/^\s*(?:[+-]\d{6}|\d{4})-(?:(\d\d-\d\d)|(W\d\d$)|(W\d\d-\d)|(\d\d\d))((T| )(\d\d(:\d\d(:\d\d(\.\d+)?)?)?)?([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,qd=[["YYYYYY-MM-DD",/[+-]\d{6}-\d{2}-\d{2}/],["YYYY-MM-DD",/\d{4}-\d{2}-\d{2}/],["GGGG-[W]WW-E",/\d{4}-W\d{2}-\d/],["GGGG-[W]WW",/\d{4}-W\d{2}/],["YYYY-DDD",/\d{4}-\d{3}/]],rd=[["HH:mm:ss.SSSS",/(T| )\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],sd=/^\/?Date\((\-?\d+)/i;a.createFromInputFallback=aa("moment construction falls back to js Date. This is discouraged and will be removed in upcoming major release. Please refer to https://github.com/moment/moment/issues/1407 for more info.",function(a){a._d=new Date(a._i+(a._useUTC?" UTC":""))}),H(0,["YY",2],0,function(){return this.year()%100}),H(0,["YYYY",4],0,"year"),H(0,["YYYYY",5],0,"year"),H(0,["YYYYYY",6,!0],0,"year"),z("year","y"),N("Y",_c),N("YY",Wc,Sc),N("YYYY",Yc,Uc),N("YYYYY",Zc,Vc),N("YYYYYY",Zc,Vc),Q(["YYYYY","YYYYYY"],fd),Q("YYYY",function(b,c){c[fd]=2===b.length?a.parseTwoDigitYear(b):q(b)}),Q("YY",function(b,c){c[fd]=a.parseTwoDigitYear(b)}),a.parseTwoDigitYear=function(a){return q(a)+(q(a)>68?1900:2e3)};var td=C("FullYear",!1);H("w",["ww",2],"wo","week"),H("W",["WW",2],"Wo","isoWeek"),z("week","w"),z("isoWeek","W"),N("w",Wc),N("ww",Wc,Sc),N("W",Wc),N("WW",Wc,Sc),R(["w","ww","W","WW"],function(a,b,c,d){b[d.substr(0,1)]=q(a)});var ud={dow:0,doy:6};H("DDD",["DDDD",3],"DDDo","dayOfYear"),z("dayOfYear","DDD"),N("DDD",Xc),N("DDDD",Tc),Q(["DDD","DDDD"],function(a,b,c){c._dayOfYear=q(a)}),a.ISO_8601=function(){};var vd=aa("moment().min is deprecated, use moment.min instead. https://github.com/moment/moment/issues/1548",function(){var a=Da.apply(null,arguments);return this>a?this:a}),wd=aa("moment().max is deprecated, use moment.max instead. https://github.com/moment/moment/issues/1548",function(){var a=Da.apply(null,arguments);return a>this?this:a});Ja("Z",":"),Ja("ZZ",""),N("Z",ad),N("ZZ",ad),Q(["Z","ZZ"],function(a,b,c){c._useUTC=!0,c._tzm=Ka(a)});var xd=/([\+\-]|\d\d)/gi;a.updateOffset=function(){};var yd=/(\-)?(?:(\d*)\.)?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?)?/,zd=/^(-)?P(?:(?:([0-9,.]*)Y)?(?:([0-9,.]*)M)?(?:([0-9,.]*)D)?(?:T(?:([0-9,.]*)H)?(?:([0-9,.]*)M)?(?:([0-9,.]*)S)?)?|([0-9,.]*)W)$/;Ya.fn=Ha.prototype;var Ad=ab(1,"add"),Bd=ab(-1,"subtract");a.defaultFormat="YYYY-MM-DDTHH:mm:ssZ";var Cd=aa("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(a){return void 0===a?this.localeData():this.locale(a)});H(0,["gg",2],0,function(){return this.weekYear()%100}),H(0,["GG",2],0,function(){return this.isoWeekYear()%100}),Db("gggg","weekYear"),Db("ggggg","weekYear"),Db("GGGG","isoWeekYear"),Db("GGGGG","isoWeekYear"),z("weekYear","gg"),z("isoWeekYear","GG"),N("G",_c),N("g",_c),N("GG",Wc,Sc),N("gg",Wc,Sc),N("GGGG",Yc,Uc),N("gggg",Yc,Uc),N("GGGGG",Zc,Vc),N("ggggg",Zc,Vc),R(["gggg","ggggg","GGGG","GGGGG"],function(a,b,c,d){b[d.substr(0,2)]=q(a)}),R(["gg","GG"],function(b,c,d,e){c[e]=a.parseTwoDigitYear(b)}),H("Q",0,0,"quarter"),z("quarter","Q"),N("Q",Rc),Q("Q",function(a,b){b[gd]=3*(q(a)-1)}),H("D",["DD",2],"Do","date"),z("date","D"),N("D",Wc),N("DD",Wc,Sc),N("Do",function(a,b){return a?b._ordinalParse:b._ordinalParseLenient}),Q(["D","DD"],hd),Q("Do",function(a,b){b[hd]=q(a.match(Wc)[0],10)});var Dd=C("Date",!0);H("d",0,"do","day"),H("dd",0,0,function(a){return this.localeData().weekdaysMin(this,a)}),H("ddd",0,0,function(a){return this.localeData().weekdaysShort(this,a)}),H("dddd",0,0,function(a){return this.localeData().weekdays(this,a)}),H("e",0,0,"weekday"),H("E",0,0,"isoWeekday"),z("day","d"),z("weekday","e"),z("isoWeekday","E"),N("d",Wc),N("e",Wc),N("E",Wc),N("dd",cd),N("ddd",cd),N("dddd",cd),R(["dd","ddd","dddd"],function(a,b,c){var d=c._locale.weekdaysParse(a);null!=d?b.d=d:j(c).invalidWeekday=a}),R(["d","e","E"],function(a,b,c,d){b[d]=q(a)});var Ed="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),Fd="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),Gd="Su_Mo_Tu_We_Th_Fr_Sa".split("_");H("H",["HH",2],0,"hour"),H("h",["hh",2],0,function(){return this.hours()%12||12}),Sb("a",!0),Sb("A",!1),z("hour","h"),N("a",Tb),N("A",Tb),N("H",Wc),N("h",Wc),N("HH",Wc,Sc),N("hh",Wc,Sc),Q(["H","HH"],id),Q(["a","A"],function(a,b,c){c._isPm=c._locale.isPM(a),c._meridiem=a}),Q(["h","hh"],function(a,b,c){b[id]=q(a),j(c).bigHour=!0});var Hd=/[ap]\.?m?\.?/i,Id=C("Hours",!0);H("m",["mm",2],0,"minute"),z("minute","m"),N("m",Wc),N("mm",Wc,Sc),Q(["m","mm"],jd);var Jd=C("Minutes",!1);H("s",["ss",2],0,"second"),z("second","s"),N("s",Wc),N("ss",Wc,Sc),Q(["s","ss"],kd);var Kd=C("Seconds",!1);H("S",0,0,function(){return~~(this.millisecond()/100)}),H(0,["SS",2],0,function(){return~~(this.millisecond()/10)}),H(0,["SSS",3],0,"millisecond"),H(0,["SSSS",4],0,function(){return 10*this.millisecond()}),H(0,["SSSSS",5],0,function(){return 100*this.millisecond()}),H(0,["SSSSSS",6],0,function(){return 1e3*this.millisecond()}),H(0,["SSSSSSS",7],0,function(){return 1e4*this.millisecond()}),H(0,["SSSSSSSS",8],0,function(){return 1e5*this.millisecond()}),H(0,["SSSSSSSSS",9],0,function(){return 1e6*this.millisecond()}),z("millisecond","ms"),N("S",Xc,Rc),N("SS",Xc,Sc),N("SSS",Xc,Tc);var Ld;for(Ld="SSSS";Ld.length<=9;Ld+="S")N(Ld,$c);for(Ld="S";Ld.length<=9;Ld+="S")Q(Ld,Wb);var Md=C("Milliseconds",!1);H("z",0,0,"zoneAbbr"),H("zz",0,0,"zoneName");var Nd=n.prototype;Nd.add=Ad,Nd.calendar=cb,Nd.clone=db,Nd.diff=ib,Nd.endOf=ub,Nd.format=mb,Nd.from=nb,Nd.fromNow=ob,Nd.to=pb,Nd.toNow=qb,Nd.get=F,Nd.invalidAt=Cb,Nd.isAfter=eb,Nd.isBefore=fb,Nd.isBetween=gb,Nd.isSame=hb,Nd.isValid=Ab,Nd.lang=Cd,Nd.locale=rb,Nd.localeData=sb,Nd.max=wd,Nd.min=vd,Nd.parsingFlags=Bb,Nd.set=F,Nd.startOf=tb,Nd.subtract=Bd,Nd.toArray=yb,Nd.toObject=zb,Nd.toDate=xb,Nd.toISOString=lb,Nd.toJSON=lb,Nd.toString=kb,Nd.unix=wb,Nd.valueOf=vb,Nd.year=td,Nd.isLeapYear=ia,Nd.weekYear=Fb,Nd.isoWeekYear=Gb,Nd.quarter=Nd.quarters=Jb,Nd.month=Y,Nd.daysInMonth=Z,Nd.week=Nd.weeks=na,Nd.isoWeek=Nd.isoWeeks=oa,Nd.weeksInYear=Ib,Nd.isoWeeksInYear=Hb,Nd.date=Dd,Nd.day=Nd.days=Pb,Nd.weekday=Qb,Nd.isoWeekday=Rb,Nd.dayOfYear=qa,Nd.hour=Nd.hours=Id,Nd.minute=Nd.minutes=Jd,Nd.second=Nd.seconds=Kd,
Nd.millisecond=Nd.milliseconds=Md,Nd.utcOffset=Na,Nd.utc=Pa,Nd.local=Qa,Nd.parseZone=Ra,Nd.hasAlignedHourOffset=Sa,Nd.isDST=Ta,Nd.isDSTShifted=Ua,Nd.isLocal=Va,Nd.isUtcOffset=Wa,Nd.isUtc=Xa,Nd.isUTC=Xa,Nd.zoneAbbr=Xb,Nd.zoneName=Yb,Nd.dates=aa("dates accessor is deprecated. Use date instead.",Dd),Nd.months=aa("months accessor is deprecated. Use month instead",Y),Nd.years=aa("years accessor is deprecated. Use year instead",td),Nd.zone=aa("moment().zone is deprecated, use moment().utcOffset instead. https://github.com/moment/moment/issues/1779",Oa);var Od=Nd,Pd={sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},Qd={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},Rd="Invalid date",Sd="%d",Td=/\d{1,2}/,Ud={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},Vd=s.prototype;Vd._calendar=Pd,Vd.calendar=_b,Vd._longDateFormat=Qd,Vd.longDateFormat=ac,Vd._invalidDate=Rd,Vd.invalidDate=bc,Vd._ordinal=Sd,Vd.ordinal=cc,Vd._ordinalParse=Td,Vd.preparse=dc,Vd.postformat=dc,Vd._relativeTime=Ud,Vd.relativeTime=ec,Vd.pastFuture=fc,Vd.set=gc,Vd.months=U,Vd._months=md,Vd.monthsShort=V,Vd._monthsShort=nd,Vd.monthsParse=W,Vd.week=ka,Vd._week=ud,Vd.firstDayOfYear=ma,Vd.firstDayOfWeek=la,Vd.weekdays=Lb,Vd._weekdays=Ed,Vd.weekdaysMin=Nb,Vd._weekdaysMin=Gd,Vd.weekdaysShort=Mb,Vd._weekdaysShort=Fd,Vd.weekdaysParse=Ob,Vd.isPM=Ub,Vd._meridiemParse=Hd,Vd.meridiem=Vb,w("en",{ordinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(a){var b=a%10,c=1===q(a%100/10)?"th":1===b?"st":2===b?"nd":3===b?"rd":"th";return a+c}}),a.lang=aa("moment.lang is deprecated. Use moment.locale instead.",w),a.langData=aa("moment.langData is deprecated. Use moment.localeData instead.",y);var Wd=Math.abs,Xd=yc("ms"),Yd=yc("s"),Zd=yc("m"),$d=yc("h"),_d=yc("d"),ae=yc("w"),be=yc("M"),ce=yc("y"),de=Ac("milliseconds"),ee=Ac("seconds"),fe=Ac("minutes"),ge=Ac("hours"),he=Ac("days"),ie=Ac("months"),je=Ac("years"),ke=Math.round,le={s:45,m:45,h:22,d:26,M:11},me=Math.abs,ne=Ha.prototype;ne.abs=oc,ne.add=qc,ne.subtract=rc,ne.as=wc,ne.asMilliseconds=Xd,ne.asSeconds=Yd,ne.asMinutes=Zd,ne.asHours=$d,ne.asDays=_d,ne.asWeeks=ae,ne.asMonths=be,ne.asYears=ce,ne.valueOf=xc,ne._bubble=tc,ne.get=zc,ne.milliseconds=de,ne.seconds=ee,ne.minutes=fe,ne.hours=ge,ne.days=he,ne.weeks=Bc,ne.months=ie,ne.years=je,ne.humanize=Fc,ne.toISOString=Gc,ne.toString=Gc,ne.toJSON=Gc,ne.locale=rb,ne.localeData=sb,ne.toIsoString=aa("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",Gc),ne.lang=Cd,H("X",0,0,"unix"),H("x",0,0,"valueOf"),N("x",_c),N("X",bd),Q("X",function(a,b,c){c._d=new Date(1e3*parseFloat(a,10))}),Q("x",function(a,b,c){c._d=new Date(q(a))}),a.version="2.10.6",b(Da),a.fn=Od,a.min=Fa,a.max=Ga,a.utc=h,a.unix=Zb,a.months=jc,a.isDate=d,a.locale=w,a.invalid=l,a.duration=Ya,a.isMoment=o,a.weekdays=lc,a.parseZone=$b,a.localeData=y,a.isDuration=Ia,a.monthsShort=kc,a.weekdaysMin=nc,a.defineLocale=x,a.weekdaysShort=mc,a.normalizeUnits=A,a.relativeTimeThreshold=Ec;var oe=a;return oe});


// hypertable plugin
$.fn.hyperTable = function (options) {
    console.log('initialized hypertable plugin')
    checkType = function (htmlcontent) { /*check element type to for images,links,js*/
        var content = $(htmlcontent).html(); 
        try {
            if ($(content).is('img')) {
                imgobj = {
                    src: $(content).attr('src'),
                    title: $(content).attr('title')
                }
                return imgobj
            }
            else if ($(content).is('a')) {
                linkobj = {
                    text: $(content).attr('title'),
                    href: $(content).attr('href'),
                    js: 'onclick=' + $(content).attr('onclick')
                }
                return linkobj;
            }
            else {
                contentObj = {
                    html:$(htmlcontent).html().trim(),
                    text:$(htmlcontent).text().trim()
                }
                return contentObj
            }
        }
        catch (err) {return $(htmlcontent).text().trim(); }
    }
    var collection = [], headings = [], dataObj = {}, paginated = this.find('.BBPager'); if (paginated.length > 0) {
        this.find('tr:first-child, tr:last-child').addClass('ignore'); this.find('tr:first-child').next().addClass('headings ignore').find('th').each(function (id, value) {headings.push($(value).text().toLowerCase().replace(/ /g,'_').trim()); }); this.find('tr:first-child').addClass('datakeys').find('th,td').each(function (index, value) {headings.push($(value).text().trim()); }); }
    else { /* if no pagination */
        this.find('tr:first-child').addClass('datakeys').find('th,td').each(function (index, value) {headings.push($(value).text().trim().toLowerCase().replace(/ /g,'_')); }); }
    if (options === 'object') {
        this.find('tr').each(function (indx, obj) {dataObj[$(this).find('td:first-child').text().trim().replace(/ /g,'_')] = checkType($(this).find('td:last-child')); }); return dataObj; }
    else {
        this.find('tr.datakeys').siblings().each(function () {if (!$(this).hasClass('ignore')) {$(this).addClass('data'); } }); this.find('tr.data').each(function (indx, obj) {var data = {}; $(obj).children('td').each(function (id, elem) {data[headings[id].toLowerCase().replace(' ', '_')] = checkType($(elem)); delete(data['']); }); collection.push(data); }); return collection; }
}; // end hypertable
// var editorHtml = `<div class="col6 editor"> {% if componentLayout.inputs %} <div id="editorbtns" class="row show-add-slide"> <ul class="btn-group"> <li><a title="add" class="addpost" href="#">Add Item</a></li> <li> <a title="update" class="updatepost" href="#">Update Item</a> </li> <li> <a title="cancel" class="cancelpost" href="#">Cancel</a> </li> </ul> </div> <div id="editor-inputs"> {% for inputs in componentLayout.inputs %} {% set attrName = inputs.name|replace(" ","_")|lower %} {% if inputs.type == "text" %} <div class="row"> <label for="{{attrName}}">{{inputs.name}}:</label> <input class="ccp" data-name="{{attrName}}" data-type="text" type="text" id="{{attrName}}" maxlength="50"/> </div> {% endif %} {% if inputs.type == "image" %} <div class="row"> <label for="{{attrName}}">{{inputs.name}}</label> <div id="{{attrName}}" data-name="{{attrName}}" data-type="image" class="ccp imagearea"> <span> CLICK HERE TO ADD IMAGE</span></div> </div> {% endif %} {% if inputs.type == "link" %} <div class="row input-group"> <button title="Create Link" class="fa hyper-link col3 input-group-btn">{{inputs.name}}:</button> <div class="col9 input-group-field"><input class="ccp" data-name="{{attrName}}" data-type="link" type="text" id="{{attrName}}" placeholder="http://www.mywebsite.com"></div> </div> {% endif %} {% if inputs.type == "editor" or inputs.type == "textarea" %} <div class="row" id="{% if inputs.type == "editor" %}simpleMDE{% endif %}"> <label for="{{attrName}}">{{inputs.name}}</label> <textarea class="ccp" data-name="{{attrName}}" data-type="textarea" name="{{attrName}}" id="{{attrName}}" cols="30" rows="10" maxlength="180"></textarea> </div> {% endif %} {% endfor %} </div> {% else %} {% endif %} </div> <div class="col6 last"> <div id="part-settings" class="row"> <ul class="btn-group"> {% if componentLayout.inputs %} <li> <a title="show content" class="show-content" href="#">Content</a> </li> {% endif %} {% if componentLayout.settingsInputs %} <li> <a title="show settings" class="show-settings" href="#">Settings</a> </li> {% endif %} <li> <a title="show layout" class="show-layout" href="#">Layout</a> </li> </ul> </div> <div id="part-view" class="row show-content"> {% if componentLayout.inputs %} <div id="hypertable"> <h1>{{template|replace("_"," ")}} content</h1> <p>Drag and drop table rows to sort list.</p> <table id="hypertable" class="striped" border="0" cellspacing="0" cellpadding="0"> <thead><tr> <td>id</td> <td>{{template|replace("_"," ")}}</td> <td>Update</td> <td>Delete</td> </tr></thead> <tbody class="sortme"> {% for post in data %} {% set attrName = datakeys[loop.index0] %} <tr class="post{{loop.index0}}" data-id="{{loop.index0}}"> <td>{{loop.index0}}</td> <td> {% for key,val in post %} {% if 'image' in key.split('_') %} {{val.html}} {% elif 'text' in key.split('_') %} <span>{{val.text}}</span> {% endif %} {% endfor %} </td> <td><a title="edit" class="editpost" href="#" data-id="{{loop.index0}}">Edit Item</a></td> <td><a title="delete" class="deletepost" href="#" data-id="{{loop.index0}}"></td> </tr> {% endfor %} </tbody> </table> </div> {% endif %} <div id="hypertable-settings" class="row"> <h3>{{template|replace("_"," ")}} Settings</h3> {% if componentLayout.settingsInputs %} {% for inputs in componentLayout.settingsInputs %} {% set attrName = inputs.name|replace(" ","_")|lower %} {% if inputs.type == "checkbox" %} <div class="row"> <label for="{{attrName}}">{{inputs.name}}</label> <input type="checkbox" id="{{attrName}}" class="ccp-settings" {% if configs[attrName] %}checked{% endif %}> </div> {% endif %} {% if inputs.type == "radio" %} <div class="row"> <label for="{{attrName}}">{{inputs.name}}</label> <input type="radio" id="{{attrName}}" class="ccp-settings" {% if configs[attrName] %}checked{% endif %}> </div> {% endif %} {% if inputs.type == "image" %} <div class="row"> <label for="{{attrName}}">{{inputs.name}}</label> <div id="{{attrName}}" data-name="{{attrName}}" data-type="image" class="ccp-settings imagearea"> {% if configs[attrName].html != '' %}{{configs[attrName].html}}{% else %}<span> CLICK HERE TO ADD IMAGE</span>{% endif %}</div> </div> {% endif %} {% if inputs.type == "color" %} <div class="row"> <label for="{{attrName}}">{{inputs.name}}:</label> <input type="text" id="{{attrName}}" class="ccp-settings" value="{% if configs[attrName] %}{{ configs[attrName] }}{% endif %}"> <input type="color" id="{{attrName}}" value="{% if configs[attrName] %}{{ configs[attrName] }}{% endif %}"> </div> {% endif %} {% if inputs.type == "text" %} <div class="row"> <label for="{{attrName}}">{{inputs.name}}</label> <input type="text" id="{{attrName}}" class="ccp-settings" placeholder="{{inputs.placeholder}}" value="{% if configs[attrName] %}{{configs[attrName]}}{% endif %}"> </div> {% endif %} {% if inputs.type == "editor" or inputs.type == "textarea" %} <div class="row" id="{% if inputs.type == "editor" %}simpleMDE{% endif %}"> <label for="{{attrName}}">{{inputs.name}}</label> <textarea id="{{attrName}}" class="ccp-settings" type="textarea" cols="30" rows="10">{% if configs[attrName] !="" %}{{ configs[attrName] }}{% endif %}</textarea> </div> {% endif %} {% endfor %} {% endif %} </div> <div id="hypertable-layout"> <h3>Insert layout html code.</h3> <textarea type="textarea" id="layout" class="ccp-settings" cols="30" rows="10">{% if configs["layout"] %}{{ configs.layout }}{% endif %}</textarea> </div> </div> </div>`; 
var env;
var HYPER = HYPER || {
    Config: {
        version: '1.2.0',
        updated: '10/13/2016',
        author: "Derry Spann",
        github: "github.com/hypertables",
        path_to_templates: '/file/webdev/templates'
    },
    CCPeditor: {
        init: function(){
            HYPER.CCPeditor.renderTemplate();
            HYPER.CCPeditor.initEditorActions();
        },
// editorstring: editorHtml,
getModuleDataKeys: function(){
        var keylist = BLACKBAUD.api.customPartEditor.settings.collection.componentLayout.inputs
        $(keylist).each(function(i,keys){
        moduledatakeys.push( keys.name.toLowerCase().replace(' ','_') );
        });
},
renderTemplate: function(){
            console.log('start editor template');
            if(BLACKBAUD.api.customPartEditor.settings.collection.componentLayout){
                HYPER.CCPeditor.getModuleDataKeys();
                editorsettings = {
                    "data":moduledata,
                    "datakeys":moduledatakeys,
                    "configs":moduleconfigs,
                    "componentLayout":BLACKBAUD.api.customPartEditor.settings.collection.componentLayout,
                    "template":BLACKBAUD.api.customPartEditor.settings.collection.componentLayout.name
                }
                var env = nunjucks.configure('/file/webdev/templates');
                var editorview = env.render('editor.html', editorsettings);
                // var editorview = env.renderString(HYPER.CCPeditor.editorstring, editorsettings);
                $('#editorview').empty().prepend(editorview);
            }
        },
        initEditorActions: function(){
            console.log('start editor template funcitons');
            var markdowncontent;
            var configs ={};
            var htmlcontent;
            var component = '{{ component }}';

            function initializeEditor(){
                //editor options
                // var pclass = parentClass || ''
                try{
                    myeditor = new SimpleMDE({ 
                        element: document.querySelector("#simpleMDE textarea"),
                        indentWitTabs: false,
                        spellChecker: false,
                        toolbar: [
                        // LINK PICKER AND IMAGE PICKER DISABLED FOR SLIDER
                        // {
                        //     name: "hyperbtn",
                        //     action: launchLinkEditor,
                        //     className: "fa hyper-link",
                        //     title: "BB link Picker",
                        // },
                        // {
                        //     name: "BBImagePicker",
                        //     action: launchImageEditor,
                        //     className: "fa hyper-image",
                        //     title: "BB Image Picker",
                        // },
                        "heading-1","bold","heading-2","preview"]
                    });
                    //save markdown/html content
                    myeditor.codemirror.on("change", function(){
                        console.log(myeditor.value());
                        markdowncontent = myeditor.value();
                        htmlcontent = SimpleMDE.prototype.markdown(markdowncontent);
                    });

                }catch(err){
                    console.log(err,'Unable to find library for SimpleMDE')
                }

            }

            MODEL = {
                // Below are general object models for different module types
                // Kwargs are used to add additional key value pairs
                mapData : function(postObj){
                    for (var i = 0; i < Object.keys(postObj).length; i++) { 
                        var attrName = Object.keys(postObj)[i]
                        if(postObj[attrName].type == 'textarea'){
                            try{
                                myeditor.value( postObj[attrName].md );
                            }catch(err){
                                console.log(err);
                            }
                        }else if(postObj[attrName].type == 'link'){
                            $('#'+attrName).val(postObj[attrName].url);
                        }else if(postObj[attrName].type == 'image'){
                            if(postObj[attrName])
                                $('#'+attrName).html(postObj[attrName].html);
                        }else{
                            $('#'+attrName).val(postObj[attrName]);
                        }
                    }
                },
                getData : function(kwargs){
                    jsonifyContent = function(settings){
                        processMedia = function(elem){
                            var mediatype = $(elem).data('type');
                                    if(mediatype == 'image'){
                                        if($('.imagearea img').length > 0){
                                        image = $('.imagearea img');
                                        imgobj = {type:mediatype,html:$(image)[0].outerHTML,alt:$(image).attr('alt'),title:$(image).attr('title'),url:$(image).attr('src')}
                                        return imgobj;
                                        }
                                        return false
                                    }else if(mediatype == 'link'){
                                        videoobj = {url:$(elem).val(),type:mediatype};
                                        return videoobj;
                                    }else if(mediatype == 'textarea'){ 
                                        settings['type'] = mediatype;
                                        return settings;
                                    }else{ 
                                        return $(elem).val();
                                        // return {text:$(elem).val(),type:mediatype}
                                    }
                                };
                        var data = {};
                        $(".ccp").each(function(){
                            var key = $(this).data('name');
                            var value = processMedia(this);
                            if(key && value)
                                data[key] = value;
                        });
                        return data
                    }
                    var dataObj = jsonifyContent({"html":htmlcontent,"md":markdowncontent});
                    console.log(dataObj);
                    return dataObj
                }
            }
            
            // launch the image editor
            function launchImageEditor() {
                BLACKBAUD.api.customPartEditor.images.launchImagePicker({
                    callback: addImage
                });
            }

            // insert link data and save link settings
            function addImage(image){
                //store new image object
                if(image.name != undefined){
                var image = '<img class="ccp" data-type="image" name="image" title="'+image.name+'" src="'+image.url+'" alt="'+image.alt+'">'
                $('.imagearea').html(image);
                }
            }

            function launchLinkEditor() {
                BLACKBAUD.api.customPartEditor.links.launchLinkPicker({
                    callback: addLink
                });
            }

            function addLink(link) {
                if (link.url) {
                    // $('input.active-btn-text').val(link.name);
                    $('input.active-btn-input').val(link.url);
                }
            }
            function editorUIbuttons(){
                $('#part-settings ul a').on('click',function(e){
                e.preventDefault();
                $('#part-settings ul a.active').removeClass('active');
                var optionName = $(this).attr('class');
                $(this).addClass('active');
                $('#part-view').removeClass();
                $('#part-view').addClass('row '+optionName);

                });
            }
            function savePartSettings(){
                if(document.querySelector("#hypertable-settings #simpleMDE textarea") !== null){
                    var settingseditor = new SimpleMDE({ 
                                    element: document.querySelector("#hypertable-settings #simpleMDE textarea"),
                                    indentWitTabs: false,
                                    spellChecker: false,
                                    toolbar: [
                                    "heading-1","bold","heading-2","preview"]
                                });
                }
                $('#part-view').on('mouseleave',function(){
                    console.log('auto save');
                    $(".ccp-settings").each(function(){
                        var key = $(this).attr('id');
                        var type = $(this)[0].type || $(this).attr('data-type');
                        var value = $(this).val();
                        if(type == 'checkbox' || type == 'radio'){
                            value = $(this).prop('checked');
                        }else if(type == 'image' && $(this).find('img').length > 0){
                            value = {type:type,
                                html:$(this).find('img')[0].outerHTML,
                                alt:$(this).find('img').attr('alt'),
                                title:$(this).find('img').attr('title'),
                                url:$(this).find('img').attr('src')}
                        }else if(type == 'editor'){
                            settingsmd = settingseditor.value();
                            settingshtml = SimpleMDE.prototype.markdown(settingsmd);
                            value = {html:settingshtml,md:settingsmd};
                        }
                            configs[key] = value;
                    });

                //save configs      
                moduleconfigs = configs;
                console.log(configs);
                });
            }
            function editPost(){
                // var activePostID;
                $('.editpost').on('click', function(){
                    //inti update button
                    $('#editorbtns').removeClass('show-add-slide');
                    $('#editorbtns').addClass('show-update-slide');
                    var postID = ($(this).parents('tr').index() -1);
                    activePostID = postID;
                    var postObj = moduledata[postID];
                    MODEL.mapData(postObj);
                });
            }


            function updatePost(){
                $('.updatepost').on('click',function(e){
                    e.preventDefault();
                    moduledata[activePostID] = MODEL.getData();
                    $('#editorbtns').removeClass('show-update-slide');
                    HYPER.CCPeditor.init();
                });
            }

            function createPost(){
                $('.addpost').on('click', function(e){
                    e.preventDefault();
                    moduledata.push(MODEL.getData());
                    //refresh nunjuck template
                    HYPER.CCPeditor.init();
                });//end click handler
            }

            function cancelPost(){
                $('.cancelpost').on('click',function(e){
                    e.preventDefault();
                    HYPER.CCPeditor.init();
                });
            }

            function deletePost(){
                $('a.deletepost').on('click', function(){
                var postID = $(this).parents('tr').index();
                moduledata.splice((postID-1),1);
                $('table#hypertable tr.post'+(postID-1)).remove()
                console.log(postID+'has been deleted',moduledata)
                // CCPeditor.init();
                });
            }
            //Initialize functions
            $('.imagearea').click(launchImageEditor);

            $('.hyper-link').on('click',function(e){
                e.preventDefault();
                $('.active-btn').removeClass('.active-btn');
                $('.active-btn-input').removeClass('active-btn-input');
                $(this).addClass('active-btn');
                $(this).parent().find('input').addClass('active-btn-input');
                launchLinkEditor();
            });

            initializeEditor();
            editorUIbuttons();
            savePartSettings();
            createPost();
            if($('tbody.sortme tr').length > 0 ){   
                editPost();
                updatePost();
                deletePost();
                cancelPost();
            }

            // FUNCTION BELOW ARE FOR CONTROLLING THE TABLE SORTING AND UPDATING DATA
            Array.prototype.move = function (oldID, newID) {
                this.splice(newID, 0, this.splice(oldID, 1)[0]);
                this[newID].id = newID
                moduledata[oldID].id = oldID
            };
            $('tbody.sortme').sortable({
                placeholder: "sortable-placeholder",
                start: function(event, ui){
                    startPos = $(ui.item[0]).index()
                    console.log('starting position at '+startPos)
                },
                update: function(event, ui){
                    var currPos = $(ui.item[0]).index()
                    $(ui.item[0]).data('id', currPos)
                    console.log('ending position at '+currPos)
                    moduledata.move(startPos,currPos)
                    console.log(JSON.stringify(moduledata,null,'\t'))
                }
            });
        }
    },//end CCPeditor
    HyperParts: {
        HyperDirectory: function(){
            
            var collection = [];
            try{
            $('table[id*="_tblDirectoryMain"]').each(function(idx,elem){
            var id = $(this).attr('id').split('_')[0];
            var region = $(this).parent();
            var results = $('tr#'+id+'_trDirectoryTitle').parent().find('.DirectoryListingTable');
            var formname = $('tr#'+id+'_trDirectoryTitle').text().trim();
            var directorysubmit = $('input#'+id+'_btnRefresh')[0].outerHTML;
            var directorysearch = {};
            var labels = $('table#'+id+'_tblDirectoryCriteria tr').find('label');
            criteria = {};

            labels.each(function(id,elem){
                var inputs = $(elem).parent('td').next().html().trim();
                criteria[$(elem).text().trim()] = inputs;
            });

            //build content object
            directorysearch = {submitbutton:directorysubmit, title: formname, criteria:criteria}
            collection.push(directorysearch);
            console.log('directory display hardcoded url from document part');
            // build html layout and apply to dom
            var directory_response = nunjucks.render('document.doc?id=1492', {"data":results.hyperTable()});
            $(region).append(directory_response);

            // build search fields
            var directorySearchform = nunjucks.render('document.doc?id=1493', {"data":directorysearch});
            // $('#sidebar .directory-filter').remove();
            $('#sidebar').append(directorySearchform);


            //Clone pagination
            $('.BBPager').first().clone().appendTo(region);
            //Clone error messages
            $('.DirectoryMessage').clone().appendTo(region);
            $(this).remove();
            console.log(results.hyperTable());
            });//end each directory part loop
            return collection;

            }catch(err){
            console.log('oops an error occured converting the directory part into a hyper table.',err);
            }
        },
        HyperForm: function(settings){
            // $.fn.hyperForm = function(){
            if($('[id*="pnlDonationForm"]').length > 0){
                var form = '[id*="pnlDonationForm"]';
                var collection = [];
                var region = $(form).parent();
                var whatsThis = ($('a[id*="lnkcsc_help"]').length > 0)?$('a[id*="lnkcsc_help"]')[0].outerHTML:false;

                // Grab Validation Messages
                var validationMessages = {};
                if( $('.BBFormValidatorSummary ul li').length > 0 ){
                    $('.BBFormValidatorSummary ul li').each(function(){
                        var key = $(this).text().split(':')[0];
                        var value = $(this).text().split(':')[1];
                        validationMessages[$.trim(key).replace(/ /g,'_')] = value;
                    });
                }else{
                validationMessages = false;
                }

                

                //Give Levels
                var levels = {inputs:[]};
                var otherText = "";
                if($('[id*="_tblAmount"] tr').length > 0){
                    levels.section_name = $('[id*="lblPersonal"]').text();
                    $(form).find('[id*="_tblAmount"] tr').each(function(id, val){
                        var gname = $(val).find('label').text().trim().toLowerCase();
                        var gamount = $(val).find('label, span').parents('td').next();
                        if( gamount.hasClass('vaBottom') ){
                            levels.inputs.push({
                                "level_name":gname.replace(/ /g,'_'),
                                "level_amount":gamount.text(),
                                "level_id":$(val).find('label').attr('for'),
                                "level_value":$(val).find('input').attr('value'),
                                "level_attrname":$(val).find('input').attr('name'),
                                "level_index":$(val).find('span').attr('itemindex')
                            });
                        }else{
                            // console.log(gamount.text());
                            levels.inputs.push({"level_name":"other",
                                "level_text":gname,
                                "level_amount":$(val).find('input')[0].outerHTML});
                            if(gname !== ''){
                                otherText = $(val).find('label').text().trim();
                            }
                        }
                        
                    });
                }
                //Designation Section
                //No support for multi designation option
                var designations;
                if($('[id*="ddlDesignations"]').length > 0){
                    // designations = $('[id*="ddlDesignations"]')[0].outerHTML.attr('style','');
                    designations = {element:$('[id*="ddlDesignations"]').attr('style','')[0].outerHTML,section_name:$('[id*="lblDesignationCaption"]').text()}
                }else{
                    designations = false;
                }

                //Frequency Section
                var frequency = ($('[id*="trRecurrence"]').attr('style') === '/* display:none; */' && $('tr[id*="trRecurrence"]').length > 0)?false:true;
                var freqType;
                if(frequency && $('[id*="_Recurrence_tdFrequency"]').length > 0){
                    var freqType = ($('[id*="Recurrence_tdFrequency"] select:first')[0].value.indexOf('xml') > -1)?'specific':'general';
                    var recurring = $('[id*="Recurrence_tdFrequency"]');
                    var recurrElements = '';
                    recurring.find('label, span, input, select').each(function(){
                    var element = $(this)[0].outerHTML;
                    recurrElements += element;
                    });
                    frequency = recurrElements;                    
                }

                //GiftType Section
                var giftTypes = false;
                if($('[id*="rdoGiftType"] tr').length > 0){
                    var giftTypes = {active:false,inputs:[],frequency:frequency,frequencyType:freqType};
                    var active;
                    giftTypes.section_name = $('[id*="lblGiftTypeCaption"]').text();
                    $('[id*="rdoGiftType"] tr').each(function(){
                        var typename = $(this).find('td label').text();
                        var element = $(this).find('td input');
                        var classname = typename.replace(' ','-').toLowerCase()
                        if(element[0].checked){giftTypes.active = classname}
                        giftTypes.inputs.push({
                        "label_name":typename,
                        "element": element[0].outerHTML,
                        "type":element[0].type,
                        "active": element[0].checked
                        });
                    });
                };

                //Payment Section
                var PaymentInfo = false;
                if($('[id*="DonationCapture1_tbdyPaymentInfo"]').length > 0){  
                    $('[id*="DonationCapture1_tbdyPaymentInfo"]').addClass('payment-section');
                    var payrows = $('.payment-section').find('tr');
                    PaymentInfo = {};
                    PaymentInfo.section_name = $('[id*="lblPayment"]').text();
                    payrows.each(function(){
                        var label_name = $(this).find('label:first').text().replace('/','').replace(':','').trim();
                        var element = $(this).find('input,select');
                        var multi = true;
                        for (var i = 0; i < element.length; i++) {
                            var class_name = element[i].id.split('_')[2].replace('cboMonth','Exp Month').replace('cboYear','Exp Year');
                            var label_name = (label_name.length > 0)?label_name.replace('Card Security Code','cvc'):'';
                            var elem = element[i].outerHTML;
                            if(class_name.indexOf('Exp') > -1){
                                PaymentInfo[class_name] = {element:elem,classname:class_name.replace(' ',''),label_name:label_name,required:true}
                            }
                            if(label_name !== ''){
                                PaymentInfo[label_name] = {element:elem,classname:class_name,label_name:label_name,required:true}
                            }
                        }
                    });
                    delete PaymentInfo["Card Expiration"];
                }

                //Tribute Section
                var TributeInfo = false;
                if($('[id*="lblTributeHeading"]').length >0){
                    TributeInfo = [];
                    $('[id*="lblTributeHeading"]').parents('tbody').addClass('tribute-section');
                    if(whatsThis === false){   
                    //if payment form
                    $('[id*="trRecurrence"],[id*="trGiftType"],[id*="trComments"],[id*="trAdditInformation"]').wrapAll('<tbody class="recurring-section"></tbody>');
                    $('.recurring-section').insertBefore('.tribute-section');
                    }
                    var trows = $('.tribute-section').find('tr');
                    trows.each(function(){
                        var isVisible = ($(this).attr('style') !== 'display:none;')?true:false;
                        if(isVisible){
                            var label_name = $(this).find('label').text();
                            var element = $(this).find('input,select,textarea');
                            var required = ($(this).find('.BBFormRequiredFieldMarker:not(style=["visibility: hidden"])').length > 0)?true:false;
                            if(element[0] !== undefined && label_name !== ''){
                                classname = (element[0].getAttribute('id').split('_').length > 3)?element[0].getAttribute('id').split('_')[3]:label_name.trim().toLowerCase().replace(/ /g,'-').replace(':','').replace('\'','');
                                TributeInfo.push({
                                    label_name:label_name,
                                    classname:classname,
                                    element:element[0].outerHTML,
                                    required:required
                                });
                            }
                        }
                    });
                }

                

                //Matching Section
                var CompanyMatch = false;
                if($('[id*="tbdyMatchingGifts"]').length > 0){
                    $('[id*="tbdyMatchingGifts"]').addClass('company-match-section');
                    var trows = $('.company-match-section').find('tr');
                    CompanyMatch = {};
                    var active = false;
                    trows.each(function(){
                        var required = ($(this).find('.BBFormRequiredFieldMarker').length > 0)?true:false;
                        var label_name = $(this).find('label').text();
                        var element = $(this).find('input');
                        if(element[0] !== undefined && label_name !== '' ){
                        active = (element[0].type === 'checkbox' )?element[0].checked:false;
                            CompanyMatch[label_name] = {
                            element:element[0].outerHTML,
                            required:required,
                            type:element[0].type,
                            active:element[0].checked
                            }
                        }
                    });
                }
                
                //Anonymous Section
                var Anonymous = false;
                if($('[id*="trAnonymous"]').length > 0){
                    $('[id*="trAnonymous"]').addClass('anonymous-section');
                    var trows = $('.anonymous-section').find('td');
                    Anonymous = [];
                    trows.each(function(){
                        var required = ($(this).find('.BBFormRequiredFieldMarker').length > 0)?true:false;
                        var label_name = $(this).find('label').text();
                        var element = $(this).find('input');
                        var classname =label_name.trim().toLowerCase().replace(/ /g,'_').replace(':','').replace('\'','');
                        if(element[0] !== undefined && label_name !== '' ){
                            Anonymous.push({
                            label_name:label_name,
                            element:element[0].outerHTML,
                            required:required,
                            classname:classname,
                            active:element[0].checked
                            });              
                        }
                    });
                }

                //PAYMENT AND BILLING Sections
                var BillingInfo = {inputs:[]};
                $('[id*="lblBilling"]').parents('tbody').addClass('BillingInfo');
                var trows = $('.BillingInfo').find('tr');
                BillingInfo.section_name = $('[id*="lblBilling"]').text();
                trows.each(function(){
                    var required = ($(this).find('.BBFormRequiredFieldMarker').length > 0)?true:false;
                    var label_name = $(this).find('label,span').text();
                    var element = $(this).find('input, select,textarea');
                    var classname =label_name.trim().toLowerCase().replace(/ /g,'_').replace(':','').replace('\'','');
                    if(element[0] !== undefined && label_name !== '' ){
                        BillingInfo.inputs.push({
                        label_name:label_name,
                        element:element[0].outerHTML,
                        required:required,
                        classname:classname,
                        active:element[0].checked
                        });              
                    }
                });


                //Submit Button
                var donationBtn = $(form).find('.BBFormButtonCell.DonationButtonCell').html().trim();
                var submitBtn = {
                    "button_name":$(donationBtn).attr('name'),
                    "button_id":$(donationBtn).attr('id'),
                    "button_value":$(donationBtn).attr('value'),
                    "button_type":$(donationBtn).attr('type')
                };
                // var formID = levels.inputs[0].level_id.split('_')[0];
                var formID = ($('[id*="_UpdatePanel"]').length > 0)?$('[id*="_UpdatePanel"]').attr('id').split('_')[0] :false;
                // return collection;
                collection = {"_id":formID,
                "Frequency":frequency,
                "whatsThis":whatsThis,
                "Designations":designations,
                "PaymentInfo":PaymentInfo,
                "TributeInfo":TributeInfo,
                "CompanyMatch":CompanyMatch,
                "OtherText":otherText,
                "BillingInfo":BillingInfo,
                "Anonymous":Anonymous,"GiftTypes":giftTypes,"Givelevels":levels,"Donatebutton":submitBtn,"Validation":validationMessages};
                // add custom data
                if(settings && settings.data.length > 0){
                    collection.Settings = settings.data;
                }
                if(settings && settings.configs.layout !== ''){
                    //render template string
                    var hyperform_string = settings.configs.layout;
                    var hyperform_html = nunjucks.renderString(hyperform_string, {"data":collection,"configs":settings.configs});
                }else{
                    //render template from file
                    var hyperform_html = nunjucks.render(settings.template_name, {"data":collection,"configs":settings.configs});
                }
                $(region).prepend(hyperform_html);
                // console.log(collection);
                return collection;
            }else{
                localStorage.clear();
            }
        },
        HyperTransactionManager: function(){console.log('hello hyper transaction manager');},
        HyperProfile: function(){console.log('hello hyper profile');}
    },
    NunjuckEnvironment: function(path_to_templates,nunjuckFilters){
        initcustomNunjucksfilters = function(){
                if(nunjuckFilters && nunjuckFilters.length > 0){
                    // console.log(nunjuckFilters);
                }
                //Custom Nunjucks filters
                env.addFilter('sortby', function(array, key){
                    return array.sort(function(a, b) {
                    var x = a[key]; var y = b[key];
                    return ((x < y) ? -1 : ((x > y) ? 1 : 0));
                    });
                });
                env.addFilter('date',function(input, format){
                    var d = new Date(input);
                    return moment(input).format(format);
                });
                env.addFilter('jquery', function(element, methods){

                    //Collection of jquery functions
                    var newelement = element;
                    if( methods === 'text')
                    {
                    newelement = $(element).text();
                    }
                    else if( methods.addclass )
                    {
                    newelement = $(element).addClass(methods.addclass);
                    newelement = newelement[0].outerHTML;
                    }
                    else if( methods.addId ){
                        currentID = $(element).attr('id');
                        newelement = $(element).attr('id',methods.addId);
                        newelement = newelement[0].outerHTML;
                    }
                    else if( methods.contains )
                    {
                    //element is an explict string value only
                    newelement = element.indexOf(methods.contains)
                    }
                    else if( methods.value )
                    {
                    jelem = $(element).val(methods.value);
                    newelement = jelem[0].outerHTML;
                    }
                    else if( methods.placeholder )
                    {
                    jelm = $(element).attr('placeholder', methods.placeholder);
                    newelement = jelm[0].outerHTML;
                    }
                    return newelement
                });
                
                return this;
        }//end nunfilters

        initNunjucksEnvironment = function(path_to_templates){
            //Initialize Nunjucks path to view templates
            env = nunjucks.configure(path_to_templates);
            // console.log('init nunjuck filters');
            initcustomNunjucksfilters();
            return this;
        }
        initNunjucksEnvironment(path_to_templates);
    },
    BBProduction: function(settings){
            HYPER.Config.path_to_templates = (settings && settings.path_to_templates != undefined)?settings.path_to_templates : '/file/webdev/templates';
            HYPER.NunjuckEnvironment(HYPER.Config.path_to_templates);
            if( settings && settings.hyper_part == 'directory'){
                HYPER.HyperParts.HyperDirectory();
            }else if ( settings && settings.hyper_part == 'standard-form'){
                HYPER.HyperParts.HyperForm(settings);
            }else{
                if(settings){
                var hypertemplate = nunjucks.render(settings.template_name, settings);
                // Add the element to the page
                $('#'+settings.regionID).prepend(hypertemplate);
                }
            }
    },
    init: function(settings){
        // HYPER.Config.path_to_templates = (settings.path_to_templates.length > 0)?settings.path_to_templates:HYPER.Config.path_to_templates;
        HYPER.BBProduction(settings);
    }
};
